<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"fangniude.github.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="随便写点东西">
<meta property="og:type" content="website">
<meta property="og:title" content="放牛的">
<meta property="og:url" content="https://fangniude.github.com/">
<meta property="og:site_name" content="放牛的">
<meta property="og:description" content="随便写点东西">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="放牛的">
<meta property="article:tag" content="技术">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://fangniude.github.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>放牛的</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">放牛的</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">放牛的日子，是人生初恋的诗...</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E5%86%92%E6%B3%A1%E6%8E%92%E5%BA%8F/" class="post-title-link" itemprop="url">冒泡排序</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-07-20 17:06:12 / 修改时间：14:54:36" itemprop="dateCreated datePublished" datetime="2021-07-20T17:06:12+08:00">2021-07-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>常见的冒泡排序，基本都是这么写的（摘自维基百科）：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">int</span>[] bubbleSort(<span class="keyword">int</span>[] array) &#123;</span><br><span class="line">    <span class="keyword">int</span> temp;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; array.length - <span class="number">1</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">boolean</span> Flag = <span class="keyword">false</span>; <span class="comment">// 是否发生交换。没有交换，提前跳出外层循环</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; array.length - <span class="number">1</span> - i; j++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (array[j] &gt; array[j + <span class="number">1</span>]) &#123;</span><br><span class="line">                temp = array[j];</span><br><span class="line">                array[j] = array[j + <span class="number">1</span>];</span><br><span class="line">                array[j + <span class="number">1</span>] = temp;</span><br><span class="line">                Flag = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!Flag)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> array;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样理解上，经常会有困难，为什么这样写的是对的？总感觉不太直观。</p>
<p>我试着换了种写法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] bubbleSort(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">    <span class="comment">// i is the begin of sorted range, from nums.length ~ 1</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = nums.length; i &gt; <span class="number">1</span>; i--) &#123;</span><br><span class="line">        <span class="comment">// j is the next max value pointer</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; i; j++) &#123;</span><br><span class="line">            <span class="keyword">int</span> n = nums[j];</span><br><span class="line">            <span class="comment">// swap if the bubble &gt; the next</span></span><br><span class="line">            <span class="keyword">if</span> (n &lt; nums[j - <span class="number">1</span>]) &#123;</span><br><span class="line">                nums[j] = nums[j - <span class="number">1</span>];</span><br><span class="line">                nums[j - <span class="number">1</span>] = n;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> nums;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我的理解思路是这样的：</p>
<ul>
<li>和插入排序类似，冒泡排序也分为排序好的部分 和 未排序的部分</li>
<li>排序好的部分放在右侧，开始为0个，即索引为nums.length<ul>
<li>排序好的部分索引范围：[i, nums.length)</li>
<li>每冒一次泡，多一个元素加入排序好的部分，即索引左移1位</li>
<li>当i到第2个元素的时候，就不需要执行了，即 i == 1 不需要执行</li>
</ul>
</li>
<li>未排序好的部分放在左侧，每次从第2个元素开始，与前一个比较，直到未排序的最后一个元素<ul>
<li>未排序的部分索引范围：[0, i)</li>
<li>从第2个元素开始，即 j = 1开始，到未排序的最后一个元素，即 i - 1为止</li>
<li>与前一个元素比较，根据需要交换</li>
</ul>
</li>
</ul>
<p>当然，可以在这个版本上，加上已经全部有序的验证：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] bubbleSortWithSwapCheck(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">    <span class="comment">// bubble sort, add has swap check</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// i is the begin of sorted range, from nums.length ~ 1,</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = nums.length; i &gt; <span class="number">1</span>; i--) &#123;</span><br><span class="line">        <span class="comment">// check has swap</span></span><br><span class="line">        <span class="keyword">boolean</span> hasSwap = <span class="keyword">false</span>;</span><br><span class="line">        <span class="comment">// j is the next max value pointer</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; i; j++) &#123;</span><br><span class="line">            <span class="keyword">int</span> n = nums[j];</span><br><span class="line">            <span class="comment">// swap if the bubble &gt; the next</span></span><br><span class="line">            <span class="keyword">if</span> (n &lt; nums[j - <span class="number">1</span>]) &#123;</span><br><span class="line">                nums[j] = nums[j - <span class="number">1</span>];</span><br><span class="line">                nums[j - <span class="number">1</span>] = n;</span><br><span class="line">                hasSwap = <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!hasSwap) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> nums;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>类似的，还可以进一步优化，缩短外层循环：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span>[] bubbleSortWithSwapIndex(<span class="keyword">int</span>[] nums) &#123;</span><br><span class="line">    <span class="comment">// bubble sort, add has swap check, add the sorted range</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// i is the begin of sorted range, from nums.length ~ 1,</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = nums.length; i &gt; <span class="number">1</span>; ) &#123;</span><br><span class="line">        <span class="comment">// swap index</span></span><br><span class="line">        <span class="keyword">int</span> swapIndex = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">// j is the next max value pointer</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; i; j++) &#123;</span><br><span class="line">            <span class="keyword">int</span> n = nums[j];</span><br><span class="line">            <span class="comment">// swap if the bubble &gt; the next</span></span><br><span class="line">            <span class="keyword">if</span> (n &lt; nums[j - <span class="number">1</span>]) &#123;</span><br><span class="line">                nums[j] = nums[j - <span class="number">1</span>];</span><br><span class="line">                nums[j - <span class="number">1</span>] = n;</span><br><span class="line">                swapIndex = j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (swapIndex == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            i = swapIndex;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> nums;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/PostgreSQL%E8%A1%A8%E6%95%B0%E6%8D%AE%E7%A6%81%E6%AD%A2%E6%9B%B4%E6%96%B0%E5%88%A0%E9%99%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/PostgreSQL%E8%A1%A8%E6%95%B0%E6%8D%AE%E7%A6%81%E6%AD%A2%E6%9B%B4%E6%96%B0%E5%88%A0%E9%99%A4/" class="post-title-link" itemprop="url">PostgreSQL表数据禁止更新删除</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-02-25 17:06:12" itemprop="dateCreated datePublished" datetime="2021-02-25T17:06:12+08:00">2021-02-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-21 09:17:06" itemprop="dateModified" datetime="2021-07-21T09:17:06+08:00">2021-07-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>公司建体验账号，不希望密码被改掉，又需要显示改密码功能，数据库用的是PostgreSQL。</p>
<p>于是，找到了这篇文章：PostgreSQL: 禁止表上数据更新或删除的方法：<a href="https://www.postgres.fun/20120810153010.html">https://www.postgres.fun/20120810153010.html</a></p>
<p>该文中提到了2种方法，都是限定整张表的。而我们只想限定表中预置数据不能修改删除，于是做了以下测试：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 建测试表</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> &quot;public&quot;.&quot;test_user&quot; (</span><br><span class="line">  &quot;id&quot; int8 <span class="keyword">NOT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  &quot;name&quot; <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> &quot;pg_catalog&quot;.&quot;default&quot;,</span><br><span class="line">  &quot;password&quot; <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> &quot;pg_catalog&quot;.&quot;default&quot;</span><br><span class="line">);</span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> &quot;public&quot;.&quot;test_user&quot; <span class="keyword">ADD</span> <span class="keyword">CONSTRAINT</span> &quot;user_pkey&quot; <span class="keyword">PRIMARY</span> KEY (&quot;id&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 插入预置数据</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;public&quot;.&quot;test_user&quot; <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;aaa&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;public&quot;.&quot;test_user&quot; <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;bbb&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;public&quot;.&quot;test_user&quot; <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;c&#x27;</span>, <span class="string">&#x27;ccc&#x27;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 创建失败时执行的触发函数</span></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE <span class="keyword">FUNCTION</span> func_test_trigger()  </span><br><span class="line"><span class="keyword">RETURNS</span> <span class="keyword">trigger</span>  </span><br><span class="line"><span class="keyword">LANGUAGE</span> plpgsql  </span><br><span class="line"><span class="keyword">AS</span> $<span class="keyword">function</span>$  </span><br><span class="line"><span class="keyword">BEGIN</span>  </span><br><span class="line"> RAISE EXCEPTION <span class="string">&#x27;Attention: can not update or delete table test_trigger,Please contact francs !&#x27;</span>;  </span><br><span class="line"><span class="keyword">END</span>;  </span><br><span class="line">$<span class="keyword">function</span>$;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 建触发器，根据id限定行</span></span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trigger_test_trigger_update BEFORE UPDATE <span class="keyword">ON</span> test_user <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span> <span class="keyword">WHEN</span> (OLD.id <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)) <span class="keyword">EXECUTE</span> <span class="keyword">PROCEDURE</span> func_test_trigger();</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">trigger</span> trigger_test_trigger_delete BEFORE <span class="keyword">DELETE</span> <span class="keyword">ON</span> test_user <span class="keyword">FOR</span> <span class="keyword">EACH</span> <span class="type">ROW</span> <span class="keyword">WHEN</span> (OLD.id <span class="keyword">in</span> (<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)) <span class="keyword">EXECUTE</span> <span class="keyword">PROCEDURE</span> func_test_trigger();</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 限定行修改、删除时报错</span></span><br><span class="line">UPDATE test_user <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;123&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">1</span>; <span class="comment">-- 执行报错</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> test_user <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">2</span>;  <span class="comment">-- 执行报错</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 可以插入新的行</span></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;public&quot;.&quot;test_user&quot; <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="string">&#x27;d&#x27;</span>, <span class="string">&#x27;ddd&#x27;</span>); <span class="comment">-- 成功</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- 新的行可以修改、删除</span></span><br><span class="line">UPDATE test_user <span class="keyword">set</span> name <span class="operator">=</span> <span class="string">&#x27;123&#x27;</span> <span class="keyword">where</span> id <span class="operator">=</span> <span class="number">4</span>; <span class="comment">-- 成功</span></span><br><span class="line"><span class="keyword">DELETE</span> <span class="keyword">FROM</span> test_user <span class="keyword">WHERE</span> id <span class="operator">=</span> <span class="number">4</span>;  <span class="comment">-- 成功</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/Raft%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Raft%E5%85%B1%E8%AF%86%E7%AE%97%E6%B3%95/" class="post-title-link" itemprop="url">Raft共识算法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-12-28 17:06:12" itemprop="dateCreated datePublished" datetime="2020-12-28T17:06:12+08:00">2020-12-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-21 09:17:06" itemprop="dateModified" datetime="2021-07-21T09:17:06+08:00">2021-07-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>关于Raft共识算法，网上资料很多，看完了往往还是一头雾水。</p>
<p>有2个很好的站点，可以动态的观察Raft执行过程：</p>
<ul>
<li>Raft官网：<a href="https://raft.github.io/">https://raft.github.io/</a></li>
<li>可视化教程：<a href="http://thesecretlivesofdata.com/raft/">http://thesecretlivesofdata.com/raft/</a></li>
</ul>
<p>关于为什么取名为Raft，特地查了一下，在Google groups里面找到了答案：</p>
<blockquote>
<p>People ask me why it’s called “Raft” every now and then, and I didn’t have anything public on that until now. I wrote this up earlier in the year in a private email. I want a URL for it, so I’m sending it here and spamming all of you.</p>
<p>There’s a few reasons we came up with the name Raft:</p>
<p>- It’s not quite an acronym, but we were thinking about the words ‘reliable’, ‘replicated’, ‘redundant’, and ‘fault-tolerant’.</p>
<p>- We were thinking about logs and what can be built using them.</p>
<p>- We were thinking about the island of Paxos and how to escape it.</p>
<p>As a plus, we were using the randomly generated name Cheesomi in the paper before we came up with the name Raft in September 2012. The name appeared just over 100 times in our paper submission back then, so switching to the shorter name actually helped shrink the paper down quite a bit.</p>
<p>If you want even more detail, we had trouble coming up with a good name, so we made it an explicit agenda item during a RAMCloud meeting. I found two photos of the whiteboard during/after that meeting that I attached here. Looks like the top contenders were Raft, Knox (as in Fort Knox, I guess), Redundo, and Cloudsense (no clue). I don’t remember the details of how we ended up with Raft, since it didn’t obviously win the vote, but I do remember the name caught on really quickly. People seemed to like it almost right away. I’m so fucking glad it’s not called Redundo.</p>
<p>Thanks for listening,</p>
<p>Diego</p>
</blockquote>
<h3 id="1-Raft共识算法用来解决什么问题？"><a href="#1-Raft共识算法用来解决什么问题？" class="headerlink" title="1. Raft共识算法用来解决什么问题？"></a>1. Raft共识算法用来解决什么问题？</h3><p>简言之，用来解决分布式存储一致性的问题。用来协调集群节点答成共识。</p>
<h3 id="2-Raft怎么做到的？"><a href="#2-Raft怎么做到的？" class="headerlink" title="2. Raft怎么做到的？"></a>2. Raft怎么做到的？</h3><p>主要通过2件事：Leader选举 和 日志复制。</p>
<h4 id="2-1-Leader选举"><a href="#2-1-Leader选举" class="headerlink" title="2.1 Leader选举"></a>2.1 Leader选举</h4><ul>
<li>节点状态<ul>
<li>角色(state)<ul>
<li>Follower</li>
<li>Candidate</li>
<li>Leader</li>
</ul>
</li>
<li>任期(term)<ul>
<li>递增的数字，每一次选举，增1</li>
</ul>
</li>
<li>日志索引(log index)<ul>
<li>递增的数字，每一次请求增1</li>
</ul>
</li>
</ul>
</li>
<li>2个超时时间<ul>
<li>Candidate timeout<ul>
<li>Follower、Candidate没有收到心跳时</li>
</ul>
</li>
<li>heartbeat timeout<ul>
<li>Leader每隔该时间，固定发送心跳包</li>
</ul>
</li>
</ul>
</li>
<li>角色变更<ul>
<li>开始：全部是Follower</li>
<li>Follower<ul>
<li>选举超时：从Follower变成Candidate</li>
</ul>
</li>
<li>Candidate<ul>
<li>收到多数节点票数：从Candidate变成Leader</li>
<li>发现当前Leader 或 更新的Term：从Candidate 变成 Follower</li>
</ul>
</li>
<li>Leader<ul>
<li>发现拥有更高Term或更大Index的节点：从Leader变成Follower</li>
</ul>
</li>
</ul>
</li>
<li>消息<ul>
<li>Request Vote（Candidate发起，请求投票）<ul>
<li>发起方：Candidate</li>
<li>请求：term，index</li>
<li>返回：投票 1 或 0</li>
</ul>
</li>
<li>Append Entries(Leader发起，心跳)<ul>
<li>发起方：Leader</li>
<li>请求：term，index，entries</li>
<li>返回：</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="2-2-日志复制"><a href="#2-2-日志复制" class="headerlink" title="2.2 日志复制"></a>2.2 日志复制</h4><ul>
<li>Leader收到Client请求</li>
<li>Leader先写自己的Uncommitted日志</li>
<li>下一次心跳将数据发送到Follower</li>
<li>Leader收到多数Follower写uncommitted成功，Leader 改为Committed，并返回客户端成功</li>
<li>下一次心跳，Follower改为Committed</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/MySQL%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/MySQL%E8%87%AA%E5%8A%A8%E5%A4%87%E4%BB%BD/" class="post-title-link" itemprop="url">MySQL自动备份</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-18 17:06:12" itemprop="dateCreated datePublished" datetime="2020-04-18T17:06:12+08:00">2020-04-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>你是否有过这样的经历：MySQL中误删了数据，数据没有备份，bin-log还没开。</p>
<p>我今天刚经历了一次，因为是测试环境，一般认为数据丢了也没关系。</p>
<p>但误删数据，总是会带来麻烦，有备无患。</p>
</blockquote>
<p>备份分2步：写个备份的Shell脚本、配置cron。</p>
<h4 id="Shell脚本"><a href="#Shell脚本" class="headerlink" title="Shell脚本"></a>Shell脚本</h4><p>我把脚本写在<code>/usr/bin/mysql_backup.sh</code>文件中，</p>
<p>并给它可执行权限<code>chmod +X /usr/bin/mysql_backup.sh</code>，</p>
<p>脚本内容如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'start backup mysql...'</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'create directory[/root/mysql_backup] if not exist...'</span>;</span><br><span class="line">mkdir -p /root/mysql_backup;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'backup mysql to [/root/mysql_backup] directory...'</span>;</span><br><span class="line">mysqldump -u root -pPassword --all-databases &gt; /root/mysql_backup/all_$( date +<span class="string">"%Y_%m_%d"</span> ).sql;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'delete old backup files'</span>;</span><br><span class="line">find /root/mysql_backup -<span class="built_in">type</span> f -mtime +10 -<span class="built_in">exec</span> rm &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">'backup mysql finish'</span>;</span><br></pre></td></tr></table></figure>



<h4 id="配置CRON"><a href="#配置CRON" class="headerlink" title="配置CRON"></a>配置CRON</h4><p>修改<code>/etc/crontab</code>文件，加入下行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0 5 * * * root /usr/bin/mysql_backup.sh</span><br></pre></td></tr></table></figure>

<p>这样，每天5点，以root用户执行该脚本。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/git%E6%8E%A2%E7%A7%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/git%E6%8E%A2%E7%A7%98/" class="post-title-link" itemprop="url">git探秘</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-04 17:06:12" itemprop="dateCreated datePublished" datetime="2020-03-04T17:06:12+08:00">2020-03-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-仓库初始化"><a href="#1-仓库初始化" class="headerlink" title="1. 仓库初始化"></a>1. 仓库初始化</h1><h2 id="1-1-准备空文件夹"><a href="#1-1-准备空文件夹" class="headerlink" title="1.1 准备空文件夹"></a>1.1 准备空文件夹</h2><p>为了探索git，我们建一个新的文件夹，在这里，可以随便怎么搞</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 删除临时文件夹(如果存在的话)，创建一个临时文件夹，并进入 </span></span><br><span class="line">➜ rm -rf tmp &amp;&amp; mkdir tmp &amp;&amp; cd $_</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示当前文件夹的路径</span></span><br><span class="line">➜ pwd</span><br><span class="line">/Users/lewis/tmp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 目前，里面是空的，一个空文件夹准备好了</span></span><br><span class="line">➜ ls -al</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x    2 lewis  staff    64  3  4 09:47 .</span><br><span class="line">drwxr-xr-x+ 128 lewis  staff  4096  3  4 09:48 ..</span><br></pre></td></tr></table></figure>

<h2 id="1-2-git初始化"><a href="#1-2-git初始化" class="headerlink" title="1.2 git初始化"></a>1.2 git初始化</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在这个文件夹中，建立git仓库</span></span><br><span class="line">➜ git init</span><br><span class="line">Initialized empty Git repository in /Users/lewis/tmp/.git/</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 看到多了一个 .git 文件夹</span></span><br><span class="line">➜ ls -al</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x    3 lewis  staff    96  3  4 09:41 .</span><br><span class="line">drwxr-xr-x+ 128 lewis  staff  4096  3  4 09:44 ..</span><br><span class="line">drwxr-xr-x    9 lewis  staff   288  3  4 09:43 .git</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 看看这个文件夹里有什么，嗯，有3个文件 和 4个文件夹</span></span><br><span class="line">➜ ls -al .git</span><br><span class="line">total 24</span><br><span class="line">drwxr-xr-x   9 lewis  staff  288  3  4 10:10 .</span><br><span class="line">drwxr-xr-x   3 lewis  staff   96  3  4 09:53 ..</span><br><span class="line">-rw-r--r--   1 lewis  staff   23  3  4 09:53 HEAD</span><br><span class="line">-rw-r--r--   1 lewis  staff  137  3  4 09:53 config</span><br><span class="line">-rw-r--r--   1 lewis  staff   73  3  4 09:53 description</span><br><span class="line">drwxr-xr-x  13 lewis  staff  416  3  4 09:53 hooks</span><br><span class="line">drwxr-xr-x   3 lewis  staff   96  3  4 09:53 info</span><br><span class="line">drwxr-xr-x   4 lewis  staff  128  3  4 09:53 objects</span><br><span class="line">drwxr-xr-x   4 lewis  staff  128  3  4 09:53 refs</span><br></pre></td></tr></table></figure>

<h2 id="1-3-git文件夹初探"><a href="#1-3-git文件夹初探" class="headerlink" title="1.3 .git文件夹初探"></a>1.3 .git文件夹初探</h2><p>这些都是干嘛用的呢？通过文件名，有一些好猜的，和一些不太好理解的</p>
<ul>
<li><p>好猜的，不妨先猜一下，</p>
<ul>
<li>config：配置文件</li>
<li>description：描述文件，具体描述什么还不清楚，感觉不是核心</li>
<li>hooks：钩子文件夹，应该是做扩展功能用的，在主流程上加些钩子</li>
<li>info：存的是一些信息，什么信息要看一下</li>
</ul>
</li>
<li><p>不好猜的</p>
<ul>
<li>HEAD：头？你个大头鬼啊。。。</li>
<li>objects：存的是对象？什么是对象？</li>
<li>refs：references的简写？存的是对象的引用？</li>
</ul>
</li>
<li><p>感觉好猜的部分，是辅助功能，不好猜的才是核心</p>
</li>
</ul>
<h3 id="1-3-1-辅助功能"><a href="#1-3-1-辅助功能" class="headerlink" title="1.3.1 辅助功能"></a>1.3.1 辅助功能</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> config里面存了什么？</span></span><br><span class="line">➜ cat .git/config </span><br><span class="line">[core]</span><br><span class="line">	repositoryformatversion = 0</span><br><span class="line">	filemode = true</span><br><span class="line">	bare = false</span><br><span class="line">	logallrefupdates = true</span><br><span class="line">	ignorecase = true</span><br><span class="line">	precomposeunicode = true</span><br><span class="line"><span class="meta">#</span><span class="bash"> 感觉就是些配置，能看懂一个 ignorecase，是忽略大小写，总之，这是配置文件</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> description文件呢？</span></span><br><span class="line">➜ cat .git/description </span><br><span class="line">Unnamed repository; edit this file 'description' to name the repository.</span><br><span class="line"><span class="meta">#</span><span class="bash"> 看描述，是给仓库命名用的，先不管它</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 看看hooks文件夹</span></span><br><span class="line">➜ ls -al .git/hooks </span><br><span class="line">total 96</span><br><span class="line">drwxr-xr-x  13 lewis  staff   416  3  4 09:53 .</span><br><span class="line">drwxr-xr-x   9 lewis  staff   288  3  4 10:24 ..</span><br><span class="line">-rwxr-xr-x   1 lewis  staff   478  3  4 09:53 applypatch-msg.sample</span><br><span class="line">-rwxr-xr-x   1 lewis  staff   896  3  4 09:53 commit-msg.sample</span><br><span class="line">-rwxr-xr-x   1 lewis  staff  3327  3  4 09:53 fsmonitor-watchman.sample</span><br><span class="line">-rwxr-xr-x   1 lewis  staff   189  3  4 09:53 post-update.sample</span><br><span class="line">-rwxr-xr-x   1 lewis  staff   424  3  4 09:53 pre-applypatch.sample</span><br><span class="line">-rwxr-xr-x   1 lewis  staff  1638  3  4 09:53 pre-commit.sample</span><br><span class="line">-rwxr-xr-x   1 lewis  staff  1348  3  4 09:53 pre-push.sample</span><br><span class="line">-rwxr-xr-x   1 lewis  staff  4898  3  4 09:53 pre-rebase.sample</span><br><span class="line">-rwxr-xr-x   1 lewis  staff   544  3  4 09:53 pre-receive.sample</span><br><span class="line">-rwxr-xr-x   1 lewis  staff  1492  3  4 09:53 prepare-commit-msg.sample</span><br><span class="line">-rwxr-xr-x   1 lewis  staff  3610  3  4 09:53 update.sample</span><br><span class="line"><span class="meta">#</span><span class="bash"> 里面都是些示例文件，和猜测一样，是正常流程的钩子</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> info文件夹下，只有一个文件</span></span><br><span class="line">➜  tmp git:(master) ls -al .git/info </span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  3 lewis  staff   96  3  4 09:53 .</span><br><span class="line">drwxr-xr-x  9 lewis  staff  288  3  4 10:26 ..</span><br><span class="line">-rw-r--r--  1 lewis  staff  240  3  4 09:53 exclude</span><br><span class="line"><span class="meta">#</span><span class="bash"> exclude文件里的内容，看不太懂，感觉是排除规则之类的</span></span><br><span class="line">➜ cat .git/info/exclude </span><br><span class="line"><span class="meta">#</span><span class="bash"> git ls-files --others --exclude-from=.git/info/exclude</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Lines that start with <span class="string">'#'</span> are comments.</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> For a project mostly <span class="keyword">in</span> C, the following would be a good <span class="built_in">set</span> of</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> exclude patterns (uncomment them <span class="keyword">if</span> you want to use them):</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> *.[oa]</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> *~</span></span><br></pre></td></tr></table></figure>

<h3 id="1-3-2-核心功能"><a href="#1-3-2-核心功能" class="headerlink" title="1.3.2 核心功能"></a>1.3.2 核心功能</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> HEAD 文件，这意思，是指向refs文件夹吗？</span></span><br><span class="line">➜ cat .git/HEAD </span><br><span class="line">ref: refs/heads/master</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 那就先看refs里面有什么吧！</span></span><br><span class="line">➜  tmp git:(master) ls -alR .git/refs </span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  4 lewis  staff  128  3  4 09:53 .</span><br><span class="line">drwxr-xr-x  9 lewis  staff  288  3  4 10:34 ..</span><br><span class="line">drwxr-xr-x  2 lewis  staff   64  3  4 09:53 heads</span><br><span class="line">drwxr-xr-x  2 lewis  staff   64  3  4 09:53 tags</span><br><span class="line"></span><br><span class="line">.git/refs/heads:</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  2 lewis  staff   64  3  4 09:53 .</span><br><span class="line">drwxr-xr-x  4 lewis  staff  128  3  4 09:53 ..</span><br><span class="line"></span><br><span class="line">.git/refs/tags:</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  2 lewis  staff   64  3  4 09:53 .</span><br><span class="line">drwxr-xr-x  4 lewis  staff  128  3  4 09:53 ..</span><br><span class="line"><span class="meta">#</span><span class="bash"> refs里面有两个子文件夹，heads 和 tags，目前都是空的</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 有个heads，看来HEAD很可能是指向这个里面的</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> objects里面，也是两个空文件夹</span></span><br><span class="line">➜  tmp git:(master) ls -alR .git/objects </span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  4 lewis  staff  128  3  4 09:53 .</span><br><span class="line">drwxr-xr-x  9 lewis  staff  288  3  4 10:37 ..</span><br><span class="line">drwxr-xr-x  2 lewis  staff   64  3  4 09:53 info</span><br><span class="line">drwxr-xr-x  2 lewis  staff   64  3  4 09:53 pack</span><br><span class="line"></span><br><span class="line">.git/objects/info:</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  2 lewis  staff   64  3  4 09:53 .</span><br><span class="line">drwxr-xr-x  4 lewis  staff  128  3  4 09:53 ..</span><br><span class="line"></span><br><span class="line">.git/objects/pack:</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  2 lewis  staff   64  3  4 09:53 .</span><br><span class="line">drwxr-xr-x  4 lewis  staff  128  3  4 09:53 ..</span><br></pre></td></tr></table></figure>

<h1 id="2-初识git"><a href="#2-初识git" class="headerlink" title="2. 初识git"></a>2. 初识git</h1><h2 id="2-1-创建文件"><a href="#2-1-创建文件" class="headerlink" title="2.1 创建文件"></a>2.1 创建文件</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建一个空文件，取名为 hello.txt</span></span><br><span class="line">➜ touch hello.txt</span><br><span class="line">➜ ll</span><br><span class="line">total 0</span><br><span class="line">-rw-r--r--  1 lewis  staff     0B  3  4 10:46 hello.txt</span><br></pre></td></tr></table></figure>

<h2 id="2-2-交给git管理"><a href="#2-2-交给git管理" class="headerlink" title="2.2 交给git管理"></a>2.2 交给git管理</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 加到git中</span></span><br><span class="line">➜ git add hello.txt</span><br><span class="line"><span class="meta">#</span><span class="bash"> 此时，refs 和 objects无变化，但多出了一个index文件</span></span><br><span class="line">➜ ls -al .git/     </span><br><span class="line">total 32</span><br><span class="line">drwxr-xr-x  10 lewis  staff  320  3  4 10:47 .</span><br><span class="line">drwxr-xr-x   4 lewis  staff  128  3  4 10:46 ..</span><br><span class="line">-rw-r--r--   1 lewis  staff   23  3  4 09:53 HEAD</span><br><span class="line">-rw-r--r--   1 lewis  staff  137  3  4 09:53 config</span><br><span class="line">-rw-r--r--   1 lewis  staff   73  3  4 09:53 description</span><br><span class="line">drwxr-xr-x  13 lewis  staff  416  3  4 09:53 hooks</span><br><span class="line">-rw-r--r--   1 lewis  staff  104  3  4 10:47 index</span><br><span class="line">drwxr-xr-x   3 lewis  staff   96  3  4 09:53 info</span><br><span class="line">drwxr-xr-x   5 lewis  staff  160  3  4 10:47 objects</span><br><span class="line">drwxr-xr-x   4 lewis  staff  128  3  4 09:53 refs</span><br><span class="line">➜ cat .git/index </span><br><span class="line">DIRC^_????^_????YI?????⛲??CK?)?wZ???S?	hello.txt?kEO?</span><br><span class="line">                                                      ?Z.?!P?a?5e?8%</span><br><span class="line"><span class="meta">#</span><span class="bash"> index这个文件中有乱码，看来存的是二进制</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 能看到hello.txt，说明git add后，改动是存到这个文件的</span></span><br></pre></td></tr></table></figure>

<p><strong>结论一：</strong></p>
<blockquote>
<p>git add 指令，改动了「.git/index」这个文件。</p>
</blockquote>
<h2 id="2-3-提交为一个版本"><a href="#2-3-提交为一个版本" class="headerlink" title="2.3 提交为一个版本"></a>2.3 提交为一个版本</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 提交</span></span><br><span class="line">➜ git commit -m 'first file'</span><br><span class="line">[master (root-commit) 528022a] first file</span><br><span class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 hello.txt</span><br></pre></td></tr></table></figure>

<h2 id="2-4-初步分析"><a href="#2-4-初步分析" class="headerlink" title="2.4 初步分析"></a>2.4 初步分析</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 看看index，感觉有改动，但看不出来具体做了什么</span></span><br><span class="line">➜  tmp git:(master) cat .git/index </span><br><span class="line">DIRC^_????^_????YI?????⛲??CK?)?wZ???S?	hello.txtTREE1 0</span><br><span class="line">:1???[B??B???%                                                                                                                                      </span><br><span class="line"><span class="meta">#</span><span class="bash"> refs文件夹中，在heads里，多了一个master文件</span></span><br><span class="line">➜  tmp git:(master) ls -alR .git/refs</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x   4 lewis  staff  128  3  4 09:53 .</span><br><span class="line">drwxr-xr-x  12 lewis  staff  384  3  4 11:06 ..</span><br><span class="line">drwxr-xr-x   3 lewis  staff   96  3  4 10:48 heads</span><br><span class="line">drwxr-xr-x   2 lewis  staff   64  3  4 09:53 tags</span><br><span class="line"></span><br><span class="line">.git/refs/heads:</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  3 lewis  staff   96  3  4 10:48 .</span><br><span class="line">drwxr-xr-x  4 lewis  staff  128  3  4 09:53 ..</span><br><span class="line">-rw-r--r--  1 lewis  staff   41  3  4 10:48 master</span><br><span class="line"></span><br><span class="line">.git/refs/tags:</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  2 lewis  staff   64  3  4 09:53 .</span><br><span class="line">drwxr-xr-x  4 lewis  staff  128  3  4 09:53 ..</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> objects文件夹中，多了3个文件夹，每个文件夹里都出现了一个文件</span></span><br><span class="line">➜  tmp git:(master) ls -alR .git/objects    </span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x   7 lewis  staff  224  3  4 10:48 .</span><br><span class="line">drwxr-xr-x  12 lewis  staff  384  3  4 10:50 ..</span><br><span class="line">drwxr-xr-x   3 lewis  staff   96  3  4 10:48 52</span><br><span class="line">drwxr-xr-x   3 lewis  staff   96  3  4 10:47 e6</span><br><span class="line">drwxr-xr-x   3 lewis  staff   96  3  4 10:48 fc</span><br><span class="line">drwxr-xr-x   2 lewis  staff   64  3  4 09:53 info</span><br><span class="line">drwxr-xr-x   2 lewis  staff   64  3  4 09:53 pack</span><br><span class="line"></span><br><span class="line">.git/objects/52:</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  3 lewis  staff   96  3  4 10:48 .</span><br><span class="line">drwxr-xr-x  7 lewis  staff  224  3  4 10:48 ..</span><br><span class="line">-r--r--r--  1 lewis  staff  127  3  4 10:48 8022a97b413fae3f4a8cc0e308e5506a598ea3</span><br><span class="line"></span><br><span class="line">.git/objects/e6:</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  3 lewis  staff   96  3  4 10:47 .</span><br><span class="line">drwxr-xr-x  7 lewis  staff  224  3  4 10:48 ..</span><br><span class="line">-r--r--r--  1 lewis  staff   15  3  4 10:47 9de29bb2d1d6434b8b29ae775ad8c2e48c5391</span><br><span class="line"></span><br><span class="line">.git/objects/fc:</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  3 lewis  staff   96  3  4 10:48 .</span><br><span class="line">drwxr-xr-x  7 lewis  staff  224  3  4 10:48 ..</span><br><span class="line">-r--r--r--  1 lewis  staff   54  3  4 10:48 b545d5746547a597811b7441ed8eba307be1ff</span><br><span class="line"></span><br><span class="line">.git/objects/info:</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  2 lewis  staff   64  3  4 09:53 .</span><br><span class="line">drwxr-xr-x  7 lewis  staff  224  3  4 10:48 ..</span><br><span class="line"></span><br><span class="line">.git/objects/pack:</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  2 lewis  staff   64  3  4 09:53 .</span><br><span class="line">drwxr-xr-x  7 lewis  staff  224  3  4 10:48 ..</span><br></pre></td></tr></table></figure>

<p><strong>结论二：</strong></p>
<blockquote>
<p>git commit时，对「.git/index」文件有改动；</p>
<p>git commit时，在「.git/objects」文件夹下，会增加文件；</p>
</blockquote>
<h2 id="2-5-引用分析"><a href="#2-5-引用分析" class="headerlink" title="2.5 引用分析"></a>2.5 引用分析</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 有没有发现，refs里面多出来的文件，正是HEAD文件所指向的？</span></span><br><span class="line">➜ cat .git/HEAD </span><br><span class="line">ref: refs/heads/master</span><br><span class="line">➜ ls -al .git/refs/heads/master </span><br><span class="line">-rw-r--r--  1 lewis  staff  41  3  4 10:48 .git/refs/heads/master</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 那这个master文件里面又存了什么？</span></span><br><span class="line">➜  tmp git:(master) cat .git/refs/heads/master </span><br><span class="line">528022a97b413fae3f4a8cc0e308e5506a598ea3</span><br><span class="line"><span class="meta">#</span><span class="bash"> 看着有点眼熟，确认一下</span></span><br><span class="line">➜  tmp git:(master) ls -al .git/objects/52/8022a97b413fae3f4a8cc0e308e5506a598ea3 </span><br><span class="line">-r--r--r--  1 lewis  staff  127  3  4 10:48 .git/objects/52/8022a97b413fae3f4a8cc0e308e5506a598ea3</span><br></pre></td></tr></table></figure>

<p><strong>结论三：</strong></p>
<blockquote>
<p>「.git/HEAD」是一个指针文件，可以指向「.git/refs」中的文件；</p>
<p>「.git/refs/heads/master」文件也是一个指针，指向「.git/objects」里面的一个文件；</p>
</blockquote>
<h2 id="2-6-对象分析"><a href="#2-6-对象分析" class="headerlink" title="2.6 对象分析"></a>2.6 对象分析</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 用了个不熟悉的命令，它是查看这一串对象中存储内容的一个指令</span></span><br><span class="line">➜ git cat-file -p 528022a97b413fae3f4a8cc0e308e5506a598ea3</span><br><span class="line">tree fcb545d5746547a597811b7441ed8eba307be1ff</span><br><span class="line">author Lewis &lt;fangniude@gmail.com&gt; 1583290125 +0800</span><br><span class="line">committer Lewis &lt;fangniude@gmail.com&gt; 1583290125 +0800</span><br><span class="line"></span><br><span class="line">first file</span><br></pre></td></tr></table></figure>

<ul>
<li>可以看到，文件中有<code>committer</code>和<code>first file</code>，说明这个对象存储的是commit的信息，就叫它<code>commit对象</code>吧</li>
<li>还有一个<code>tree</code>，指向了另一个对象，那就叫它<code>tree对象</code>吧</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 看看 tree对象 中存了什么</span></span><br><span class="line">➜ git cat-file -p fcb545d5746547a597811b7441ed8eba307be1ff</span><br><span class="line">100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	hello.txt</span><br></pre></td></tr></table></figure>

<ul>
<li><code>tree对象</code> 指向了第3个对象，感觉就是我们刚才新建的<code>hello.txt</code>文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 看看hello.txt 文件</span></span><br><span class="line">➜  git cat-file -p e69de29bb2d1d6434b8b29ae775ad8c2e48c5391</span><br></pre></td></tr></table></figure>

<ul>
<li>这个文件里面是空的，我们刚才的确没有写内容进去</li>
</ul>
<p><strong>结论四：</strong></p>
<blockquote>
<p>「.git/objects」里面，会存储commit对象、tree对象 和 blob对象；</p>
<p>commit对象，对应的是一个commit，会指向一个tree对象；</p>
<p>tree对象对应的是文件夹，还存储了其中文件的名字 和 这些文件的指针；</p>
<p>blob对象存储文件的内容</p>
</blockquote>
<h2 id="2-7-第1次提交图"><a href="#2-7-第1次提交图" class="headerlink" title="2.7 第1次提交图"></a>2.7 第1次提交图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line"></span><br><span class="line">T1[&#x2F;第1次提交tree&#x2F;] --&gt;|hello.txt| F1(空文件)</span><br><span class="line">C1[第1次提交] --&gt;T1</span><br><span class="line"></span><br><span class="line">M((master)) -.-&gt; C1</span><br><span class="line">H((HEAD)) -.-&gt; M</span><br></pre></td></tr></table></figure>

<h2 id="2-8-第2次提交"><a href="#2-8-第2次提交" class="headerlink" title="2.8 第2次提交"></a>2.8 第2次提交</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 再建一个空的文件</span></span><br><span class="line">➜ touch hello.copy</span><br><span class="line"><span class="meta">#</span><span class="bash"> 交给git管理</span></span><br><span class="line">➜ git add hello.copy </span><br><span class="line"><span class="meta">#</span><span class="bash"> 提交</span></span><br><span class="line">➜ git commit -m 'add hello.copy'</span><br><span class="line">[master 9222323] add hello.copy</span><br><span class="line"> 1 file changed, 0 insertions(+), 0 deletions(-)</span><br><span class="line"> create mode 100644 hello.copy</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 继续分析，master文件指向的对象变了</span></span><br><span class="line">➜ cat .git/refs/heads/master </span><br><span class="line">92223238a21c13bec2663fe349e8ea1dbfab97bb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这是新的commit对象，除了指向tree对象之外，还指向了一个parent</span></span><br><span class="line">➜ git cat-file -p 92223238a21c13bec2663fe349e8ea1dbfab97bb</span><br><span class="line">tree 598293c40ffff2b5d26ab7f9d78601e8d8d05d94</span><br><span class="line">parent 528022a97b413fae3f4a8cc0e308e5506a598ea3</span><br><span class="line">author Lewis &lt;fangniude@gmail.com&gt; 1583295073 +0800</span><br><span class="line">committer Lewis &lt;fangniude@gmail.com&gt; 1583295073 +0800</span><br><span class="line"></span><br><span class="line">add hello.copy</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> parent对象就是上一次commit</span></span><br><span class="line">➜  tmp git:(master) git cat-file -p 528022a97b413fae3f4a8cc0e308e5506a598ea3</span><br><span class="line">tree fcb545d5746547a597811b7441ed8eba307be1ff</span><br><span class="line">author Lewis &lt;fangniude@gmail.com&gt; 1583290125 +0800</span><br><span class="line">committer Lewis &lt;fangniude@gmail.com&gt; 1583290125 +0800</span><br><span class="line"></span><br><span class="line">first file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> tree对象里面，有了两个文件，两个文件指向了同一个blob对象</span></span><br><span class="line">➜  tmp git:(master) git cat-file -p 598293c40ffff2b5d26ab7f9d78601e8d8d05d94</span><br><span class="line">100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	hello.copy</span><br><span class="line">100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	hello.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 不妨看看此时的objects，变成5个对象，多了一个commit对象 和 一个tree对象</span></span><br><span class="line">➜  tmp git:(master) ls -alR .git/objects</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x   9 lewis  staff  288  3  4 12:11 .</span><br><span class="line">drwxr-xr-x  12 lewis  staff  384  3  4 12:29 ..</span><br><span class="line">drwxr-xr-x   3 lewis  staff   96  3  4 10:48 52</span><br><span class="line">drwxr-xr-x   3 lewis  staff   96  3  4 12:11 59</span><br><span class="line">drwxr-xr-x   3 lewis  staff   96  3  4 12:11 92</span><br><span class="line">drwxr-xr-x   3 lewis  staff   96  3  4 10:47 e6</span><br><span class="line">drwxr-xr-x   3 lewis  staff   96  3  4 10:48 fc</span><br><span class="line">drwxr-xr-x   2 lewis  staff   64  3  4 09:53 info</span><br><span class="line">drwxr-xr-x   2 lewis  staff   64  3  4 09:53 pack</span><br><span class="line"></span><br><span class="line">.git/objects/52:</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  3 lewis  staff   96  3  4 10:48 .</span><br><span class="line">drwxr-xr-x  9 lewis  staff  288  3  4 12:11 ..</span><br><span class="line">-r--r--r--  1 lewis  staff  127  3  4 10:48 8022a97b413fae3f4a8cc0e308e5506a598ea3</span><br><span class="line"></span><br><span class="line">.git/objects/59:</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  3 lewis  staff   96  3  4 12:11 .</span><br><span class="line">drwxr-xr-x  9 lewis  staff  288  3  4 12:11 ..</span><br><span class="line">-r--r--r--  1 lewis  staff   63  3  4 12:11 8293c40ffff2b5d26ab7f9d78601e8d8d05d94</span><br><span class="line"></span><br><span class="line">.git/objects/92:</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  3 lewis  staff   96  3  4 12:11 .</span><br><span class="line">drwxr-xr-x  9 lewis  staff  288  3  4 12:11 ..</span><br><span class="line">-r--r--r--  1 lewis  staff  160  3  4 12:11 223238a21c13bec2663fe349e8ea1dbfab97bb</span><br><span class="line"></span><br><span class="line">.git/objects/e6:</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  3 lewis  staff   96  3  4 10:47 .</span><br><span class="line">drwxr-xr-x  9 lewis  staff  288  3  4 12:11 ..</span><br><span class="line">-r--r--r--  1 lewis  staff   15  3  4 12:11 9de29bb2d1d6434b8b29ae775ad8c2e48c5391</span><br><span class="line"></span><br><span class="line">.git/objects/fc:</span><br><span class="line">total 8</span><br><span class="line">drwxr-xr-x  3 lewis  staff   96  3  4 10:48 .</span><br><span class="line">drwxr-xr-x  9 lewis  staff  288  3  4 12:11 ..</span><br><span class="line">-r--r--r--  1 lewis  staff   54  3  4 10:48 b545d5746547a597811b7441ed8eba307be1ff</span><br><span class="line"></span><br><span class="line">.git/objects/info:</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  2 lewis  staff   64  3  4 09:53 .</span><br><span class="line">drwxr-xr-x  9 lewis  staff  288  3  4 12:11 ..</span><br><span class="line"></span><br><span class="line">.git/objects/pack:</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  2 lewis  staff   64  3  4 09:53 .</span><br><span class="line">drwxr-xr-x  9 lewis  staff  288  3  4 12:11 ..</span><br></pre></td></tr></table></figure>

<p><strong>结论五：</strong></p>
<blockquote>
<p>增加一个commit后，master这个指针会指向新的commit；</p>
<p>commit对象可以指向其parent，即上一次提交；</p>
<p>同一个文件(内容相同的对象)只存储一份；</p>
</blockquote>
<h2 id="2-9-第2次提交图"><a href="#2-9-第2次提交图" class="headerlink" title="2.9 第2次提交图"></a>2.9 第2次提交图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">T1[&#x2F;第1次提交tree&#x2F;] --&gt;|hello.txt| F1(空文件)</span><br><span class="line">C1[第1次提交] --&gt;T1</span><br><span class="line"></span><br><span class="line">T2[&#x2F;第2次提交tree&#x2F;] --&gt;|hello.txt| F1</span><br><span class="line">T2 --&gt;|hell.copy| F1</span><br><span class="line">C2[第2次提交] --&gt;T2</span><br><span class="line"></span><br><span class="line">C2 --&gt;C1</span><br><span class="line"></span><br><span class="line">M((master)) -.-&gt; C2</span><br><span class="line">H((HEAD)) -.-&gt; M</span><br></pre></td></tr></table></figure>

<h1 id="3-分支branch"><a href="#3-分支branch" class="headerlink" title="3. 分支branch"></a>3. 分支branch</h1><h2 id="3-1-建dev分支"><a href="#3-1-建dev分支" class="headerlink" title="3.1 建dev分支"></a>3.1 建dev分支</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 看看当前有哪些分支</span></span><br><span class="line">➜ git branch</span><br><span class="line">* master</span><br><span class="line">(END)</span><br><span class="line"><span class="meta">#</span><span class="bash"> 看到只有一个master分支，前面有个`*`代表当前在这个分支</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建dev分支</span></span><br><span class="line">➜ git branch dev</span><br><span class="line">➜ git branch</span><br><span class="line">  dev</span><br><span class="line">* master</span><br><span class="line">(END)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到dev分支</span></span><br><span class="line">➜ git checkout dev</span><br><span class="line">Switched to branch 'dev'</span><br><span class="line">➜ git branch</span><br><span class="line">* dev</span><br><span class="line">  master</span><br><span class="line">(END)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 看看现在HEAD在哪儿？</span></span><br><span class="line">➜ cat .git/HEAD </span><br><span class="line">ref: refs/heads/dev</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 多出来一个dev文件，其中的内容 和 master完成一样</span></span><br><span class="line">➜ cat .git/refs/heads/dev </span><br><span class="line">92223238a21c13bec2663fe349e8ea1dbfab97bb</span><br><span class="line">➜ cat .git/refs/heads/master</span><br><span class="line">92223238a21c13bec2663fe349e8ea1dbfab97bb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 看看 .git/refs/heads 文件夹下的内容</span></span><br><span class="line">➜ ls -al .git/refs/heads </span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x  4 lewis  staff  128  3  4 14:31 .</span><br><span class="line">drwxr-xr-x  4 lewis  staff  128  3  4 09:53 ..</span><br><span class="line">-rw-r--r--  1 lewis  staff   41  3  4 14:31 dev</span><br><span class="line">-rw-r--r--  1 lewis  staff   41  3  4 12:11 master</span><br></pre></td></tr></table></figure>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">T1[&#x2F;第1次提交tree&#x2F;] --&gt;|hello.txt| F1(空文件)</span><br><span class="line">C1[第1次提交] --&gt;T1</span><br><span class="line"></span><br><span class="line">T2[&#x2F;第2次提交tree&#x2F;] --&gt;|hello.txt| F1</span><br><span class="line">T2 --&gt;|hell.copy| F1</span><br><span class="line">C2[第2次提交] --&gt;T2</span><br><span class="line"></span><br><span class="line">C2 --&gt;C1</span><br><span class="line"></span><br><span class="line">M((master)) -.-&gt; C2</span><br><span class="line">D((dev)) -.-&gt; C2</span><br><span class="line">H((HEAD)) -.-&gt; D</span><br></pre></td></tr></table></figure>

<p><strong>结论六：</strong></p>
<blockquote>
<p>分支是通过「refs/heads」下面的文件来管理，一个文件一个分支；</p>
<p>HEAD 指向哪儿，代表当前在哪个分支</p>
</blockquote>
<h2 id="3-2-dev分支提交"><a href="#3-2-dev分支提交" class="headerlink" title="3.2 dev分支提交"></a>3.2 dev分支提交</h2><p><strong>注意：</strong> 为了简化，我们在dev分支，先退回「第1次提交」，然后再做「第3次提交」</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 回到第1次提交</span></span><br><span class="line">➜ git reset --hard 528022a97b413fae3f4a8cc0e308e5506a598ea3</span><br><span class="line">HEAD is now at 528022a first file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 验证一下，的确只有一个文件</span></span><br><span class="line">➜  tmp git:(dev) ls -al</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x    4 lewis  staff   128  3  4 14:54 .</span><br><span class="line">drwxr-xr-x+ 128 lewis  staff  4096  3  4 14:55 ..</span><br><span class="line">drwxr-xr-x   13 lewis  staff   416  3  4 14:55 .git</span><br><span class="line">-rw-r--r--    1 lewis  staff     0  3  4 10:46 hello.txt</span><br></pre></td></tr></table></figure>

<p>然后，增加一个文件夹，并在其中增加个文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 新建 testBranch文件夹</span></span><br><span class="line">➜ mkdir testBranch</span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加个有内容的文件</span></span><br><span class="line">➜ echo 'this is dev file' &gt; testBranch/devAdd.txt</span><br><span class="line"><span class="meta">#</span><span class="bash"> 确认下，文件添加成功了，其中有内容</span></span><br><span class="line">➜ cat testBranch/devAdd.txt </span><br><span class="line">this is dev file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 加到index中</span></span><br><span class="line">➜ git add testBranch/devAdd.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 第3次提交</span></span><br><span class="line">➜ git commit -m 'third commit'</span><br><span class="line">[dev 1616454] third commit</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 testBranch/devAdd.txt</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash"> 当前是怎么样的呢？</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 先看HEAD，还是指向dev</span></span><br><span class="line">➜  tmp git:(dev) cat .git/HEAD </span><br><span class="line">ref: refs/heads/dev</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> dev指向了第3次提交</span></span><br><span class="line">➜  tmp git:(dev) cat .git/refs/heads/dev </span><br><span class="line">161645439e35c5db8f4755641ca98815c69a9d63</span><br><span class="line">➜  tmp git:(dev) git cat-file -p 161645439e35c5db8f4755641ca98815c69a9d63</span><br><span class="line">tree fb54f679949f2593bb83d4179f8c7d058393235c</span><br><span class="line">parent 528022a97b413fae3f4a8cc0e308e5506a598ea3</span><br><span class="line">author Lewis &lt;fangniude@gmail.com&gt; 1583306810 +0800</span><br><span class="line">committer Lewis &lt;fangniude@gmail.com&gt; 1583306810 +0800</span><br><span class="line"></span><br><span class="line">third commit</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 第3次提交的parent，是第1次提交，没毛病</span></span><br><span class="line">➜  tmp git:(dev) git cat-file -p 528022a97b413fae3f4a8cc0e308e5506a598ea3</span><br><span class="line">tree fcb545d5746547a597811b7441ed8eba307be1ff</span><br><span class="line">author Lewis &lt;fangniude@gmail.com&gt; 1583290125 +0800</span><br><span class="line">committer Lewis &lt;fangniude@gmail.com&gt; 1583290125 +0800</span><br><span class="line"></span><br><span class="line">first file</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 第3次提交的tree对象中，除了第1次提交的hello.txt外，还有一个tree对象，指向testBranch</span></span><br><span class="line">➜  tmp git:(dev) git cat-file -p fb54f679949f2593bb83d4179f8c7d058393235c</span><br><span class="line">100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	hello.txt</span><br><span class="line">040000 tree ba015591b2652a669fc5892ff58023af8482e8c3	testBranch</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> testBranch这个对象，包含1个blob对象，即devAdd.txt这个文件</span></span><br><span class="line">➜  tmp git:(dev) git cat-file -p ba015591b2652a669fc5892ff58023af8482e8c3</span><br><span class="line">100644 blob 101ff992f2995edf65ee71ebee38b7ba412555cf	devAdd.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个文件中的内容，是刚才输入的文字</span></span><br><span class="line">➜  tmp git:(dev) git cat-file -p 101ff992f2995edf65ee71ebee38b7ba412555cf</span><br><span class="line">this is dev file</span><br></pre></td></tr></table></figure>

<p>看看现在的图：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">T1[&#x2F;第1次提交tree&#x2F;] --&gt;|hello.txt| F1(空文件)</span><br><span class="line">C1[第1次提交] --&gt;T1</span><br><span class="line"></span><br><span class="line">T2[&#x2F;第2次提交tree&#x2F;] --&gt;|hello.txt| F1</span><br><span class="line">T2 --&gt;|hell.copy| F1</span><br><span class="line">C2[第2次提交] --&gt;T2</span><br><span class="line">C2 --&gt;C1</span><br><span class="line"></span><br><span class="line">T3[&#x2F;testBranch的tree&#x2F;] --&gt;F2(devAdd.txt)</span><br><span class="line">T4[&#x2F;第3次提交tree&#x2F;] --&gt;|hello.txt| F1</span><br><span class="line">T4 --&gt; T3</span><br><span class="line">C3[第3次提交] --&gt; T4</span><br><span class="line"></span><br><span class="line">M((master)) -.-&gt; C2</span><br><span class="line">D((dev)) -.-&gt; C3</span><br><span class="line">H((HEAD)) -.-&gt; D</span><br></pre></td></tr></table></figure>

<p><strong>结论七：</strong></p>
<blockquote>
<p>分支就是个引用（或 指针），可以随便指向哪个对象；</p>
<p>在引用改变的时候，对象不用动；</p>
<p>每一次提交，都会生成一个新的「提交tree」；</p>
<p>文件夹是通过「tree对象」管理版本的，tree对象可以指向tree对象 和 blob对象</p>
</blockquote>
<h2 id="3-3-分支合并"><a href="#3-3-分支合并" class="headerlink" title="3.3 分支合并"></a>3.3 分支合并</h2><p>将dev分支的，合并到master分支。</p>
<h3 id="3-3-1-merge合并"><a href="#3-3-1-merge合并" class="headerlink" title="3.3.1 merge合并"></a>3.3.1 merge合并</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 切回master分支</span></span><br><span class="line">➜ git checkout master</span><br><span class="line">Switched to branch 'master'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从dev分支merge过来</span></span><br><span class="line">➜ git merge dev</span><br><span class="line">Merge made by the 'recursive' strategy.</span><br><span class="line"> testBranch/devAdd.txt | 1 +</span><br><span class="line"> 1 file changed, 1 insertion(+)</span><br><span class="line"> create mode 100644 testBranch/devAdd.txt</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 来看现在是怎么样的，还是从HEAD开始</span></span><br><span class="line">➜ cat .git/HEAD</span><br><span class="line">ref: refs/heads/master</span><br><span class="line"><span class="meta">#</span><span class="bash"> 看看master里面，指向了一个新的merge commit，它有2个parent</span></span><br><span class="line">➜ cat .git/refs/heads/master </span><br><span class="line">bb6c11e29dcc8865f9c8eae2da89750fd29bf005</span><br><span class="line">➜ git cat-file -p bb6c11e29dcc8865f9c8eae2da89750fd29bf005</span><br><span class="line">tree 202b85d575214f94ed494ee026e8b2cdb4fcab4f</span><br><span class="line">parent 92223238a21c13bec2663fe349e8ea1dbfab97bb</span><br><span class="line">parent 161645439e35c5db8f4755641ca98815c69a9d63</span><br><span class="line">author Lewis &lt;fangniude@gmail.com&gt; 1583313790 +0800</span><br><span class="line">committer Lewis &lt;fangniude@gmail.com&gt; 1583313790 +0800</span><br><span class="line"></span><br><span class="line">Merge branch 'dev'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 第1个parent是 第2次提交</span></span><br><span class="line">➜ git cat-file -p 92223238a21c13bec2663fe349e8ea1dbfab97bb</span><br><span class="line">tree 598293c40ffff2b5d26ab7f9d78601e8d8d05d94</span><br><span class="line">parent 528022a97b413fae3f4a8cc0e308e5506a598ea3</span><br><span class="line">author Lewis &lt;fangniude@gmail.com&gt; 1583295073 +0800</span><br><span class="line">committer Lewis &lt;fangniude@gmail.com&gt; 1583295073 +0800</span><br><span class="line"></span><br><span class="line">add hello.copy</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 第2个parent是 第3次提交</span></span><br><span class="line">➜ git cat-file -p 161645439e35c5db8f4755641ca98815c69a9d63</span><br><span class="line">tree fb54f679949f2593bb83d4179f8c7d058393235c</span><br><span class="line">parent 528022a97b413fae3f4a8cc0e308e5506a598ea3</span><br><span class="line">author Lewis &lt;fangniude@gmail.com&gt; 1583306810 +0800</span><br><span class="line">committer Lewis &lt;fangniude@gmail.com&gt; 1583306810 +0800</span><br><span class="line"></span><br><span class="line">third commit</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 当然，它还指向了第4次提交的树，其中有原来master 和 dev所有的文件</span></span><br><span class="line">➜ git cat-file -p 202b85d575214f94ed494ee026e8b2cdb4fcab4f</span><br><span class="line">100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	hello.copy</span><br><span class="line">100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	hello.txt</span><br><span class="line">040000 tree ba015591b2652a669fc5892ff58023af8482e8c3	testBranch</span><br></pre></td></tr></table></figure>

<p><strong>现在的图，是这样的：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">T1[&#x2F;第1次提交tree&#x2F;] --&gt;|hello.txt| F1(空文件)</span><br><span class="line">C1[第1次提交] --&gt;T1</span><br><span class="line"></span><br><span class="line">T2[&#x2F;第2次提交tree&#x2F;] --&gt;|hello.txt| F1</span><br><span class="line">T2 --&gt;|hell.copy| F1</span><br><span class="line">C2[第2次提交] --&gt;T2</span><br><span class="line">C2 --&gt;C1</span><br><span class="line"></span><br><span class="line">T3[&#x2F;testBranch的tree&#x2F;] --&gt;F2(devAdd.txt)</span><br><span class="line">T4[&#x2F;第3次提交tree&#x2F;] --&gt;|hello.txt| F1</span><br><span class="line">T4 --&gt; T3</span><br><span class="line">C3[第3次提交] --&gt; T4</span><br><span class="line"></span><br><span class="line">T5[&#x2F;第4次提交tree&#x2F;] --&gt;|hello.txt|F1</span><br><span class="line">T5 --&gt;|hello.copy|F1</span><br><span class="line">T5 --&gt;T3</span><br><span class="line">C4[第4次提交]--&gt;T5</span><br><span class="line">C4 --&gt; C2</span><br><span class="line">C4 --&gt; C3</span><br><span class="line"></span><br><span class="line">M((master)) -.-&gt; C4</span><br><span class="line">D((dev)) -.-&gt; C3</span><br><span class="line">H((HEAD)) -.-&gt; M</span><br></pre></td></tr></table></figure>


<h3 id="3-3-2-rebase合并"><a href="#3-3-2-rebase合并" class="headerlink" title="3.3.2 rebase合并"></a>3.3.2 rebase合并</h3><p><strong>思路：</strong>dev基于master合并，开发中最常用的工作模式。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 需要先回滚刚才的操作</span></span><br><span class="line">➜ git reset --hard 92223238a21c13bec2663fe349e8ea1dbfab97bb</span><br><span class="line">HEAD is now at 9222323 add hello.copy</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到dev分支</span></span><br><span class="line">➜ git checkout dev</span><br><span class="line">Switched to branch 'dev'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 执行rebase</span></span><br><span class="line">➜ git rebase master</span><br><span class="line">First, rewinding head to replay your work on top of it...</span><br><span class="line">Applying: third commit</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 然后，一起来看效果吧，dev有了一个新的commit</span></span><br><span class="line">➜ cat .git/refs/heads/dev </span><br><span class="line">6b4df1e31ed4c652f790841f46f30c34abb65c8c</span><br><span class="line">➜  tmp git:(dev) git cat-file -p 6b4df1e31ed4c652f790841f46f30c34abb65c8c</span><br><span class="line">tree 202b85d575214f94ed494ee026e8b2cdb4fcab4f</span><br><span class="line">parent 92223238a21c13bec2663fe349e8ea1dbfab97bb</span><br><span class="line">author Lewis &lt;fangniude@gmail.com&gt; 1583306810 +0800</span><br><span class="line">committer Lewis &lt;fangniude@gmail.com&gt; 1583315190 +0800</span><br><span class="line"></span><br><span class="line">third commit</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个commit的parent，是master指向的那次提交，即第2次提交</span></span><br><span class="line">➜  tmp git:(dev) cat .git/refs/heads/master </span><br><span class="line">92223238a21c13bec2663fe349e8ea1dbfab97bb</span><br><span class="line">➜  tmp git:(dev) git cat-file -p 92223238a21c13bec2663fe349e8ea1dbfab97bb</span><br><span class="line">tree 598293c40ffff2b5d26ab7f9d78601e8d8d05d94</span><br><span class="line">parent 528022a97b413fae3f4a8cc0e308e5506a598ea3</span><br><span class="line">author Lewis &lt;fangniude@gmail.com&gt; 1583295073 +0800</span><br><span class="line">committer Lewis &lt;fangniude@gmail.com&gt; 1583295073 +0800</span><br><span class="line"></span><br><span class="line">add hello.copy</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 当然，它指向的树对象，居然是刚才merge时，第4次提交的树对象，因为内容一致，直接重用了</span></span><br><span class="line">➜ git cat-file -p 202b85d575214f94ed494ee026e8b2cdb4fcab4f</span><br><span class="line">100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	hello.copy</span><br><span class="line">100644 blob e69de29bb2d1d6434b8b29ae775ad8c2e48c5391	hello.txt</span><br><span class="line">040000 tree ba015591b2652a669fc5892ff58023af8482e8c3	testBranch</span><br></pre></td></tr></table></figure>

<p><strong>下面是现在的图：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">T1[&#x2F;第1次提交tree&#x2F;] --&gt;|hello.txt| F1(空文件)</span><br><span class="line">C1[第1次提交] --&gt;T1</span><br><span class="line"></span><br><span class="line">T2[&#x2F;第2次提交tree&#x2F;] --&gt;|hello.txt| F1</span><br><span class="line">T2 --&gt;|hell.copy| F1</span><br><span class="line">C2[第2次提交] --&gt;T2</span><br><span class="line">C2 --&gt;C1</span><br><span class="line"></span><br><span class="line">T3[&#x2F;testBranch的tree&#x2F;] --&gt;F2(devAdd.txt)</span><br><span class="line">T5[&#x2F;第5次提交tree&#x2F;] --&gt;|hello.txt| F1</span><br><span class="line">T5[&#x2F;第5次提交tree&#x2F;] --&gt;|hello.copy| F1</span><br><span class="line">T5 --&gt; T3</span><br><span class="line">C5[第5次提交] --&gt; T5</span><br><span class="line">C5 --&gt; C2</span><br><span class="line"></span><br><span class="line">M((master)) -.-&gt; C2</span><br><span class="line">D((dev)) -.-&gt; C5</span><br><span class="line">H((HEAD)) -.-&gt; D</span><br></pre></td></tr></table></figure>

<h1 id="4-标签tag"><a href="#4-标签tag" class="headerlink" title="4. 标签tag"></a>4. 标签tag</h1><p>我们给第2次提交，打个2.0标签，第5次提交打个3.0标签。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 当前在dev分支，即5次提交</span></span><br><span class="line">➜ git tag -a 3.0 -m 'this is 3.0'</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到master分支，即第2次提交</span></span><br><span class="line">➜ git checkout master</span><br><span class="line">Switched to branch 'master'</span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个偷个懒，不带什么参数</span></span><br><span class="line">➜ git tag 2.0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 可以看到，两个tag打好了</span></span><br><span class="line">➜ git tag --list</span><br><span class="line">2.0</span><br><span class="line">3.0</span><br><span class="line">(END)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 再看看refs/tags吧</span></span><br><span class="line">➜ ls -al .git/refs/tags </span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x  4 lewis  staff  128  3  4 18:17 .</span><br><span class="line">drwxr-xr-x  4 lewis  staff  128  3  4 09:53 ..</span><br><span class="line">-rw-r--r--  1 lewis  staff   41  3  4 18:16 2.0</span><br><span class="line">-rw-r--r--  1 lewis  staff   41  3  4 18:17 3.0</span><br></pre></td></tr></table></figure>

<h2 id="4-1-轻量的tag"><a href="#4-1-轻量的tag" class="headerlink" title="4.1 轻量的tag"></a>4.1 轻量的tag</h2><p>我们先来看2.0这个tag。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 和分支一样，2.0这个tag里面，也是存了一个引用</span></span><br><span class="line">➜ cat .git/refs/tags/2.0 </span><br><span class="line">92223238a21c13bec2663fe349e8ea1dbfab97bb</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指向的是第2次提交，就像现在的master一样</span></span><br><span class="line">➜ git cat-file -p 92223238a21c13bec2663fe349e8ea1dbfab97bb</span><br><span class="line">tree 598293c40ffff2b5d26ab7f9d78601e8d8d05d94</span><br><span class="line">parent 528022a97b413fae3f4a8cc0e308e5506a598ea3</span><br><span class="line">author Lewis &lt;fangniude@gmail.com&gt; 1583295073 +0800</span><br><span class="line">committer Lewis &lt;fangniude@gmail.com&gt; 1583295073 +0800</span><br><span class="line"></span><br><span class="line">add hello.copy</span><br></pre></td></tr></table></figure>

<h2 id="4-2-重量的tag"><a href="#4-2-重量的tag" class="headerlink" title="4.2 重量的tag"></a>4.2 重量的tag</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 这个也类似</span></span><br><span class="line">➜ cat .git/refs/tags/3.0 </span><br><span class="line">87c71f8bfbbb86ffae62f61f322084654932f85a</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 但它指向了一个没有见过的对象，能看到刚才输入的信息，它指向了另一个object</span></span><br><span class="line">➜ git cat-file -p 87c71f8bfbbb86ffae62f61f322084654932f85a</span><br><span class="line">object 6b4df1e31ed4c652f790841f46f30c34abb65c8c</span><br><span class="line">type commit</span><br><span class="line">tag 3.0</span><br><span class="line">tagger Lewis &lt;fangniude@gmail.com&gt; 1583317040 +0800</span><br><span class="line"></span><br><span class="line">this is 3.0</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 指向了谁呢？当然是第5次提交了</span></span><br><span class="line">➜ git cat-file -p 6b4df1e31ed4c652f790841f46f30c34abb65c8c</span><br><span class="line">tree 202b85d575214f94ed494ee026e8b2cdb4fcab4f</span><br><span class="line">parent 92223238a21c13bec2663fe349e8ea1dbfab97bb</span><br><span class="line">author Lewis &lt;fangniude@gmail.com&gt; 1583306810 +0800</span><br><span class="line">committer Lewis &lt;fangniude@gmail.com&gt; 1583315190 +0800</span><br><span class="line"></span><br><span class="line">third commit</span><br></pre></td></tr></table></figure>

<h2 id="4-3-有tag的图"><a href="#4-3-有tag的图" class="headerlink" title="4.3 有tag的图"></a>4.3 有tag的图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line"></span><br><span class="line">%% 第1次提交</span><br><span class="line">T1[&#x2F;第1次提交tree&#x2F;] --&gt;|hello.txt| F1(空文件)</span><br><span class="line">C1[第1次提交] --&gt;T1</span><br><span class="line"></span><br><span class="line">%% 第2次提交</span><br><span class="line">T2[&#x2F;第2次提交tree&#x2F;] --&gt;|hello.txt| F1</span><br><span class="line">T2 --&gt;|hell.copy| F1</span><br><span class="line">C2[第2次提交] --&gt;T2</span><br><span class="line">C2 --&gt;C1</span><br><span class="line"></span><br><span class="line">%% 第5次提交</span><br><span class="line">T3[&#x2F;testBranch的tree&#x2F;] --&gt;F2(devAdd.txt)</span><br><span class="line">T5[&#x2F;第5次提交tree&#x2F;] --&gt;|hello.txt| F1</span><br><span class="line">T5[&#x2F;第5次提交tree&#x2F;] --&gt;|hello.copy| F1</span><br><span class="line">T5 --&gt; T3</span><br><span class="line">C5[第5次提交] --&gt; T5</span><br><span class="line">C5 --&gt; C2</span><br><span class="line"></span><br><span class="line">%% 分支</span><br><span class="line">M((master)) -.-&gt; C2</span><br><span class="line">D((dev)) -.-&gt; C5</span><br><span class="line">H((HEAD)) -.-&gt; M</span><br><span class="line"></span><br><span class="line">%% tag</span><br><span class="line">2((2.0)) -.-&gt;C2</span><br><span class="line">TAG&gt;Tag对象]--&gt;C5</span><br><span class="line">3((3.0)) -.-&gt;TAG</span><br></pre></td></tr></table></figure>

<h1 id="5-时光机"><a href="#5-时光机" class="headerlink" title="5. 时光机"></a>5. 时光机</h1><h1 id="6-远程remote"><a href="#6-远程remote" class="headerlink" title="6. 远程remote"></a>6. 远程remote</h1><h1 id="7-总结"><a href="#7-总结" class="headerlink" title="7. 总结"></a>7. 总结</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/%E5%8F%91%E8%A1%8C%E5%8F%AF%E8%BD%AC%E5%80%BA%E6%97%B6%EF%BC%8C%E4%B8%8A%E5%B8%82%E5%85%AC%E5%8F%B8%E6%98%AF%E6%80%8E%E4%B9%88%E6%83%B3%E7%9A%84%EF%BC%9F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E5%8F%91%E8%A1%8C%E5%8F%AF%E8%BD%AC%E5%80%BA%E6%97%B6%EF%BC%8C%E4%B8%8A%E5%B8%82%E5%85%AC%E5%8F%B8%E6%98%AF%E6%80%8E%E4%B9%88%E6%83%B3%E7%9A%84%EF%BC%9F/" class="post-title-link" itemprop="url">发行可转债时，上市公司是怎么想的？</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-01 17:06:12" itemprop="dateCreated datePublished" datetime="2020-03-01T17:06:12+08:00">2020-03-01</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-发债前"><a href="#1-发债前" class="headerlink" title="1. 发债前"></a>1. 发债前</h2><ul>
<li>背景<ul>
<li>嗯，这个项目挺好，值得尝试</li>
<li>一看账户，好像没钱呀</li>
</ul>
</li>
<li>怎么搞到钱呢？<ul>
<li>已经上市了，扩股什么的不太好弄</li>
<li>发企业债，利息有点高，风险也大，搞杂了，还要自己还钱，连本带利</li>
<li>嗯，如果能发个低利息的债券，就好了<strong>（本质是债券）</strong></li>
</ul>
</li>
<li>可是，低利息债券没人要，怎么办？<ul>
<li>为了吸引投资者，说这个呢，过几年可以<strong>「以现在的股价」</strong>转股 <strong>（固定的转股价）</strong></li>
<li>股价是长期上涨的呀，买到就是赚到</li>
</ul>
</li>
<li>投资者要是问：股价要是跌了呢？<ul>
<li>股价跌了，我们开会讨论一下，多数股东同意了，给你「下调转股价」<strong>（下修条款）</strong></li>
</ul>
</li>
<li>投资者再问：如果你的股东都不同意呢？<ul>
<li>其实呢，我们是想让你成为股东的，这群股东也是这么想的，他们怕你来要钱，一般会同意的</li>
</ul>
</li>
<li>老股东会问：股价要是涨的很高很高了，这邦孙子再用这么低的价格转股，不是太便宜他们了吗？<ul>
<li>我加个<strong>「强赎条款」</strong>，现在的100块钱，涨到130，就逼他们卖，不识相的，就只给103块打发走</li>
</ul>
</li>
<li>可是，过个几年，要是没钱还，怎么办？<ul>
<li>嗯，我这是「刘备借荆州」，就没想着还，我一定会逼他们转股的 <strong>（转股是双方共同的心愿）</strong></li>
</ul>
</li>
<li>还有，最坏的情况是什么？<ul>
<li>大多数人转股了，少部分人不转，还是要给钱</li>
<li>这不行，我要加个说明，少于多人，也要「强赎」<strong>（第2个强赎条件）</strong></li>
</ul>
</li>
</ul>
<h2 id="2-发债中"><a href="#2-发债中" class="headerlink" title="2. 发债中"></a>2. 发债中</h2><ul>
<li>证监会看了一下，想：这帮韭菜，什么都不懂，既然投靠我，我得罩着他们点</li>
<li>第一，你这个要专款专用，不用拿来干别的，想干别的，得来申请，允许人家把钱拿走 <ul>
<li>老板满口说：行，行，不用来干别的<strong>（变更资金用途，触发回售）</strong></li>
</ul>
</li>
<li>第二，债券上市前6个月，不能转股，别想给我操纵股价，欺负弱小<ul>
<li>老板想了想，说行，你是老大，全听你的 <strong>（半年后，才进入转股期）</strong></li>
</ul>
</li>
<li>第三，6年，生个孩子都能打酱油了，你的股价还是不涨，拖到最后，只给一点利息，这不合适！<ul>
<li>老板想了想，委屈的说：好吧，我加一条，最后两年，来讨债的，我无条件还钱 <strong>（回售期）</strong></li>
</ul>
</li>
</ul>
<h2 id="3-发债前几年"><a href="#3-发债前几年" class="headerlink" title="3. 发债前几年"></a>3. 发债前几年</h2><ul>
<li>股价涨了<ul>
<li>要快点拉这邦孙子下水，债主变股东</li>
<li>是自己人，心里就舒坦多了</li>
<li>还有，钱想怎么花，就怎么花，别人(证监会)管不着了</li>
</ul>
</li>
<li>股价跌了<ul>
<li>刚开始：还不急，我不下调「转股价」，他们也没办法</li>
<li>过了两年还是没有起色：得调一下了，反正现在股份也不值钱，会有一部分人换股份，套现走人的</li>
<li>又过了1年：不好了，他们很快就能来讨债了，得快点拉他们下水，「转股价」调低一点</li>
</ul>
</li>
</ul>
<h2 id="4-回售期"><a href="#4-回售期" class="headerlink" title="4. 回售期"></a>4. 回售期</h2><ul>
<li>他们要来讨债了，还是准备点钱吧，也不用太多！</li>
<li>想尽一切办法，用尽所有手段，务必在短时间内，化敌为友</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/%E7%BD%91%E7%BB%9C%E4%BA%8C%E5%B1%82%E8%A7%A3%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E7%BD%91%E7%BB%9C%E4%BA%8C%E5%B1%82%E8%A7%A3%E6%9E%90/" class="post-title-link" itemprop="url">网络二层解析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-12-09 17:06:12" itemprop="dateCreated datePublished" datetime="2019-12-09T17:06:12+08:00">2019-12-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>一般说的二层，指的是「数据链路层」，即Data Link Layer。</p>
<h1 id="1-二层的定义"><a href="#1-二层的定义" class="headerlink" title="1. 二层的定义"></a>1. 二层的定义</h1><p>通俗的说，数据链路层是用来对接不同的物理设备(MAC)，向上提供统一的接口(LLC)的一层，因为它解决了兼容不同物理设备的问题，所以，研究网络分层往往把它当作第一层，就像汇编语言作为最低层的编程语言一样。</p>
<p>以下是比较专业的说法：</p>
<hr>
<p><strong>数据链路层</strong>（Data Link Layer）是<a href="https://zh.wikipedia.org/wiki/OSI模型" target="_blank" rel="noopener">OSI参考模型</a>第二层，位于<a href="https://zh.wikipedia.org/wiki/物理层" target="_blank" rel="noopener">物理层</a>与<a href="https://zh.wikipedia.org/wiki/网络层" target="_blank" rel="noopener">网络层</a>之间。在广播式多路访问链路中（局域网），由于可能存在介质争用，它还可以细分成<a href="https://zh.wikipedia.org/wiki/介质访问控制" target="_blank" rel="noopener">介质访问控制</a>（MAC）子层和<a href="https://zh.wikipedia.org/wiki/逻辑链路控制" target="_blank" rel="noopener">逻辑链路控制</a>（LLC）子层，<a href="https://zh.wikipedia.org/wiki/介质访问控制" target="_blank" rel="noopener">介质访问控制</a>（MAC）子层专职处理介质访问的争用与冲突问题。</p>
<p><a href="https://zh.wikipedia.org/wiki/區域網路" target="_blank" rel="noopener">局域网</a>与<a href="https://zh.wikipedia.org/wiki/廣域網路" target="_blank" rel="noopener">广域网</a>皆属第一、二层。</p>
<p><img src="../images/%E7%BD%91%E7%BB%9C%E4%BA%8C%E5%B1%82%E8%A7%A3%E6%9E%90/image-20191209151808865.png" alt="image-20191209151808865"></p>
<p><img src="%E4%BA%8C%E5%B1%82%E5%8D%8F%E8%AE%AE%E8%A7%A3%E6%9E%90.assets/image-20191209151808865.png" alt="image-20191209151808865"></p>
<p><strong>媒体接入控制</strong>（英语：<strong>M</strong>edia <strong>A</strong>ccess <strong>C</strong>ontrol，缩写：<strong>MAC</strong>）子层，是<a href="https://zh.wikipedia.org/wiki/局域网" target="_blank" rel="noopener">局域网</a>中<a href="https://zh.wikipedia.org/wiki/数据链路层" target="_blank" rel="noopener">数据链路层</a>的下层部分，提供定址及媒体访问的控制方式，使得不同设备或网络上的节点可以在多点的网络上通信，而不会互相冲突，上述的特性在<a href="https://zh.wikipedia.org/wiki/局域网" target="_blank" rel="noopener">局域网</a>或者<a href="https://zh.wikipedia.org/wiki/城域网" target="_blank" rel="noopener">城域网</a>中格外重要。早期网络发展时以MAC判别个网络接口之位置，但后来互联网发展后，才有IP之制定与使用<a href="https://zh.wikipedia.org/wiki/Wikipedia:列明来源" target="_blank" rel="noopener">[来源请求]</a>。若只是两台设备之间<a href="https://zh.wikipedia.org/wiki/全雙工" target="_blank" rel="noopener">全双工</a>的通信，因为两台设备可以同时发送及接收数据，不会冲突，因此不需要用到MAC协议。</p>
<p>MAC子层作为<a href="https://zh.wikipedia.org/wiki/逻辑链路控制" target="_blank" rel="noopener">逻辑链路控制</a>子层及<a href="https://zh.wikipedia.org/wiki/物理层" target="_blank" rel="noopener">物理层</a>之间沟通的介质，提供了一种定址的方法，称为实体地址或<a href="https://zh.wikipedia.org/wiki/MAC地址" target="_blank" rel="noopener">MAC地址</a>。MAC地址是唯一的，每张<a href="https://zh.wikipedia.org/wiki/網卡" target="_blank" rel="noopener">网卡</a>的MAC地址都不一样，因此可以在一<a href="https://zh.wikipedia.org/wiki/子網" target="_blank" rel="noopener">子网</a>中发送数据包到特定的目的设备。此处的子网是指没有<a href="https://zh.wikipedia.org/wiki/路由器" target="_blank" rel="noopener">路由器</a>的实体网络（例如以太网）。</p>
<p><strong>逻辑链路控制</strong>（英语：Logical Link Control，简称<strong>LLC</strong>）是<a href="https://zh.wikipedia.org/wiki/局域网" target="_blank" rel="noopener">局域网</a>中<a href="https://zh.wikipedia.org/wiki/数据链路层" target="_blank" rel="noopener">数据链路层</a>的上层部分，<a href="https://zh.wikipedia.org/wiki/IEEE_802.2" target="_blank" rel="noopener">IEEE 802.2</a>中定义了逻辑链路控制协议。用户的数据链路服务透过LLC子层为网络层提供统一的接口。在LLC子层下面是MAC（<a href="https://zh.wikipedia.org/wiki/介质访问控制" target="_blank" rel="noopener">介质访问控制</a>）子层。</p>
<p>IEEE标准中增加了这个子层，该子层透过在IP包上加了8位元的目的地址服务接入点和源地址服务接入点来保证在不同网络类型中传输。另外，有一个8或16位的控制字段用于象流控制的辅助功能。</p>
<h1 id="2-协议栈"><a href="#2-协议栈" class="headerlink" title="2. 协议栈"></a>2. 协议栈</h1><h2 id="2-1-以太网二层协议"><a href="#2-1-以太网二层协议" class="headerlink" title="2.1 以太网二层协议"></a>2.1 以太网二层协议</h2><p>在以太网协议(IEEE802.3)中，有如下一张图</p>
<p><img src="../images/%E7%BD%91%E7%BB%9C%E4%BA%8C%E5%B1%82%E8%A7%A3%E6%9E%90/image-20191206174252904.png" alt="image-20191206174252904"></p>
<p>从图中可以看出：</p>
<ul>
<li>Frame的确如前面据说，分为这几个部分</li>
<li>在Frame的外层，是Packet</li>
<li>Packet可以理解成MAC，Frame是LLC</li>
<li>Packet分为前8个字节，Frame，和扩展的内容</li>
<li>前8个字节，定义了包的开始，分为前7个字节Preamble，翻译为「前导码」和第8个字节SFD开始帧分隔符</li>
<li>前7个字节的内容均为10101010B，第8个字节的内容为10101011B（图中看不出来）</li>
<li>Frame中，对三层协议协议中的内容也做了定义，至少46个字节，如果不够，就用PAD来补齐</li>
</ul>
<p>那如何知道帧何时结束呢？</p>
<h5 id="这应该是和物理层密切相关的-「媒体访问控制层」-要解决的问题。"><a href="#这应该是和物理层密切相关的-「媒体访问控制层」-要解决的问题。" class="headerlink" title="这应该是和物理层密切相关的 「媒体访问控制层」 要解决的问题。"></a><strong>这应该是和物理层密切相关的 「媒体访问控制层」 要解决的问题。</strong></h5><h2 id="2-2-抓包看看"><a href="#2-2-抓包看看" class="headerlink" title="2.2 抓包看看"></a>2.2 抓包看看</h2><p>Wireshark协议栈如下图：</p>
<p><img src="../images/%E7%BD%91%E7%BB%9C%E4%BA%8C%E5%B1%82%E8%A7%A3%E6%9E%90/image-20191206160800871.png" alt="image-20191206160800871"></p>
<p>Wireshark中一般无法显示CRC校验的这4个字节。</p>
<h1 id="3-几个问题"><a href="#3-几个问题" class="headerlink" title="3. 几个问题"></a>3. 几个问题</h1><h2 id="3-1-物理层有没有协议栈？"><a href="#3-1-物理层有没有协议栈？" class="headerlink" title="3.1. 物理层有没有协议栈？"></a>3.1. 物理层有没有协议栈？</h2><p>物理层和数据链路层很难分开说，如最常用的以太网协议(IEEE802.3)，无线局域网协议WI-FI(IEEE802.11)，都是定义物理层和数据链路层的。</p>
<p>物理层是有协议栈的，但是，它的协议栈并不通用，每种物理层对应的协议栈不一样，需要单独研究。</p>
<p>因为从二层的LLC及以上，协议栈通用的，按照这样来理解，物理层没有协议栈。</p>
<h2 id="3-2-在网络信号中，一个完整的Frame如何定义？"><a href="#3-2-在网络信号中，一个完整的Frame如何定义？" class="headerlink" title="3.2. 在网络信号中，一个完整的Frame如何定义？"></a>3.2. 在网络信号中，一个完整的Frame如何定义？</h2><p>从官方图中能够看出，实际传输的包是Packet，包括MAC和LLC，Frame是LLC传输的内容。</p>
<p>于是，Frame内容的完整性，是由Packet来决定的，Packet依赖物理层，不同物理层可以有不同的实现。</p>
<p>所以，不好统一的说Frame是由什么分隔。</p>
<h2 id="3-3-二层设备如何处理二层协议栈？"><a href="#3-3-二层设备如何处理二层协议栈？" class="headerlink" title="3.3. 二层设备如何处理二层协议栈？"></a>3.3. 二层设备如何处理二层协议栈？</h2><p>二层主要内容是<code>DestinationAddress</code>，即下一个网络设备是谁，如果<code>DestinationAddress</code>是自己，那就是需要解<code>三层</code>，如果不是自己，那就不需要解<code>三层</code>。对交换机而言，不是自己，但是是自己知道的一个网口，那就把这个包发到对应的网口。</p>
<h2 id="3-4-二层设备在解决什么问题？"><a href="#3-4-二层设备在解决什么问题？" class="headerlink" title="3.4. 二层设备在解决什么问题？"></a>3.4. 二层设备在解决什么问题？</h2><p>在解决相邻设备 或 同一个局域网通信的问题。</p>
<h2 id="3-5-工作在二层上的协议有哪些？"><a href="#3-5-工作在二层上的协议有哪些？" class="headerlink" title="3.5. 工作在二层上的协议有哪些？"></a>3.5. 工作在二层上的协议有哪些？</h2><h3 id="3-5-1-ARP-LLC"><a href="#3-5-1-ARP-LLC" class="headerlink" title="3.5.1 ARP(LLC)"></a>3.5.1 ARP(LLC)</h3><p><strong>地址解析协议</strong>（英语：<strong>A</strong>ddress <strong>R</strong>esolution <strong>P</strong>rotocol，缩写：<strong>ARP</strong>）是一个通过解析<a href="https://zh.wikipedia.org/wiki/网络层" target="_blank" rel="noopener">网络层</a>地址来找寻<a href="https://zh.wikipedia.org/wiki/数据链路层" target="_blank" rel="noopener">数据链路层</a>地址的<a href="https://zh.wikipedia.org/wiki/网络传输协议" target="_blank" rel="noopener">网络传输协议</a>，它在<a href="https://zh.wikipedia.org/wiki/IPv4" target="_blank" rel="noopener">IPv4</a>中极其重要。ARP最初在1982年的<a href="https://zh.wikipedia.org/wiki/RFC" target="_blank" rel="noopener">RFC</a> <a href="https://tools.ietf.org/html/rfc826" target="_blank" rel="noopener">826</a>（征求意见稿）<a href="https://zh.wikipedia.org/wiki/地址解析协议#cite_note-1" target="_blank" rel="noopener">[1]</a>中提出并纳入<a href="https://zh.wikipedia.org/wiki/互联网标准" target="_blank" rel="noopener">互联网标准</a> STD 37. <strong>ARP</strong> 也可能指是在多数<a href="https://zh.wikipedia.org/wiki/操作系统" target="_blank" rel="noopener">操作系统</a>中管理其相关地址的一个进程。</p>
<p>ARP的目的，是通过IP地址，找到它的MAC地址，虽然工作在二层，只在局域网中起作用，但是，事实上，它是有三层协议的内容的，像IP地址，就是三层协议头中的内容。</p>
<h3 id="3-5-2-Ethernet-MAC"><a href="#3-5-2-Ethernet-MAC" class="headerlink" title="3.5.2 Ethernet(MAC)"></a>3.5.2 Ethernet(MAC)</h3><p><strong>以太网</strong>（英语：Ethernet）是一种<a href="https://zh.wikipedia.org/wiki/计算机" target="_blank" rel="noopener">计算机</a><a href="https://zh.wikipedia.org/wiki/局域网" target="_blank" rel="noopener">局域网</a>技术。<a href="https://zh.wikipedia.org/wiki/IEEE" target="_blank" rel="noopener">IEEE</a>组织的IEEE 802.3标准制定了以太网的技术标准，它规定了包括<a href="https://zh.wikipedia.org/wiki/OSI模型" target="_blank" rel="noopener">物理层</a>的连线、电子信号和<a href="https://zh.wikipedia.org/wiki/OSI模型" target="_blank" rel="noopener">介质访问层</a><a href="https://zh.wikipedia.org/wiki/网络协议" target="_blank" rel="noopener">协议</a>的内容。以太网是当前应用最普遍的局域网技术，取代了其他局域网标准如<a href="https://zh.wikipedia.org/wiki/令牌环" target="_blank" rel="noopener">令牌环</a>、<a href="https://zh.wikipedia.org/wiki/FDDI" target="_blank" rel="noopener">FDDI</a>和<a href="https://zh.wikipedia.org/w/index.php?title=ARCNET&action=edit&redlink=1" target="_blank" rel="noopener">ARCNET</a>。</p>
<p>以太网的标准<a href="https://zh.wikipedia.org/wiki/網絡拓撲" target="_blank" rel="noopener">拓扑</a>结构为<a href="https://zh.wikipedia.org/wiki/匯流排拓撲" target="_blank" rel="noopener">总线型拓扑</a>，但当前的快速以太网（<a href="https://zh.wikipedia.org/w/index.php?title=100BASE-T&action=edit&redlink=1" target="_blank" rel="noopener">100BASE-T</a>、<a href="https://zh.wikipedia.org/wiki/1000BASE-T" target="_blank" rel="noopener">1000BASE-T</a>标准）为了减少冲突，将能提高的网络速度和使用效率最大化，使用<a href="https://zh.wikipedia.org/wiki/網路交換器" target="_blank" rel="noopener">交换机</a>（Switch hub）来进行网络连接和组织。如此一来，以太网的拓扑结构就成了<a href="https://zh.wikipedia.org/wiki/星型网" target="_blank" rel="noopener">星型</a>；但在逻辑上，以太网仍然使用总线型拓扑和<a href="https://zh.wikipedia.org/wiki/CSMA/CD" target="_blank" rel="noopener">CSMA/CD</a>（Carrier Sense Multiple Access/Collision Detection，即载波多重访问/碰撞侦测）的总线技术。</p>
<h3 id="3-5-3-Wi-Fi-MAC"><a href="#3-5-3-Wi-Fi-MAC" class="headerlink" title="3.5.3 Wi-Fi(MAC)"></a>3.5.3 Wi-Fi(MAC)</h3><p><strong>Wi-Fi</strong>（发音： <a href="https://zh.wikipedia.org/wiki/Help:英語國際音標" target="_blank" rel="noopener">/ˈwaɪfaɪ/</a><a href="https://zh.wikipedia.org/wiki/Wi-Fi#cite_note-1" target="_blank" rel="noopener">[1]</a><a href="https://zh.wikipedia.org/wiki/Wi-Fi#cite_note-2" target="_blank" rel="noopener">[2]</a><a href="https://zh.wikipedia.org/wiki/Wi-Fi#cite_note-3" target="_blank" rel="noopener">[3]</a>），在<a href="https://zh.wikipedia.org/wiki/中文" target="_blank" rel="noopener">中文</a>里又称作“无线热点”，是Wi-Fi联盟制造商的<a href="https://zh.wikipedia.org/wiki/商標" target="_blank" rel="noopener">商标</a>做为产品的品牌认证，是一个创建于<a href="https://zh.wikipedia.org/wiki/IEEE_802.11" target="_blank" rel="noopener">IEEE 802.11</a>标准的<a href="https://zh.wikipedia.org/wiki/无线局域网" target="_blank" rel="noopener">无线局域网</a>技术。基于两套系统的密切相关，也常有人把Wi-Fi当做IEEE 802.11标准的同义术语。“Wi-Fi”常被写成“<strong>WiFi</strong>”或“<strong>Wifi</strong>”，但是它们并没有被Wi-Fi联盟认可。</p>
<h3 id="3-5-4-NDP-LLC"><a href="#3-5-4-NDP-LLC" class="headerlink" title="3.5.4 NDP(LLC)"></a>3.5.4 NDP(LLC)</h3><p><strong>邻居发现协议</strong>（英语：<strong>Neighbor Discovery Protocol</strong>简称：<strong>NDP</strong>或<strong>ND</strong>）是<a href="https://zh.wikipedia.org/wiki/TCP/IP" target="_blank" rel="noopener">TCP/IP</a>协议栈的一部分，主要与<a href="https://zh.wikipedia.org/wiki/IPv6" target="_blank" rel="noopener">IPv6</a>共同使用。它工作在数据链路层，负责在链路上发现其他节点和相应的地址，并确定可用路由和维护关于可用路径和其他活动节点的信息可达性。（<a href="http://tools.ietf.org/html/rfc4861" target="_blank" rel="noopener">RFC 4861</a>, 2007）</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/%E6%96%87%E4%BB%B6%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2%EF%BC%9AGBK%E8%BD%ACUTF8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E6%96%87%E4%BB%B6%E7%BC%96%E7%A0%81%E8%BD%AC%E6%8D%A2%EF%BC%9AGBK%E8%BD%ACUTF8/" class="post-title-link" itemprop="url">文件编码转换：GBK转UTF8</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-14 17:06:12" itemprop="dateCreated datePublished" datetime="2019-11-14T17:06:12+08:00">2019-11-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>因为历史原因，项目中的一些文件，是GBK编码的，需要统一转成UTF-8。</p>
<p>可以使用以下命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find ./ -name "*.properties" -exec enca -x UTF-8 &#123;&#125; \;</span><br></pre></td></tr></table></figure>

<p>该命令中，用到了2个命令：find 和 enca。</p>
<p>find为系统自带，enca是我手工安装的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install enca</span><br></pre></td></tr></table></figure>

<p>先找到所有的 properties文件，然后用enca将文件转码。</p>
<p><strong>enca有个好处：</strong>如果原来的编码就是目标编码，则不会转。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/git%E5%8E%9F%E7%90%86%E5%92%8C%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/git%E5%8E%9F%E7%90%86%E5%92%8C%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">git原理和常用命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-12 17:06:12" itemprop="dateCreated datePublished" datetime="2019-11-12T17:06:12+08:00">2019-11-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>本文写给git初学者，如果你用git有些时候了，仍然经常遇到问题，本文或许也会有点用处。</p>
<p>本文先大致讲一下git的原理，先明白那些命令操作的「对象」是什么，然后介绍了常用的一些命令，在什么情况下用哪个。</p>
<h1 id="1-基本理论"><a href="#1-基本理论" class="headerlink" title="1. 基本理论"></a>1. 基本理论</h1><ul>
<li>在git一堆指令的背后，有2个东西：reference 和 object；</li>
<li>reference更为人知的名字有：branch，tag，HEAD</li>
<li>一个object存储一个文件、文件夹、commit 或 tag的内容；</li>
<li>object以KeyValue存储，Key是object的SHA1，Value是object本身；</li>
<li>object中可以存储其他object的Key；</li>
<li>reference存储object的Key，指向object，就是个指针；</li>
<li>所有的reference + object组成一个DAG（有向无环图）；</li>
<li>对git的每一次操作，都是在这张图上搞事情；</li>
<li>对git的每一个操作，都要知道这张图将会变成怎样。</li>
</ul>
<h2 id="1-1-object对象"><a href="#1-1-object对象" class="headerlink" title="1.1 object对象"></a>1.1 object对象</h2><p>我知道的object有这么4类：blob、tree、commit和tag。</p>
<h3 id="1-1-1-blob"><a href="#1-1-1-blob" class="headerlink" title="1.1.1 blob"></a>1.1.1 blob</h3><p>blob类型的object存储着<strong>「文件」</strong>的内容，不包括文件名、权限等信息，只是内容。</p>
<p>因为git是根据内容生成Key，Key又是惟一的，所以git中重复文件只占用一份的空间。</p>
<h3 id="1-1-2-tree"><a href="#1-1-2-tree" class="headerlink" title="1.1.2 tree"></a>1.1.2 tree</h3><p>tree存储的是<strong>「文件夹」</strong>的信息，包括文件夹中的 子文件夹、文件 和 他们的访问权限，但不包括自己的。</p>
<h3 id="1-1-3-commit"><a href="#1-1-3-commit" class="headerlink" title="1.1.3 commit"></a>1.1.3 commit</h3><p>commit是一次<strong>「提交」</strong>，指向一个tree对象，并存下来是谁在什么时候提交的，提交的时候说了什么话。</p>
<h3 id="1-1-4-tag"><a href="#1-1-4-tag" class="headerlink" title="1.1.4 tag"></a>1.1.4 tag</h3><p>tag对象存储着tag信息，一般指向一个commit对象，并存下来tag名，打tag的人等信息。</p>
<h2 id="1-2-reference引用"><a href="#1-2-reference引用" class="headerlink" title="1.2 reference引用"></a>1.2 reference引用</h2><p>引用就是指针，存着某个对象的Key。常用的引用有3类(branch, remote branch, tag) 和 一个特殊的引用HEAD。</p>
<h3 id="1-2-1-branch"><a href="#1-2-1-branch" class="headerlink" title="1.2.1 branch"></a>1.2.1 branch</h3><p>分支只是一个引用，创建分支就是创建了一个引用，指向了一个commit，所以，在git中会见到多个branch都同时在一个commit上，branch还可以随意跳来跳去，一会儿在这个commit，一会儿到那个commit，非常自由，因为人家本来就是个「指针」。</p>
<h3 id="1-2-2-remote-branch"><a href="#1-2-2-remote-branch" class="headerlink" title="1.2.2 remote branch"></a>1.2.2 remote branch</h3><p>远程分支，是由远程负责的。</p>
<h3 id="1-2-3-tag"><a href="#1-2-3-tag" class="headerlink" title="1.2.3 tag"></a>1.2.3 tag</h3><p>建了之后不能改的引用。</p>
<p>看到这里，可能会觉得有点怪，怎么tag又是对象，又是引用？</p>
<p>的确，有tag引用，也有tag对象，他们是两个东西。</p>
<p>tag引用可以指向tag对象，也可以指向commit，甚至可以指向tree 或 blob。</p>
<h3 id="1-2-4-HEAD"><a href="#1-2-4-HEAD" class="headerlink" title="1.2.4 HEAD"></a>1.2.4 HEAD</h3><p>HEAD是一个特殊的引用，它是指向引用的引用，存的不是对象的Key，而是引用的path。</p>
<p>HEAD指向当前 工作空间 中的内容，是指向哪儿的。</p>
<h2 id="1-3-总结"><a href="#1-3-总结" class="headerlink" title="1.3 总结"></a>1.3 总结</h2><p>一图胜千言，下面图说明了这几种对象 和 引用 的关系。</p>
<p><img src="../images/git%E5%8E%9F%E7%90%86%E5%92%8C%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/006y8mN6ly1g8gd3ey111j30c30fitaw.jpg" alt="006y8mN6ly1g8gd3ey111j30c30fitaw"></p>
<ul>
<li>git是管理一个文件夹中所有的文件 及 历史的一套系统；</li>
<li>通过版本来管理历史，一个版本是一个commit；</li>
<li>一个文件的一个版本是一个blob对象；</li>
<li>一个文件夹的一个版本是一个tree对象；</li>
<li>一个commit对象会指向一个tree对象；</li>
<li>一个commit一般会指向一个commit对象，即它的上一个版本；</li>
<li>一个commit对象可能指向0个commit（第1个版本）；</li>
<li>一个commit对象也可能指向多个commit（由2个版本合并出一个新的版本）；</li>
<li>有「引用」才被载入史册，否则会被大浪淘沙，移为平地(gc)；</li>
<li>分支指向最新的commit，代表当代；</li>
<li>历史上总有一些关键点，需要特别标识出来，那就给他们取个名字打上tag，以后根据tag名字来找他们就方便多了；</li>
<li>git有一个时光机，可以在过去、现在 甚至 未来中自由穿梭，那我当前文件夹中看到的，究竟是哪个年代的呢？看看HEAD在哪儿就知道了；</li>
</ul>
<h1 id="2-验证理论"><a href="#2-验证理论" class="headerlink" title="2. 验证理论"></a>2. 验证理论</h1><h2 id="2-1-文件夹结构"><a href="#2-1-文件夹结构" class="headerlink" title="2.1 文件夹结构"></a>2.1 文件夹结构</h2><p>在.git文件夹下，我们能看到HEAD，index两个文件， 和 objects，refs两个文件夹，这是本文探寻的主要内容。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">➜  .git git:(master) ll</span><br><span class="line">total 104</span><br><span class="line">-rw-r--r--    1 lewis  staff    69B 10 24 13:49 COMMIT_EDITMSG</span><br><span class="line">-rw-r--r--    1 lewis  staff   669B 10 30 16:57 FETCH_HEAD</span><br><span class="line">-rw-r--r--    1 lewis  staff    23B 10 30 17:51 HEAD</span><br><span class="line">-rw-r--r--    1 lewis  staff    41B 10 24 13:48 ORIG_HEAD</span><br><span class="line">-rw-r--r--    1 lewis  staff   525B 10 24 11:38 config</span><br><span class="line">-rw-r--r--    1 lewis  staff    73B 10 16 21:00 description</span><br><span class="line">-rw-r--r--    1 lewis  staff   155B 10 24 13:49 fork-settings</span><br><span class="line">drwxr-xr-x   14 lewis  staff   476B 10 16 21:03 hooks</span><br><span class="line">-rw-r--r--    1 lewis  staff   4.6K 10 30 17:51 index</span><br><span class="line">drwxr-xr-x    3 lewis  staff   102B 10 25 14:20 info</span><br><span class="line">-rw-r--r--    1 lewis  staff   5.2K 10 24 10:15 jgitflow.log</span><br><span class="line">drwxr-xr-x    4 lewis  staff   136B 10 16 21:00 logs</span><br><span class="line">drwxr-xr-x  118 lewis  staff   3.9K 10 24 13:49 objects</span><br><span class="line">-rw-r--r--    1 lewis  staff   114B 10 16 21:00 packed-refs</span><br><span class="line">drwxr-xr-x    5 lewis  staff   170B 10 16 21:00 refs</span><br><span class="line">-rw-r--r--@   1 lewis  staff   174B 10 25 15:06 sourcetreeconfig</span><br></pre></td></tr></table></figure>

<h2 id="2-2-引用"><a href="#2-2-引用" class="headerlink" title="2.2 引用"></a>2.2 引用</h2><h3 id="2-2-1-HEAD"><a href="#2-2-1-HEAD" class="headerlink" title="2.2.1 HEAD"></a>2.2.1 HEAD</h3><p>HEAD下面存的是一个路径，指向了refs文件夹下的一个文件：<code>refs/heads/master</code>。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">➜  .git git:(master) cat HEAD </span><br><span class="line">ref: refs/heads/master</span><br></pre></td></tr></table></figure>

<h3 id="2-2-2-refs"><a href="#2-2-2-refs" class="headerlink" title="2.2.2 refs"></a>2.2.2 refs</h3><p><strong>我们看refs下面有哪些东西：</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">➜  .git git:(master) ls -alR refs</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x   5 lewis  staff  170 10 16 21:00 .</span><br><span class="line">drwxr-xr-x  18 lewis  staff  612 10 30 17:51 ..</span><br><span class="line">drwxr-xr-x   4 lewis  staff  136 10 24 13:49 heads</span><br><span class="line">drwxr-xr-x   3 lewis  staff  102 10 16 21:00 remotes</span><br><span class="line">drwxr-xr-x   4 lewis  staff  136 10 25 14:34 tags</span><br><span class="line"></span><br><span class="line">refs/heads:</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x  4 lewis  staff  136 10 24 13:49 .</span><br><span class="line">drwxr-xr-x  5 lewis  staff  170 10 16 21:00 ..</span><br><span class="line">-rw-r--r--  1 lewis  staff   41 10 24 13:49 master</span><br><span class="line">-rw-r--r--  1 lewis  staff   41 10 24 13:42 release</span><br><span class="line"></span><br><span class="line">refs/remotes:</span><br><span class="line">total 0</span><br><span class="line">drwxr-xr-x  3 lewis  staff  102 10 16 21:00 .</span><br><span class="line">drwxr-xr-x  5 lewis  staff  170 10 16 21:00 ..</span><br><span class="line">drwxr-xr-x  5 lewis  staff  170 10 24 14:19 origin</span><br><span class="line"></span><br><span class="line">refs/remotes/origin:</span><br><span class="line">total 24</span><br><span class="line">drwxr-xr-x  5 lewis  staff  170 10 24 14:19 .</span><br><span class="line">drwxr-xr-x  3 lewis  staff  102 10 16 21:00 ..</span><br><span class="line">-rw-r--r--  1 lewis  staff   32 10 16 21:00 HEAD</span><br><span class="line">-rw-r--r--  1 lewis  staff   41 10 24 14:19 master</span><br><span class="line">-rw-r--r--  1 lewis  staff   41 10 24 14:19 release</span><br><span class="line"></span><br><span class="line">refs/tags:</span><br><span class="line">total 16</span><br><span class="line">drwxr-xr-x  4 lewis  staff  136 10 25 14:34 .</span><br><span class="line">drwxr-xr-x  5 lewis  staff  170 10 16 21:00 ..</span><br><span class="line">-rw-r--r--  1 lewis  staff   41 10 23 18:17 1.0.1</span><br><span class="line">-rw-r--r--  1 lewis  staff   41 10 24 13:42 1.0.2</span><br></pre></td></tr></table></figure>

<p>可以看出：</p>
<ul>
<li><code>refs</code>下有3个文件夹：<code>heads</code>，<code>remotes</code> 和<code>tags</code></li>
<li><code>refs/heads</code>下面有<code>master</code>和<code>release</code> 两个文件，这是两个本地分支</li>
<li><code>refs/remotes</code>下面有一个origin，这是远程仓库的名字，可以有多个远程仓库</li>
<li><code>refs/remotes/origin</code>下面有3个文件：<code>HEAD</code>,<code>master</code>和<code>release</code>，即远程的<code>HEAD</code>和两个分支</li>
<li><code>refs/tags</code>下面有2个版本号</li>
</ul>
<p><strong>看看每一个文件里面都放着什么吧！</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">➜  .git git:(master) cat refs/heads/master </span><br><span class="line">0a2602e6fef30eae8ecb627295dc53f792eb90b7</span><br><span class="line">➜  .git git:(master) cat refs/heads/release </span><br><span class="line">ef33acd5682467d72ec5e9f071488ea92b6ada3d</span><br><span class="line">➜  .git git:(master) cat refs/remotes/origin/HEAD </span><br><span class="line">ref: refs/remotes/origin/master</span><br><span class="line">➜  .git git:(master) cat refs/remotes/origin/master </span><br><span class="line">0a2602e6fef30eae8ecb627295dc53f792eb90b7</span><br><span class="line">➜  .git git:(master) cat refs/remotes/origin/release </span><br><span class="line">ef33acd5682467d72ec5e9f071488ea92b6ada3d</span><br><span class="line">➜  .git git:(master) cat refs/tags/1.0.1 </span><br><span class="line">0b37f3e8d317258174ab6594498f3908a9a85ff4</span><br><span class="line">➜  .git git:(master) cat refs/tags/1.0.2</span><br><span class="line">e6b3070455b52ee005a3efb9bee46cf8579d69a6</span><br></pre></td></tr></table></figure>

<p>可以看出：</p>
<ul>
<li>remote的HEAD存了一个路径，指向remote的master</li>
<li>除了HEAD文件外，其他每个文件里面存了这样一个40位的字符串</li>
<li>本地的 master 和 远程的master存的内容是一样的，即指向了同一个对象</li>
</ul>
<h2 id="2-3-对象"><a href="#2-3-对象" class="headerlink" title="2.3 对象"></a>2.3 对象</h2><p>接下来，我们看看每个对象里面都存着什么。</p>
<h3 id="2-3-1-commit对象"><a href="#2-3-1-commit对象" class="headerlink" title="2.3.1 commit对象"></a>2.3.1 commit对象</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 先查master指向的commit id</span></span><br><span class="line">➜  .git git:(master) cat refs/heads/master </span><br><span class="line">0a2602e6fef30eae8ecb627295dc53f792eb90b7</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 看看这个commit里面的内容，称为commit A吧</span></span><br><span class="line">➜  .git git:(master) git cat-file -p 0a2602e6fef30eae8ecb627295dc53f792eb90b7</span><br><span class="line">tree 08405c558961bf4cd0ce14f54443e73935efd65a</span><br><span class="line">parent 096c44245e9cefde2e3fe5903f983b5686e60874</span><br><span class="line">author Lewis &lt;a@b.com&gt; 1571896152 +0800</span><br><span class="line">committer Lewis &lt;a@b.com&gt; 1571896152 +0800</span><br><span class="line"></span><br><span class="line">1.0.3-SNAPSHOT</span><br><span class="line"></span><br><span class="line">Change-Id: I28e490e5fae9b0296747d82a7d892edb519b3cab</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 看看这个commit的parent中的内容，叫它commit B吧</span></span><br><span class="line">➜  .git git:(master) git cat-file -p 096c44245e9cefde2e3fe5903f983b5686e60874</span><br><span class="line">tree e5617b721d22bdfb9480c80b321cdb6b3065fb5e</span><br><span class="line">parent 81e1daa43c6cc0b8487af7ace2df9a79766e6247</span><br><span class="line">author Lewis &lt;a@b.com&gt; 1571895563 +0800</span><br><span class="line">committer Lewis &lt;a@b.com&gt; 1571895563 +0800</span><br><span class="line"></span><br><span class="line">add scm config</span><br><span class="line"></span><br><span class="line">Change-Id: I5b062f5475ce1907abdfd70bf432858ea46f54aa</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. 再看上一个commit，它是commit C</span></span><br><span class="line">➜  .git git:(master) git cat-file -p 81e1daa43c6cc0b8487af7ace2df9a79766e6247</span><br><span class="line">tree 0b7654fe8f8f85d2e1eea6fa060deff25d00d5e3</span><br><span class="line">parent a925d410ed74c0e5fe86204f065b23cc9a50793c</span><br><span class="line">author test a@b.com 1571819772 +0800</span><br><span class="line">committer test a@b.com 1571819772 +0800</span><br><span class="line"></span><br><span class="line">1，消除common3的依赖。</span><br><span class="line">2，基于spring-boot-dependencies管理依赖。</span><br><span class="line"></span><br><span class="line">Change-Id: Ieb865698162aa73321d2ff22d7e550bf051f7625</span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. 再看上一个commit，它是commit D</span></span><br><span class="line">➜  .git git:(master) git cat-file -p a925d410ed74c0e5fe86204f065b23cc9a50793c</span><br><span class="line">tree 83c980d2db04066ea0039ce85df8633151043fc5</span><br><span class="line">parent 24cfa38db8f33c5c4187ce608d4bef223b2e594b</span><br><span class="line">author Lewis &lt;a@b.com&gt; 1571234523 +0800</span><br><span class="line">committer Lewis &lt;a@b.com&gt; 1571235719 +0800</span><br><span class="line"></span><br><span class="line">updating poms for branch'release/1.0.1' with non-snapshot versions</span><br><span class="line"></span><br><span class="line">Change-Id: I5690493a0bcd5de37678015e319c69d333abeb9c</span><br><span class="line"><span class="meta">#</span><span class="bash"> 6. 看看能不能和<span class="built_in">log</span>对应上</span></span><br><span class="line">➜  .git git:(master) git log -4</span><br><span class="line">commit 0a2602e6fef30eae8ecb627295dc53f792eb90b7 (HEAD -&gt; master, origin/master, origin/HEAD)</span><br><span class="line">Author: Lewis &lt;a@b.com&gt;</span><br><span class="line">Date:   Thu Oct 24 13:49:12 2019 +0800</span><br><span class="line"></span><br><span class="line">    1.0.3-SNAPSHOT</span><br><span class="line">    </span><br><span class="line">    Change-Id: I28e490e5fae9b0296747d82a7d892edb519b3cab</span><br><span class="line"></span><br><span class="line">commit 096c44245e9cefde2e3fe5903f983b5686e60874</span><br><span class="line">Author: Lewis &lt;a@b.com&gt;</span><br><span class="line">Date:   Thu Oct 24 13:39:23 2019 +0800</span><br><span class="line"></span><br><span class="line">    add scm config</span><br><span class="line">    </span><br><span class="line">    Change-Id: I5b062f5475ce1907abdfd70bf432858ea46f54aa</span><br><span class="line"></span><br><span class="line">commit 81e1daa43c6cc0b8487af7ace2df9a79766e6247</span><br><span class="line">Author: test a@b.com</span><br><span class="line">Date:   Wed Oct 23 16:36:12 2019 +0800</span><br><span class="line"></span><br><span class="line">    1，消除common3的依赖。</span><br><span class="line">    2，基于spring-boot-dependencies管理依赖。</span><br><span class="line">    </span><br><span class="line">    Change-Id: Ieb865698162aa73321d2ff22d7e550bf051f7625</span><br><span class="line"></span><br><span class="line">commit a925d410ed74c0e5fe86204f065b23cc9a50793c</span><br><span class="line">Author: Lewis &lt;a@b.com&gt;</span><br><span class="line">Date:   Wed Oct 16 22:02:03 2019 +0800</span><br><span class="line"></span><br><span class="line">    updating poms for branch'release/1.0.1' with non-snapshot versions</span><br><span class="line">    </span><br><span class="line">    Change-Id: I5690493a0bcd5de37678015e319c69d333abeb9c</span><br></pre></td></tr></table></figure>

<ul>
<li>有committer和commit的信息，可以知道这是一个commit对象</li>
<li>它有一个tree的Key</li>
<li>它有一个parent，指向了上一个版本</li>
</ul>
<h3 id="2-3-2-tree对象"><a href="#2-3-2-tree对象" class="headerlink" title="2.3.2 tree对象"></a>2.3.2 tree对象</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 看看commit A 指向的tree</span></span><br><span class="line">➜  .git git:(master) git cat-file -p 08405c558961bf4cd0ce14f54443e73935efd65a</span><br><span class="line">100644 blob 815e9534e349779477be0bd9599b970cd57ca0eb	.gitignore</span><br><span class="line">100644 blob a32e821ac5372a40846648085c0ea9be34c60260	"dpaas-common\350\257\264\346\230\216.md"</span><br><span class="line">100644 blob eefea84a5d8ed7fb57f3f68a23e41c52c8adb528	pom.xml</span><br><span class="line">040000 tree fe8d78f0b4e8ac1b20b08d48c3eab251e14adb03	src</span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. commit B 指向的tree</span></span><br><span class="line">➜  .git git:(master) git cat-file -p e5617b721d22bdfb9480c80b321cdb6b3065fb5e</span><br><span class="line">100644 blob 815e9534e349779477be0bd9599b970cd57ca0eb	.gitignore</span><br><span class="line">100644 blob a32e821ac5372a40846648085c0ea9be34c60260	"dpaas-common\350\257\264\346\230\216.md"</span><br><span class="line">100644 blob 82d60064381c6c188236ae448eccc07d917eb37f	pom.xml</span><br><span class="line">040000 tree fe8d78f0b4e8ac1b20b08d48c3eab251e14adb03	src</span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. commit C 指向的tree</span></span><br><span class="line">➜  .git git:(master) git cat-file -p 0b7654fe8f8f85d2e1eea6fa060deff25d00d5e3</span><br><span class="line">100644 blob 815e9534e349779477be0bd9599b970cd57ca0eb	.gitignore</span><br><span class="line">100644 blob a32e821ac5372a40846648085c0ea9be34c60260	"dpaas-common\350\257\264\346\230\216.md"</span><br><span class="line">100644 blob 0074e4c2834b9505c000ebcbbc9c23871b39e80a	pom.xml</span><br><span class="line">040000 tree fe8d78f0b4e8ac1b20b08d48c3eab251e14adb03	src</span><br><span class="line"><span class="meta">#</span><span class="bash"> 4. commit D 指向的tree</span></span><br><span class="line">➜  .git git:(master) git cat-file -p 83c980d2db04066ea0039ce85df8633151043fc5</span><br><span class="line">100644 blob 815e9534e349779477be0bd9599b970cd57ca0eb	.gitignore</span><br><span class="line">100644 blob a32e821ac5372a40846648085c0ea9be34c60260	"dpaas-common\350\257\264\346\230\216.md"</span><br><span class="line">100644 blob 3cea1f762ddb91d6ff9fe7c29ab76d17152b1c31	pom.xml</span><br><span class="line">040000 tree 38e6084a01011b75c5b577721d60720f7c35fef5	src</span><br><span class="line"><span class="meta">#</span><span class="bash"> 5. commit C 和 commit D 指向的src树比较</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> commit C 的 src树</span></span><br><span class="line">➜  .git git:(master) git cat-file -p fe8d78f0b4e8ac1b20b08d48c3eab251e14adb03</span><br><span class="line">040000 tree eac04dfa6dff2ca60931abb9118048552c2a0f7a	main</span><br><span class="line"><span class="meta">#</span><span class="bash"> commit D 的 src树</span></span><br><span class="line">➜  .git git:(master) git cat-file -p 38e6084a01011b75c5b577721d60720f7c35fef5</span><br><span class="line">040000 tree 16b6cf8627a05b28c9fd8e83b927ecfe9ca9d282	main</span><br></pre></td></tr></table></figure>

<ul>
<li>tree中记录的是它下面有哪些对象，即文件夹中有哪些文件 和 文件夹</li>
<li>文件 和 文件夹的格式是一样的，通过权限 和 对象类型来区分</li>
<li>blob对应的是文件，tree对应的是文件夹</li>
<li>这个tree对象指向了3个blob对象，1个tree对象</li>
<li><code>.gitignore</code>文件都是同一个Key，在这4个版本中都没改过</li>
<li><code>pom.xml</code>文件每个版本都不一样，说明它一直在改</li>
<li><code>src</code>文件夹在commit D 到 commit C时，发生了变化，其子树只指向了一个文件夹，文件夹的名字没变，Key却变了，这说明，一个文件变化，它的N层父级文件夹全部都建了一个新的</li>
<li>其中文件夹的040000，文件的100644很像Linux的权限，有没有？</li>
</ul>
<h3 id="2-3-3-blob对象"><a href="#2-3-3-blob对象" class="headerlink" title="2.3.3 blob对象"></a>2.3.3 blob对象</h3><p>接下来看看blob对象中存了什么</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 这是 .gitignore 文件，里面就是文件的内容，和文本编辑器打开看到的一样，没有文件名等信息</span></span><br><span class="line">➜  .git git:(master) git cat-file -p 815e9534e349779477be0bd9599b970cd57ca0eb</span><br><span class="line">/target/</span><br><span class="line">!.mvn/wrapper/maven-wrapper.jar</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## STS ###</span></span></span><br><span class="line">.apt_generated</span><br><span class="line">.classpath</span><br><span class="line">.factorypath</span><br><span class="line">.project</span><br><span class="line">.settings</span><br><span class="line">.springBeans</span><br><span class="line">.sts4-cache</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## IntelliJ IDEA ###</span></span></span><br><span class="line">.idea</span><br><span class="line">*.iws</span><br><span class="line">*.iml</span><br><span class="line">*.ipr</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment">## NetBeans ###</span></span></span><br><span class="line">/nbproject/private/</span><br><span class="line">/build/</span><br><span class="line">/nbbuild/</span><br><span class="line">/dist/</span><br><span class="line">/nbdist/</span><br><span class="line">/.nb-gradle/</span><br><span class="line"></span><br><span class="line">*.class</span><br><span class="line">*.log</span><br><span class="line">*.gz</span><br><span class="line">*.tmp</span><br><span class="line">*.ctxt</span><br><span class="line">*.war</span><br><span class="line">*.ear</span><br><span class="line">*.zip</span><br><span class="line">*.tar.gz</span><br><span class="line">*.rar</span><br><span class="line">*.iml</span><br><span class="line">hs_err_pid*</span><br><span class="line">.settings</span><br><span class="line">.classpath</span><br><span class="line">.project</span><br><span class="line">.git</span><br><span class="line">.idea</span><br><span class="line">.iml</span><br><span class="line">.DS_Store</span><br><span class="line">.svn</span><br><span class="line">target</span><br><span class="line">log</span><br><span class="line">.mtj.tmp/</span><br><span class="line">/.idea/libraries/</span><br><span class="line">/.idea/</span><br><span class="line">output/</span><br><span class="line"><span class="meta">target/%</span></span><br></pre></td></tr></table></figure>

<h3 id="2-3-4-tag对象"><a href="#2-3-4-tag对象" class="headerlink" title="2.3.4 tag对象"></a>2.3.4 tag对象</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 看一个tag的Key</span></span><br><span class="line">➜  .git git:(master) cat refs/tags/1.0.2 </span><br><span class="line">e6b3070455b52ee005a3efb9bee46cf8579d69a6</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 查下这个Key指向了一个什么对象</span></span><br><span class="line">➜  .git git:(master) git cat-file -p e6b3070455b52ee005a3efb9bee46cf8579d69a6</span><br><span class="line">object b9704112bde683d79bbebb30a13f1b5c1b232bf5</span><br><span class="line">type commit</span><br><span class="line">tag 1.0.2</span><br><span class="line">tagger Lewis &lt;a@b.com&gt; 1571895731 +0800</span><br><span class="line"></span><br><span class="line">[maven-release-plugin] copy for tag 1.0.2</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 这个对象的object又指向了什么？</span></span><br><span class="line">➜  .git git:(master) git cat-file -p b9704112bde683d79bbebb30a13f1b5c1b232bf5</span><br><span class="line">tree 153fbed953f8a8cdbb9dcbb89ae823ff33473c15</span><br><span class="line">parent 728c4cfa2508a9ac839ac20c281a0c4cbe39c355</span><br><span class="line">author Lewis &lt;a@b.com&gt; 1571895730 +0800</span><br><span class="line">committer Lewis &lt;a@b.com&gt; 1571895730 +0800</span><br><span class="line"></span><br><span class="line">[maven-release-plugin] prepare release 1.0.2</span><br><span class="line"></span><br><span class="line">Change-Id: I195493aca7aa6a157b61c1e3391f27d0b53e8f4e</span><br></pre></td></tr></table></figure>

<ul>
<li>从 tagger的信息可以知道，这是一个tag对象</li>
<li>tag对象保存了tag名称，如果tag引用被删掉了，如果tag对象还没被回收，可以从tag对象中恢复tag引用</li>
<li>tag指向了一个object，其类型为commit</li>
<li>从commit对象的内容来看，的确是一个commit对象</li>
</ul>
<h2 id="2-4-tag引用"><a href="#2-4-tag引用" class="headerlink" title="2.4 tag引用"></a>2.4 tag引用</h2><p>在<code>tag对象</code>一节，我们看到了tag引用指向了一个tag对象，但这并不是必须的，tag引用可以指向任何一个对象。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 1. 作为测试，我新建了一个tag 1.0.3，指向了一个commit</span></span><br><span class="line">➜  .git git:(master) cat refs/tags/1.0.3</span><br><span class="line">0a2602e6fef30eae8ecb627295dc53f792eb90b7</span><br><span class="line">➜  .git git:(master) git cat-file -p 0a2602e6fef30eae8ecb627295dc53f792eb90b7</span><br><span class="line">tree 08405c558961bf4cd0ce14f54443e73935efd65a</span><br><span class="line">parent 096c44245e9cefde2e3fe5903f983b5686e60874</span><br><span class="line">author Lewis &lt;a@b.com&gt; 1571896152 +0800</span><br><span class="line">committer Lewis &lt;a@b.com&gt; 1571896152 +0800</span><br><span class="line"></span><br><span class="line">1.0.3-SNAPSHOT</span><br><span class="line"></span><br><span class="line">Change-Id: I28e490e5fae9b0296747d82a7d892edb519b3cab</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 2. 再建了一个tag 1.0.4，指向了一个 文件夹的版本，即tree</span></span><br><span class="line">➜  .git git:(master) cat refs/tags/1.0.4</span><br><span class="line">fe8d78f0b4e8ac1b20b08d48c3eab251e14adb03</span><br><span class="line">➜  .git git:(master) git cat-file -t fe8d78f0b4e8ac1b20b08d48c3eab251e14adb03</span><br><span class="line">tree</span><br><span class="line">➜  .git git:(master) git cat-file -p fe8d78f0b4e8ac1b20b08d48c3eab251e14adb03</span><br><span class="line">040000 tree eac04dfa6dff2ca60931abb9118048552c2a0f7a	main</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 3. 再建了一个tag 1.0.5，指向了一个 文件的版本，即blob</span></span><br><span class="line">➜  .git git:(master) cat refs/tags/1.0.5</span><br><span class="line">eefea84a5d8ed7fb57f3f68a23e41c52c8adb528</span><br><span class="line">➜  .git git:(master) git cat-file -t eefea84a5d8ed7fb57f3f68a23e41c52c8adb528</span><br><span class="line">blob</span><br><span class="line">➜  .git git:(master) git cat-file -p eefea84a5d8ed7fb57f3f68a23e41c52c8adb528</span><br><span class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span><br><span class="line">&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;</span><br><span class="line">    &lt;parent&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;2.1.4.RELEASE&lt;/version&gt;</span><br><span class="line">    &lt;/parent&gt;</span><br><span class="line">    .....</span><br><span class="line">    .....</span><br><span class="line">    .....</span><br></pre></td></tr></table></figure>

<ul>
<li>从上面可以看出，tag只是一个引用，它可以指向任何一种对象</li>
<li>一般来讲，它会指向 tag对象 或 commit对象</li>
<li>有tag对象的，称为annotated tag</li>
<li>没有tag对象的，称为 lightweight tag</li>
</ul>
<h1 id="3-常用命令"><a href="#3-常用命令" class="headerlink" title="3. 常用命令"></a>3. 常用命令</h1><h2 id="3-1-初始化配置"><a href="#3-1-初始化配置" class="headerlink" title="3.1 初始化配置"></a>3.1 初始化配置</h2><h3 id="3-1-1-init"><a href="#3-1-1-init" class="headerlink" title="3.1.1 init"></a>3.1.1 init</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在当前目录新建一个Git代码库</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git init</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建一个目录，将其初始化为Git代码库</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git init [project-name]</span></span><br></pre></td></tr></table></figure>

<h3 id="3-1-2-config"><a href="#3-1-2-config" class="headerlink" title="3.1.2 config"></a>3.1.2 config</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 显示当前的Git配置</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config --list</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 编辑Git配置文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config -e [--global]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置提交代码时的用户信息</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config [--global] user.name <span class="string">"[name]"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git config [--global] user.email <span class="string">"[email address]"</span></span></span><br></pre></td></tr></table></figure>

<h2 id="3-2-暂存区"><a href="#3-2-暂存区" class="headerlink" title="3.2 暂存区"></a>3.2 暂存区</h2><h3 id="3-2-1-add"><a href="#3-2-1-add" class="headerlink" title="3.2.1 add"></a>3.2.1 add</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 添加指定文件到暂存区</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git add [file1] [file2] ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加指定目录到暂存区，包括子目录</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git add [dir]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加当前目录的所有文件到暂存区</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git add .</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加每个变化前，都会要求确认</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 对于同一个文件的多处变化，可以实现分次提交</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git add -p</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-mv"><a href="#3-2-2-mv" class="headerlink" title="3.2.2 mv"></a>3.2.2 mv</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 改名文件，并且将这个改名放入暂存区</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git mv [file-original] [file-renamed]</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-3-rm"><a href="#3-2-3-rm" class="headerlink" title="3.2.3 rm"></a>3.2.3 rm</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 删除工作区文件，并且将这次删除放入暂存区</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git rm [file1] [file2] ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 停止追踪指定文件，但该文件会保留在工作区</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git rm --cached [file]</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-4-status"><a href="#3-2-4-status" class="headerlink" title="3.2.4 status"></a>3.2.4 status</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 显示有变更的文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git status</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-5-diff"><a href="#3-2-5-diff" class="headerlink" title="3.2.5 diff"></a>3.2.5 diff</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 显示暂存区和工作区的差异</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git diff</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示暂存区和上一个commit的差异</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git diff --cached [file]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示工作区与当前分支最新commit之间的差异</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git diff HEAD</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示两次提交之间的差异</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git diff [first-branch]...[second-branch]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示今天你写了多少行代码</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git diff --shortstat <span class="string">"@&#123;0 day ago&#125;"</span></span></span><br></pre></td></tr></table></figure>

<h2 id="3-3-对象"><a href="#3-3-对象" class="headerlink" title="3.3 对象"></a>3.3 对象</h2><h3 id="3-3-1-commit"><a href="#3-3-1-commit" class="headerlink" title="3.3.1 commit"></a>3.3.1 commit</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 提交暂存区到仓库区</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit -m [message]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 提交暂存区的指定文件到仓库区</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit [file1] [file2] ... -m [message]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 提交工作区自上次commit之后的变化，直接到仓库区</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit -a</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 提交时显示所有diff信息</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit -v</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用一次新的commit，替代上一次提交</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果代码没有任何新变化，则用来改写上一次commit的提交信息</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit --amend -m [message]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重做上一次commit，并包括指定文件的新变化</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit --amend [file1] [file2] ...</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-2-log"><a href="#3-3-2-log" class="headerlink" title="3.3.2 log"></a>3.3.2 log</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 显示当前分支的版本历史</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示commit历史，以及每次commit发生变更的文件</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --<span class="built_in">stat</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 搜索提交历史，根据关键词</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> -S [keyword]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示某个commit之后的所有变动，每个commit占据一行</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> [tag] HEAD --pretty=format:%s</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示某个commit之后的所有变动，其<span class="string">"提交说明"</span>必须符合搜索条件</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> [tag] HEAD --grep feature</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示某个文件的版本历史，包括文件改名</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> --follow [file]</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git whatchanged [file]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示指定文件相关的每一次diff</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> -p [file]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示过去5次提交</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span> -5 --pretty --oneline</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示所有提交过的用户，按提交次数排序</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git shortlog -sn</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-3-merge"><a href="#3-3-3-merge" class="headerlink" title="3.3.3 merge"></a>3.3.3 merge</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 合并指定分支到当前分支</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git merge [branch]</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-4-rebase"><a href="#3-3-4-rebase" class="headerlink" title="3.3.4 rebase"></a>3.3.4 rebase</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 合并当前分支的最近 4 次提交纪录</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git rebase -i HEAD~4</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 基于分支的合并</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git rebase master</span></span><br></pre></td></tr></table></figure>

<h2 id="3-4-引用"><a href="#3-4-引用" class="headerlink" title="3.4 引用"></a>3.4 引用</h2><h3 id="3-4-1-update-ref"><a href="#3-4-1-update-ref" class="headerlink" title="3.4.1 update-ref"></a>3.4.1 update-ref</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安全地更新存储在ref文件中的对象的Key</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git update-ref refs/heads/master 1a410efbd13591db07496601ebc7a059dd55cfe9</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-2-symbolic-ref"><a href="#3-4-2-symbolic-ref" class="headerlink" title="3.4.2 symbolic-ref"></a>3.4.2 symbolic-ref</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 读取HEAD的引用</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git symbolic-ref HEAD</span></span><br><span class="line">refs/heads/master</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 设置 HEAD 引用 refs/heads/<span class="built_in">test</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git symbolic-ref HEAD refs/heads/<span class="built_in">test</span></span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-3-checkout"><a href="#3-4-3-checkout" class="headerlink" title="3.4.3 checkout"></a>3.4.3 checkout</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 新建一个分支，并切换到该分支</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout -b [branch-name]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到指定分支，并更新工作区</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout [branch-name]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 切换到上一个分支</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout -</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 恢复暂存区的指定文件到工作区</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout [file]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 恢复某个commit的指定文件到暂存区和工作区</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout [commit] [file]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 恢复暂存区的所有文件到工作区</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout .</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-4-branch"><a href="#3-4-4-branch" class="headerlink" title="3.4.4 branch"></a>3.4.4 branch</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 列出所有本地分支</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git branch</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出所有远程分支</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git branch -r</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出所有本地分支和远程分支</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git branch -a</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建一个分支，但依然停留在当前分支</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git branch [branch-name]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建一个分支，指向指定commit</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git branch [branch] [commit]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建一个分支，与指定的远程分支建立追踪关系</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git branch --track [branch] [remote-branch]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 建立追踪关系，在现有分支与指定的远程分支之间</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git branch --<span class="built_in">set</span>-upstream [branch] [remote-branch]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除分支</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git branch -d [branch-name]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除远程分支</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git branch -dr [remote/branch]</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-5-reset"><a href="#3-4-5-reset" class="headerlink" title="3.4.5 reset"></a>3.4.5 reset</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 重置暂存区的指定文件，与上一次commit保持一致，但工作区不变</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset [file]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重置暂存区与工作区，与上一次commit保持一致</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset --hard</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重置当前分支的指针为指定commit，同时重置暂存区，但工作区不变</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset [commit]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重置当前分支的HEAD为指定commit，同时重置暂存区和工作区，与指定commit一致</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset --hard [commit]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重置当前HEAD为指定commit，但保持暂存区和工作区不变</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git reset --keep [commit]</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-6-tag"><a href="#3-4-6-tag" class="headerlink" title="3.4.6 tag"></a>3.4.6 tag</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 列出所有tag</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git tag</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建一个tag在当前commit</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git tag [tag]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建一个tag在指定commit</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git tag [tag] [commit]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除本地tag</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git tag -d [tag]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除远程tag</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git push origin :refs/tags/[tagName]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看tag信息</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git show [tag]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 提交指定tag</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git push [remote] [tag]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 提交所有tag</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git push [remote] --tags</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 新建一个分支，指向某个tag</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git checkout -b [branch] [tag]</span></span><br></pre></td></tr></table></figure>

<h3 id="3-4-7-reflog"><a href="#3-4-7-reflog" class="headerlink" title="3.4.7 reflog"></a>3.4.7 reflog</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看引用历史，然后用 reset 回到过去 或 未来</span></span><br><span class="line">git reflog</span><br></pre></td></tr></table></figure>

<h2 id="3-5-远程"><a href="#3-5-远程" class="headerlink" title="3.5 远程"></a>3.5 远程</h2><h3 id="3-5-1-clone"><a href="#3-5-1-clone" class="headerlink" title="3.5.1 clone"></a>3.5.1 clone</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载一个项目和它的整个代码历史</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> [url]</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-2-fetch"><a href="#3-5-2-fetch" class="headerlink" title="3.5.2 fetch"></a>3.5.2 fetch</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载远程仓库的所有变动</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git fetch [remote]</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-3-pull"><a href="#3-5-3-pull" class="headerlink" title="3.5.3 pull"></a>3.5.3 pull</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 取回远程仓库的变化，并与本地分支合并</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git pull [remote] [branch]</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-4-push"><a href="#3-5-4-push" class="headerlink" title="3.5.4 push"></a>3.5.4 push</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 上传本地指定分支到远程仓库</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git push [remote] [branch]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 强行推送当前分支到远程仓库，即使有冲突</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git push [remote] --force</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 推送所有分支到远程仓库</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git push [remote] --all</span></span><br></pre></td></tr></table></figure>
<h3 id="3-5-5-remote"><a href="#3-5-5-remote" class="headerlink" title="3.5.5 remote"></a>3.5.5 remote</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 显示所有远程仓库</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git remote -v</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 显示某个远程仓库的信息</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git remote show [remote]</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 增加一个新的远程仓库，并命名</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git remote add [shortname] [url]</span></span><br></pre></td></tr></table></figure>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Linux%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">Linux常用命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-12 17:06:12" itemprop="dateCreated datePublished" datetime="2019-11-12T17:06:12+08:00">2019-11-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>7z</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装 p7zip</span></span><br><span class="line">yum install p7zip</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 压缩</span></span><br><span class="line">7za a dump.7z dump.sql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压缩</span></span><br><span class="line">7za x dump.7z</span><br></pre></td></tr></table></figure>

<p>mysql备份</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 为了不输入密码</span></span><br><span class="line">vim ~/.my.cnf</span><br><span class="line"><span class="meta">#</span><span class="bash"> 输入以下内容</span></span><br><span class="line">[mysqldump]</span><br><span class="line">user=root</span><br><span class="line">password=the-password</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> mysqldump 同时7z压缩</span></span><br><span class="line"></span><br><span class="line">mysqldump databaseName | 7za a -si databaseName_2020_01_01.7z</span><br></pre></td></tr></table></figure>

<p>rsync 限速拷贝</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rsync -e "ssh -p 23854" --progress --bwlimit=450 root@192.168.100.200:/path/to/file.7z /path/to/file.7z</span><br></pre></td></tr></table></figure>

<p>该有的权限，却提示没有时</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看权限</span></span><br><span class="line">[root@linux ~]# lsattr YourFile</span><br><span class="line">　　---i---------- YourFile</span><br><span class="line">[root@linux ~]# chattr -i YourFile</span><br><span class="line">[root@linux ~]# lsattr YourFile</span><br><span class="line">　　-------------- YourFile</span><br></pre></td></tr></table></figure>

<p>ps命令用不了（因为中过毒）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> rpm 删掉这个软件</span></span><br><span class="line">rpm -e --nodeps procps</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum重新装一下</span></span><br><span class="line">yum install procps</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">放牛的</p>
  <div class="site-description" itemprop="description">随便写点东西</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">放牛的</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
