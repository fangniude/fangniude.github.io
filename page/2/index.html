<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"fangniude.github.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="随便写点东西">
<meta property="og:type" content="website">
<meta property="og:title" content="放牛的">
<meta property="og:url" content="https://fangniude.github.com/page/2/">
<meta property="og:site_name" content="放牛的">
<meta property="og:description" content="随便写点东西">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="放牛的">
<meta property="article:tag" content="技术">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://fangniude.github.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>放牛的</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">放牛的</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">放牛的日子，是人生初恋的诗...</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/%E6%AF%8F%E4%B8%AA%E7%A8%8B%E5%BA%8F%E5%91%98%E9%83%BD%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E7%AD%89%E5%BE%85%E6%97%B6%E9%97%B4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E6%AF%8F%E4%B8%AA%E7%A8%8B%E5%BA%8F%E5%91%98%E9%83%BD%E9%9C%80%E8%A6%81%E7%9F%A5%E9%81%93%E7%9A%84%E7%AD%89%E5%BE%85%E6%97%B6%E9%97%B4/" class="post-title-link" itemprop="url">每个程序员都需要知道的等待时间</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-30 17:06:12" itemprop="dateCreated datePublished" datetime="2019-10-30T17:06:12+08:00">2019-10-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>数据来源：</strong><a href="https://people.eecs.berkeley.edu/~rcs/research/interactive_latency.html">Latency Numbers Every Programmer Should Know</a></p>
<p><strong>有点过时的数据：</strong><a href="https://gist.github.com/hellerbarde/2843375">Latency numbers every programmer should know</a></p>
<p><strong>时间单位换算：</strong> 1s = 1,000ms = 1,000,000us = 1,000,000,000ns</p>
<p><strong>毫秒(ms)：</strong>1s = 1,000ms</p>
<p><strong>微秒(us)：</strong>1ms = 1,000us</p>
<p><strong>纳秒(ns)：</strong>1us = 1,000ns</p>
<table>
<thead>
<tr>
<th align="center">等待事件</th>
<th align="center">2000</th>
<th align="center">2005</th>
<th align="center">2010</th>
<th align="center">2015</th>
<th align="center">2018</th>
</tr>
</thead>
<tbody><tr>
<td align="center">L1缓存引用</td>
<td align="center">6ns</td>
<td align="center">1ns</td>
<td align="center">1ns</td>
<td align="center">1ns</td>
<td align="center">1ns</td>
</tr>
<tr>
<td align="center">分支预测错误</td>
<td align="center">19ns</td>
<td align="center">3ns</td>
<td align="center">3ns</td>
<td align="center">3ns</td>
<td align="center">3ns</td>
</tr>
<tr>
<td align="center">二级缓存引用</td>
<td align="center">25ns</td>
<td align="center">4ns</td>
<td align="center">4ns</td>
<td align="center">4ns</td>
<td align="center">4ns</td>
</tr>
<tr>
<td align="center">互斥锁加锁/解锁</td>
<td align="center">94ns</td>
<td align="center">17ns</td>
<td align="center">17ns</td>
<td align="center">17ns</td>
<td align="center">17ns</td>
</tr>
<tr>
<td align="center">内存引用</td>
<td align="center">100ns</td>
<td align="center">100ns</td>
<td align="center">100ns</td>
<td align="center">100ns</td>
<td align="center">100ns</td>
</tr>
<tr>
<td align="center">压缩1KB</td>
<td align="center">11us</td>
<td align="center">2us</td>
<td align="center">2us</td>
<td align="center">2us</td>
<td align="center">2us</td>
</tr>
<tr>
<td align="center">普通网络发送2KB</td>
<td align="center">45us</td>
<td align="center">8us</td>
<td align="center">1us</td>
<td align="center">250ns</td>
<td align="center">88ns</td>
</tr>
<tr>
<td align="center">SSD随机读</td>
<td align="center">18us</td>
<td align="center">17us</td>
<td align="center">17us</td>
<td align="center">16us</td>
<td align="center">16us</td>
</tr>
<tr>
<td align="center">从内存顺序读1MB</td>
<td align="center">301us</td>
<td align="center">95us</td>
<td align="center">30us</td>
<td align="center">9us</td>
<td align="center">5us</td>
</tr>
<tr>
<td align="center">在同一个数据中心环游</td>
<td align="center">500us</td>
<td align="center">500us</td>
<td align="center">500us</td>
<td align="center">500us</td>
<td align="center">500us</td>
</tr>
<tr>
<td align="center">从SSD顺序读1MB</td>
<td align="center">5ms</td>
<td align="center">2ms</td>
<td align="center">494us</td>
<td align="center">156us</td>
<td align="center">78us</td>
</tr>
<tr>
<td align="center">磁盘寻址</td>
<td align="center">10ms</td>
<td align="center">7ms</td>
<td align="center">5ms</td>
<td align="center">4ms</td>
<td align="center">3ms</td>
</tr>
<tr>
<td align="center">从磁盘顺序读1MB</td>
<td align="center">20ms</td>
<td align="center">7ms</td>
<td align="center">3ms</td>
<td align="center">2ms</td>
<td align="center">1ms</td>
</tr>
<tr>
<td align="center">从CA发包到Netherlands再回来</td>
<td align="center">150ms</td>
<td align="center">150ms</td>
<td align="center">150ms</td>
<td align="center">150ms</td>
<td align="center">150ms</td>
</tr>
</tbody></table>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/%E4%BF%AE%E6%94%B9MySQL%E5%AD%97%E7%AC%A6%E9%9B%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E4%BF%AE%E6%94%B9MySQL%E5%AD%97%E7%AC%A6%E9%9B%86/" class="post-title-link" itemprop="url">修改MySQL字符集</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-09-30 17:06:12" itemprop="dateCreated datePublished" datetime="2019-09-30T17:06:12+08:00">2019-09-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="0-缘起"><a href="#0-缘起" class="headerlink" title="0. 缘起"></a>0. 缘起</h1><p>开始用MySQL8.x，没注意字符集的事，只设了utf8mb4，COLLATE用了默认的utf8mb4_0900_ai_ci。</p>
<p>后来发现，每个现场的数据库，基本都是低版本，没有utf8mb4_0900_ai_ci这个字符集。</p>
<p>为了统一，将之前的utf8mb4_general_ci改为utf8mb4_0900_ai_ci。</p>
<p>总结：</p>
<p>之前的字符集：utf8mb4, utf8mb4_0900_ai_ci</p>
<p>修改后的字符集：utf8mb4, utf8mb4_general_ci</p>
<h1 id="1-思路"><a href="#1-思路" class="headerlink" title="1. 思路"></a>1. 思路</h1><ul>
<li>修改database的字符集</li>
<li>修改表的字符集</li>
<li>修改列的字符集</li>
</ul>
<h1 id="2-操作"><a href="#2-操作" class="headerlink" title="2. 操作"></a>2. 操作</h1><h2 id="2-1-全库备份，有备无患"><a href="#2-1-全库备份，有备无患" class="headerlink" title="2.1 全库备份，有备无患"></a>2.1 全库备份，有备无患</h2><p>略</p>
<h2 id="2-2-修改库的字符集"><a href="#2-2-修改库的字符集" class="headerlink" title="2.2 修改库的字符集"></a>2.2 修改库的字符集</h2><p>ALTER DATABASE SJZC CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;</p>
<h2 id="2-3-修改表的字符集"><a href="#2-3-修改表的字符集" class="headerlink" title="2.3 修改表的字符集"></a>2.3 修改表的字符集</h2><h3 id="2-3-1-生成SQL"><a href="#2-3-1-生成SQL" class="headerlink" title="2.3.1 生成SQL"></a>2.3.1 生成SQL</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	CONCAT( <span class="string">&#x27;ALTER TABLE &#x27;</span>, table_name, <span class="string">&#x27; CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci;&#x27;</span> ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	information_schema.TABLES <span class="keyword">AS</span> T,</span><br><span class="line">	information_schema.`COLLATION_CHARACTER_SET_APPLICABILITY` <span class="keyword">AS</span> C </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	C.collation_name <span class="operator">=</span> T.table_collation </span><br><span class="line">	<span class="keyword">AND</span> T.table_schema <span class="operator">=</span> <span class="string">&#x27;SJZC&#x27;</span> </span><br><span class="line">	<span class="keyword">AND</span> ( C.CHARACTER_SET_NAME <span class="operator">!=</span> <span class="string">&#x27;utf8mb4&#x27;</span> <span class="keyword">OR</span> C.COLLATION_NAME <span class="operator">!=</span> <span class="string">&#x27;utf8mb4_general_ci&#x27;</span> );</span><br></pre></td></tr></table></figure>

<h3 id="2-3-2-执行"><a href="#2-3-2-执行" class="headerlink" title="2.3.2 执行"></a>2.3.2 执行</h3><p>略</p>
<h2 id="2-4-修改列的字符集"><a href="#2-4-修改列的字符集" class="headerlink" title="2.4 修改列的字符集"></a>2.4 修改列的字符集</h2><h3 id="2-4-1-生成varchar列字符集"><a href="#2-4-1-生成varchar列字符集" class="headerlink" title="2.4.1 生成varchar列字符集"></a>2.4.1 生成varchar列字符集</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	CONCAT(</span><br><span class="line">		<span class="string">&#x27;ALTER TABLE `&#x27;</span>,</span><br><span class="line">		table_name,</span><br><span class="line">		<span class="string">&#x27;` MODIFY `&#x27;</span>,</span><br><span class="line">		column_name,</span><br><span class="line">		<span class="string">&#x27;` &#x27;</span>,</span><br><span class="line">		DATA_TYPE,</span><br><span class="line">		<span class="string">&#x27;(&#x27;</span>,</span><br><span class="line">		CHARACTER_MAXIMUM_LENGTH,</span><br><span class="line">		<span class="string">&#x27;) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci&#x27;</span>,</span><br><span class="line">		( <span class="keyword">CASE</span> <span class="keyword">WHEN</span> IS_NULLABLE <span class="operator">=</span> <span class="string">&#x27;NO&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27; NOT NULL&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">END</span> ),</span><br><span class="line">		<span class="string">&#x27;;&#x27;</span> </span><br><span class="line">) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	information_schema.COLUMNS </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	TABLE_SCHEMA <span class="operator">=</span> <span class="string">&#x27;SJZC&#x27;</span> </span><br><span class="line">	<span class="keyword">AND</span> DATA_TYPE <span class="operator">=</span> <span class="string">&#x27;varchar&#x27;</span> </span><br><span class="line">	<span class="keyword">AND</span> ( CHARACTER_SET_NAME <span class="operator">!=</span> <span class="string">&#x27;utf8mb4&#x27;</span> <span class="keyword">OR</span> COLLATION_NAME <span class="operator">!=</span> <span class="string">&#x27;utf8mb4_general_ci&#x27;</span> );</span><br></pre></td></tr></table></figure>



<h3 id="2-4-2-生成其他列字符集-text等"><a href="#2-4-2-生成其他列字符集-text等" class="headerlink" title="2.4.2 生成其他列字符集(text等)"></a>2.4.2 生成其他列字符集(text等)</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	CONCAT( <span class="string">&#x27;ALTER TABLE `&#x27;</span>, table_name, <span class="string">&#x27;` MODIFY `&#x27;</span>, column_name, <span class="string">&#x27;` &#x27;</span>, DATA_TYPE, <span class="string">&#x27; CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci&#x27;</span>, ( <span class="keyword">CASE</span> <span class="keyword">WHEN</span> IS_NULLABLE <span class="operator">=</span> <span class="string">&#x27;NO&#x27;</span> <span class="keyword">THEN</span> <span class="string">&#x27; NOT NULL&#x27;</span> <span class="keyword">ELSE</span> <span class="string">&#x27;&#x27;</span> <span class="keyword">END</span> ), <span class="string">&#x27;;&#x27;</span> ) </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	information_schema.COLUMNS </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	TABLE_SCHEMA <span class="operator">=</span> <span class="string">&#x27;SJZC&#x27;</span> </span><br><span class="line">	<span class="keyword">AND</span> DATA_TYPE <span class="operator">!=</span> <span class="string">&#x27;varchar&#x27;</span> </span><br><span class="line">	<span class="keyword">AND</span> ( CHARACTER_SET_NAME <span class="operator">!=</span> <span class="string">&#x27;utf8mb4&#x27;</span> <span class="keyword">OR</span> COLLATION_NAME <span class="operator">!=</span> <span class="string">&#x27;utf8mb4_general_ci&#x27;</span> );</span><br></pre></td></tr></table></figure>

<h3 id="2-4-3-执行"><a href="#2-4-3-执行" class="headerlink" title="2.4.3 执行"></a>2.4.3 执行</h3><p>略</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/CRON%E8%A1%A8%E8%BE%BE%E5%BC%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/CRON%E8%A1%A8%E8%BE%BE%E5%BC%8F/" class="post-title-link" itemprop="url">CRON表达式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-05-27 17:06:12" itemprop="dateCreated datePublished" datetime="2019-05-27T17:06:12+08:00">2019-05-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Spring Scheduler 和 Quartz都支持CRON来定义调度周期。</p>
<p>CRON表达式由「空格」分割的6部分组成，分别描述「秒、分、时、天、月、周」。</p>
<p>每部分可以用「星号(*)、数字(0~9)、斜线(/)、逗号(,)、横线(-)」表示，月 和 周还可以用前3个英文字母。</p>
<ul>
<li>数字(0~9)：</li>
<li>星号(*)：所有取值范围的数字</li>
<li>斜线(/)：代表每，*/5 即每5个单位</li>
<li>逗号(,)：几个离散的数字</li>
<li>横线(-)：连续的数字</li>
</ul>
<p>例子：</p>
<ul>
<li>“0 0 * * * *” = 每天每个小时的整点</li>
<li>“*/10 * * * * *” = 每10秒钟</li>
<li>“0 0 8-10 * * *” = 每天的8,9,10整点</li>
<li>“0 0 6,19 * * *” = 每天的6点和19点两个整点</li>
<li>“0 0/30 8-10 * * *” = 每天的8:00, 8:30, 9:00, 9:30, 10:00 和 10:30</li>
<li>“0 0 9-17 * * MON-FRI” = 周一到周五每天的9~17点整点</li>
<li>“0 0 0 25 12 ?” = 每个圣诞夜0点</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/SQL%E7%9A%84like%E4%B8%AD%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D%E7%99%BE%E5%88%86%E5%8F%B7%EF%BC%85/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/SQL%E7%9A%84like%E4%B8%AD%E6%A8%A1%E7%B3%8A%E5%8C%B9%E9%85%8D%E7%99%BE%E5%88%86%E5%8F%B7%EF%BC%85/" class="post-title-link" itemprop="url">SQL的like中模糊匹配百分号％</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-27 17:06:12" itemprop="dateCreated datePublished" datetime="2019-03-27T17:06:12+08:00">2019-03-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>SQL用like做模糊匹配，如下所示：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> student</span><br><span class="line"><span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;张%&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这样就能匹配到所有姓「张」的学生。</p>
<p>但这里有个问题，就是当我要匹配的内容中有「%」该怎么办？</p>
<p>这就用到<code>escape</code>了。</p>
<p><strong>比如：</strong> 找出名字中含有「%」的论文：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> paper</span><br><span class="line"><span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%\%%&#x27;</span> <span class="keyword">escape</span> <span class="string">&#x27;\&#x27;</span></span><br></pre></td></tr></table></figure>

<p><code>escape</code>的意思是：后面的内容<code>\</code>是前面字符串<code>%\%%</code>的转义字符。这样前面字符串中的第2个<code>%</code>将不再认为是通配符，而被认为是要匹配的内容。</p>
<p><code>escape</code> 只作用于一个like，当出现多个like都需要转义时，每一个like后面都需要加<code>escape</code>。</p>
<p><strong>比如：</strong> 找出名字 或 内容中含有「%」的论文：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> paper</span><br><span class="line"><span class="keyword">where</span> name <span class="keyword">like</span> <span class="string">&#x27;%\%%&#x27;</span> <span class="keyword">escape</span> <span class="string">&#x27;\&#x27;</span> <span class="keyword">or</span> content <span class="keyword">like</span> <span class="string">&#x27;%\%%&#x27;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/%E3%80%8C%E8%BD%AC%E3%80%8DNaval%EF%BC%9A%E5%A6%82%E4%BD%95%E4%B8%8D%E9%9D%A0%E8%BF%90%E6%B0%94%E8%87%B4%E5%AF%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E3%80%8C%E8%BD%AC%E3%80%8DNaval%EF%BC%9A%E5%A6%82%E4%BD%95%E4%B8%8D%E9%9D%A0%E8%BF%90%E6%B0%94%E8%87%B4%E5%AF%8C/" class="post-title-link" itemprop="url">「转」Naval：如何不靠运气致富</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-27 17:06:12" itemprop="dateCreated datePublished" datetime="2019-03-27T17:06:12+08:00">2019-03-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="注：-本文转自-和菜头-的-槽边往事。"><a href="#注：-本文转自-和菜头-的-槽边往事。" class="headerlink" title="注： 本文转自 和菜头 的 槽边往事。"></a><strong>注：</strong> 本文转自 和菜头 的 槽边往事。</h1><p>一般来说，富人不会分享自己发家致富的秘密。所以，有互联网以来，我看到许多在网上教人致富的人都发了财。在英文博客界，写关于如何发财的博文成为了一个专门的门类。而真正的有钱人只会用心灵鸡汤敷衍一下大众，根本不会提供任何方法论，更不要说是致富秘诀了。</p>
<p>也有例外。硅谷投资人<strong>Naval Ravikant</strong>在5月31日突然一口气发了40条语录，内容就是关于如何不靠运气而致富。随后这40条文字被不断转发，翻译为多国语言，这一事件史称“推文风暴”。Naval是印度裔移民，20多年来一直在美国硅谷创业。他最著名的创业项目是AngelList，世界股权众筹平台的鼻祖；他最著名的投资项目有两个，一个是Twitter，一个是Uber。</p>
<p>奇怪的是，国内互联网上的反响并不强烈。按理说这应该是中国人最感兴趣的话题了，而且要比各种心灵鸡汤高好几个段位，为什么会遭到冷遇呢？我分析了一下原因，主要有两点：1、网上的版本翻译得不好，每个中文字都认识，连起来看就不懂了；2、致富这个话题在中文互联网里，已经被鸡汤严重污染了，所以许多人根本理解不了Naval在说什么。</p>
<p>因此，我决定自己翻译并且注释一下Naval的40条语录：</p>
<p><strong>How to Get Rich (without getting lucky)</strong></p>
<p><strong>《如何不靠运气致富》</strong></p>
<p>作者：<strong>Naval Ravikant</strong></p>
<p>翻译&amp;注释：<strong>和菜头</strong></p>
<ol>
<li>Seek wealth, not money or status. Wealth is having assets that earn while you sleep. Money is how we transfer time and wealth. Status is your place in the social hierarchy.</li>
</ol>
<blockquote>
<p>去寻求财富，而非金钱或地位。财富就是你拥有资产，而资产在你睡觉的时候都还在为你赚钱；金钱是我们转换时间和财富的工具；身份是你在社会等级体系里所处的位置。</p>
</blockquote>
<ol start="2">
<li>Understand that ethical wealth creation is possible. If you secretly despise wealth, it will elude you.</li>
</ol>
<blockquote>
<p>要明白一件事：一个人完全可以不靠坑蒙拐骗站着赚取财富。如果你在暗中鄙视财富，那么财富也会躲着你。</p>
</blockquote>
<ol start="3">
<li>Ignore people playing status games. They gain status by attacking people playing wealth creation games.</li>
</ol>
<blockquote>
<p>别去理会那些热衷于玩身份游戏的人，他们通过攻击那些创造财富的人以获得自己的身份。</p>
</blockquote>
<ol start="4">
<li>You’re not going to get rich renting out your time. You must own equity — a piece of a business — to gain your financial freedom.</li>
</ol>
<blockquote>
<p>你不会通过出租自己的时间而变得富有。你必须拥有产权，也就是生意的一部分，以此才能赢得个人财务自由。</p>
</blockquote>
<ol start="5">
<li>You will get rich by giving society what it wants but do</li>
</ol>
<p>es not yet know how to get. At scale.</p>
<blockquote>
<p>提供社会大众想要但是他们还不知道如何获取的东西，你就会因此而致富。但有一点：你必须<strong>规模化</strong>地供应社会。</p>
</blockquote>
<ol start="6">
<li>Pick an industry where you can play long term games with long term people.</li>
</ol>
<blockquote>
<p>选择一个你可以长期从事的产业，寻找一批可以一起长期共事的人。</p>
</blockquote>
<ol start="7">
<li>The Internet has massively broadened the possible space of careers. Most people haven’t figured this out yet.</li>
</ol>
<blockquote>
<p>互联网极大拓展了一个人职业生涯的可能性。绝大多数人对此毫无认知。</p>
</blockquote>
<ol start="8">
<li>Play iterated games. All the returns in life, whether in wealth, relationships, or knowledge, come from compound interest.</li>
</ol>
<blockquote>
<p>玩就玩复利游戏。无论是财富，人际关系或者是知识，所有你人生里获得的回报，都来自复利。</p>
</blockquote>
<ol start="9">
<li>Pick business partners with high intelligence, energy, and, above all, integrity.</li>
</ol>
<blockquote>
<p>在选择商业合作伙伴的时候，选择那些高智商、精力旺盛的家伙，但在这一切之上，他应该是个<strong>正直诚实</strong>的人。</p>
</blockquote>
<ol start="10">
<li>Don’t partner with cynics and pessimists. Their beliefs are self-fulfilling.</li>
</ol>
<blockquote>
<p>不要和愤世嫉俗者和悲观主义者合作，因为他们会任由坏事发生，以此证明他们的负面看法是正确的。</p>
</blockquote>
<ol start="11">
<li>Learn to sell. Learn to build. If you can do both, you will be unstoppable.</li>
</ol>
<blockquote>
<p>学会如何销售，学会如何创建。如果你同时能做到这两件事，你的成功将无可阻挡。</p>
</blockquote>
<ol start="12">
<li>Arm yourself with specific knowledge, accountability, and leverage.</li>
</ol>
<blockquote>
<p><strong>用独到知识，责任感和杠杆武装自己。</strong></p>
</blockquote>
<ol start="13">
<li>Specific knowledge is knowledge that you cannot be trained for. If society can train you, it can train someone else, and replace you.</li>
</ol>
<blockquote>
<p><strong>独到知识</strong>是那种不可以通过培训而获得的知识。这是因为，如果这种知识可以经由培训而得，那么其他人同样也可以，并且以此取代你。</p>
</blockquote>
<ol start="14">
<li>Specific knowledge is found by pursuing your genuine curiosity and passion rather than whatever is hot right now.</li>
</ol>
<blockquote>
<p>在真正的好奇心和热情驱使你前进的路上，你更有可能获得独到知识，而不是在追逐潮流热点的闻风起舞脚步里。</p>
</blockquote>
<ol start="15">
<li>Building specific knowledge will feel like play to you but will look like work to others.</li>
</ol>
<blockquote>
<p>创建独到知识的过程对于你就像是在玩，而对于别人则像是工作。</p>
</blockquote>
<ol start="16">
<li>When specific knowledge is taught, it’s through apprenticeships, not schools.</li>
</ol>
<blockquote>
<p>不能通过学校教育教会一个人独到知识，它只能通过<strong>学徒制</strong>口传身教。</p>
</blockquote>
<ol start="17">
<li>Specific knowledge is often highly technical or creative. It cannot be outsourced or automated.</li>
</ol>
<blockquote>
<p>独到知识通常极富技术性和创造性，因此它不能被外包或自动实现。</p>
</blockquote>
<ol start="18">
<li>Embrace accountability, and take business risks under your own name. Society will reward you with responsibility, equity, and leverage.</li>
</ol>
<blockquote>
<p>拥抱责任感，押上自己的声誉以承担商业风险。社会也会以责任，产权和杠杆作为回报。</p>
</blockquote>
<ol start="19">
<li>The most accountable people have singular, public, and risky brands: Oprah, Trump, Kanye, Elon.</li>
</ol>
<blockquote>
<p>最具责任感的人都具有独一无二的、世人皆知的、敢于冒险的个性特征，如奥普拉、川普、坎耶、埃隆。</p>
</blockquote>
<ol start="20">
<li>“Give me a lever long enough, and a place to stand, and I will move the earth.” — Archimedes</li>
</ol>
<blockquote>
<p>只要给我一根足够长的杠杆，一处可以立足的地方，我就能撬起地球。——阿基米德</p>
</blockquote>
<ol start="21">
<li>Fortunes require leverage. Business leverage comes from capital, people, and products with no marginal cost of replication (code and media).</li>
</ol>
<blockquote>
<p>财富增长需要使用杠杆。商业杠杆有三个来源：1、资本；2、人力；3、复制起来边际成本为零的产品（如：代码和媒体）。</p>
</blockquote>
<ol start="22">
<li>Capital means money. To raise money, apply your specific knowledge, with accountability, and show resulting good judgment.</li>
</ol>
<blockquote>
<p>资本的意思就是钱。想要融资，那就运用你的独到知识，配合你责任感，展示出你良好的判断力。</p>
</blockquote>
<ol start="23">
<li>Labor means people working for you. It’s the oldest and most fought-over form of leverage. Labor leverage will impress your parents, but don’t waste your life chasing it.</li>
</ol>
<blockquote>
<p>人力指的就是为你干活的人，它是最古老也是争夺最激烈的杠杆。人力杠杆会让你父母因为你手下有许多人为你工作而感到骄傲，但你不要浪费生命去追求这一点。</p>
</blockquote>
<ol start="24">
<li>Capital and labor are permissioned leverage. Everyone is chasing capital, but someone has to give it to you. Everyone is trying to lead, but someone has to follow you.</li>
</ol>
<blockquote>
<p>资本和劳动力是需要征得许可才能使用的杠杆。每个人都在追逐资本，但总得有个什么人给你才行；每个人都想要领导其它人，但总得有什么人愿意跟着你才行。</p>
</blockquote>
<ol start="25">
<li>Code and media are permissionless leverage. They’re the leverage behind the newly rich. You can create software and media that works for you while you sleep.</li>
</ol>
<blockquote>
<p>代码和媒体是无需要许可即可使用的杠杆。它们是新贵人群背后的杠杆，你可以通过自己创建的软件和媒体，在睡觉时仍然为你干活。</p>
</blockquote>
<ol start="26">
<li>An army of robots is freely available — it’s just packed in data centers for heat and space efficiency. Use it.</li>
</ol>
<blockquote>
<p>一支机器人军团已经集结待命，只是为了节约空间和热效能，它们被打包放进数据中心。去用吧。</p>
</blockquote>
<ol start="27">
<li>If you can’t code, write books and blogs, record videos and podcasts.</li>
</ol>
<blockquote>
<p>如果你不会编程，那你还可以写书和博客，或者做视频或者音频节目。</p>
</blockquote>
<ol start="28">
<li>Leverage is a force multiplier for your judgement.</li>
</ol>
<blockquote>
<p>杠杆能够成倍地放大你的判断力（所产生的效能）。</p>
</blockquote>
<ol start="29">
<li>Judgement requires experience, but can be built faster by learning foundational skills.</li>
</ol>
<blockquote>
<p>判断力需要经验，但它可以通过学习基本技能的方法更快速地建立起来。</p>
</blockquote>
<ol start="30">
<li>There is no skill called “business.” Avoid business magazines and business classes.</li>
</ol>
<blockquote>
<p>并不存在一种叫做“商业”的能力。尽量避开商业杂志和商业课程。</p>
</blockquote>
<ol start="31">
<li>Study microeconomics, game theory, psychology, persuasion, ethics, mathematics, and computers.</li>
</ol>
<blockquote>
<p>去学习微观经济学、博弈论、心理学、说服术、伦理学、数学和计算机科学。</p>
</blockquote>
<ol start="32">
<li>Reading is faster than listening. Doing is faster than watching.</li>
</ol>
<blockquote>
<p>读比听快，做比看快。</p>
</blockquote>
<ol start="33">
<li>You should be too busy to “do coffee,” while still keeping an uncluttered calendar.</li>
</ol>
<blockquote>
<p>你应该忙得没有社交的时间才对，与此同时你应该始终保证日程安排井井有条。</p>
</blockquote>
<ol start="34">
<li>Set and enforce an aspirational personal hourly rate. If fixing a problem will save less than your hourly rate, ignore it. If outsourcing a task will cost less than your hourly rate, outsource it.</li>
</ol>
<blockquote>
<p>你应该为自己设定一个有抱负的个人时薪数，并且坚持执行。如果解决一个问题所能节省下来的成本低于你的个人时薪，那就忽略这个问题好了；如果一项任务的外包成本低于你的个人时薪，就把它外包出去。</p>
</blockquote>
<ol start="35">
<li>Work as hard as you can. Even though who you work with and what you work on are more important than how hard you work.</li>
</ol>
<blockquote>
<p>尽管你跟谁一起工作、做什么工作，要远比你的努力程度更加重要。但还是要倾尽全力去工作。</p>
</blockquote>
<ol start="36">
<li>Become the best in the world at what you do. Keep redefining what you do until this is true.</li>
</ol>
<blockquote>
<p>你所做的事情，要努力做到世界最好。不断重新定义你在做什么，直到真的做到世界最好。</p>
</blockquote>
<ol start="37">
<li>There are no get rich quick schemes. That’s just someone else getting rich off you.</li>
</ol>
<blockquote>
<p>这个世界上并没有快速赚钱致富的方法，如果你想要找寻这种方法，那它只会让别人从你身上赚钱致富。</p>
</blockquote>
<ol start="38">
<li>Apply specific knowledge, with leverage, and eventually you will get what you deserve.</li>
</ol>
<blockquote>
<p>运用你的独到知识，配合上杠杆，最终你会得到你应该得到的东西。</p>
</blockquote>
<ol start="39">
<li>When you’re finally wealthy, you’ll realize that it wasn’t what you were seeking in the first place. But that’s for another day.</li>
</ol>
<blockquote>
<p>终有一天当你变得富有，你会发现那一切并不是你最开始想要的东西。但是那就是另外一回事了。</p>
</blockquote>
<p><strong>注释：</strong></p>
<p>1、财富就是你睡着觉，你的资产也在为你继续赚钱。这是一个越来越被广泛接受的定义。Naval Ravikant是硅谷狂热的数字货币支持者，所以，他的话另有所指。从前后文来看，他所谓的资产并不等于是传统意义上的房产、股票、收藏，而是偏向于他反复提及的：软件和媒体。</p>
<p>2、出租时间概念，许多人理解为打工，认为打工就是出租自己的时间以换取金钱。其实并非如此，Naval所指的出租时间概念，指的是一个人的财富增长，是否直接关系到他的时间。一个小卖部的老板，他并不为谁打工，但是他的财富增长需要他长时间守在店里，因此，他依然是出租时间换钱。但一个淘宝点卡店老板则不同，他的点卡销售是全自动的，不需要24小时守着，而且也不需要只做这一样生意。这就是Naval所谓互联网拓宽了个人职业生涯的一个例子。</p>
<p>3、equity我翻译为产权，不是一个很好的翻法。但是Naval前文提到assets，很明显，作为投资人他非常清楚地知道这两个字眼之间的区别。equity无论是翻译为股票、权益或者是资产，原文说“ You must own equity — a piece of a business — to gain your financial freedom.”，这是和出租时间概念做对应的。出租时间的人，在商业链条里作为生产资料出现，不拥有任何产权，也就无法通过商业行为获利，所以，我这里勉强翻译为产权。</p>
<p>4、specific knowledge我翻译为独到知识，没有翻译为特定知识、专业知识或者是特殊知识。原因是在我的理解中，specific knowledge不是书本知识，也不是学校教授的知识，更不可能在网上免费获取。一方面，它只能提供自己实践来获取；另一方面，它只能通过前人口耳相传。这种知识是做成一件事情的关键，属于知识体系中不共的那一部分。所以，我翻译为独到知识。</p>
<p>5、“Give me a lever long enough, and a place to stand, and I will move the earth.” — Archimedes 这话不像是阿基米德说的。更像是一次抬杠的结果：</p>
<p>“给我一个支点，我就能撬起地球！”</p>
<p>“那么，您站在哪儿呢？”</p>
<p>“好吧，给我一个支点，再给我一个站立的地方，我就能撬起地球。”</p>
<p>“那么，您用空气就能撬起地球了？”</p>
<p>“好吧，给我一根足够长的杠杆，一处可以立足的地方，我就可以翘起地球！”</p>
<p>“那么，阿基米德先生，支点又不需要了吗？”</p>
<p>“滚！”</p>
<p>6、accountability我本想翻译为“靠谱程度”，想想还是算了。</p>
<p>7、号称是“四十条语录”，但是我就找见了39条。</p>
<p>8、结合上下文看，Leverage一词始终翻译为“杠杆”其实也不大对头。Naval一再强调代码、博客、播客、视频节目，我觉得Leverage在他那里，有些时候应该相当于是个人影响力的代名词，或者可以简单理解为放大器。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/SVN%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/SVN%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/" class="post-title-link" itemprop="url">SVN常用指令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-12-29 17:06:12" itemprop="dateCreated datePublished" datetime="2018-12-29T17:06:12+08:00">2018-12-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>使用SVN命令行的机会不多，一般也不想用，但无可奈何之时，也要用它来救命。</p>
<h1 id="1-checkout，从仓库把代码拉到本地"><a href="#1-checkout，从仓库把代码拉到本地" class="headerlink" title="1. checkout，从仓库把代码拉到本地"></a>1. checkout，从仓库把代码拉到本地</h1><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 介绍：</span></span><br><span class="line">svn checkout path</span><br><span class="line"><span class="comment"># 例子：</span></span><br><span class="line">svn checkout svn://host/project/www</span><br><span class="line"><span class="comment"># 简写：</span></span><br><span class="line">svn checkout svn://host/project/www</span><br></pre></td></tr></table></figure>

<h1 id="2-status，当前目录下的状态"><a href="#2-status，当前目录下的状态" class="headerlink" title="2. status，当前目录下的状态"></a>2. status，当前目录下的状态</h1><p>这大概是最常用的指令了。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 介绍：</span></span><br><span class="line">svn status [path]</span><br><span class="line"><span class="meta">#</span><span class="bash"> 例子：</span></span><br><span class="line">svn status</span><br><span class="line"><span class="meta">#</span><span class="bash"> 简写：</span></span><br><span class="line">svn st</span><br></pre></td></tr></table></figure>

<h1 id="3-add，文件交给SVN管理"><a href="#3-add，文件交给SVN管理" class="headerlink" title="3. add，文件交给SVN管理"></a>3. add，文件交给SVN管理</h1><p>如果只是增加了文件，没有add，虽然在这个文件夹下，svn是不会自动管理的，除非你add。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 介绍：</span></span><br><span class="line">svn add path</span><br><span class="line"><span class="meta">#</span><span class="bash"> 例子：</span></span><br><span class="line">svn add *</span><br><span class="line">svn add readme.txt</span><br><span class="line">svn add *.java</span><br></pre></td></tr></table></figure>

<h1 id="4-commit，将文件提交"><a href="#4-commit，将文件提交" class="headerlink" title="4. commit，将文件提交"></a>4. commit，将文件提交</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">svn commit -m &quot;comment&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash">简写</span></span><br><span class="line">svn ci -m &quot;comment&quot;</span><br></pre></td></tr></table></figure>

<h1 id="5-delete，删除文件"><a href="#5-delete，删除文件" class="headerlink" title="5. delete，删除文件"></a>5. delete，删除文件</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">svn delete path -m &quot;comment&quot;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B9%8B%E6%88%91%E8%A7%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B9%8B%E6%88%91%E8%A7%81/" class="post-title-link" itemprop="url">单元测试之我见</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-10-29 17:06:12" itemprop="dateCreated datePublished" datetime="2018-10-29T17:06:12+08:00">2018-10-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>工作中，我习惯性的写单元测试。</p>
<p>我并没有受过专业的单元测试训练，也没有别人的指导和要求，是自己这几年工作下来，在没有外在要求的环境中，自己养成的习惯。</p>
<p>我知道这个习惯给我的工作带来了不小的帮助，这次把它写出来，是自己的一次总结，写给自己。</p>
<p>如果你读到了，也可以作为参考。</p>
<h2 id="1-什么是单元测试？"><a href="#1-什么是单元测试？" class="headerlink" title="1. 什么是单元测试？"></a>1. 什么是单元测试？</h2><p>先看「维基百科」怎么说：</p>
<blockquote>
<p>在<a href="https://zh.wikipedia.org/wiki/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BC%96%E7%A8%8B">计算机编程</a>中，<strong>单元测试</strong>（英语：Unit Testing）又称为<strong>模块测试</strong>, 是针对<a href="https://zh.wikipedia.org/wiki/%E6%A8%A1%E7%B5%84_(%E7%A8%8B%E5%BC%8F%E8%A8%AD%E8%A8%88)">程序模块</a>（<a href="https://zh.wikipedia.org/wiki/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1">软件设计</a>的最小单位）来进行正确性检验的测试工作。程序单元是应用的最小可测试部件。在<a href="https://zh.wikipedia.org/wiki/%E9%81%8E%E7%A8%8B%E5%8C%96%E7%B7%A8%E7%A8%8B">过程化编程</a>中，一个单元就是单个程序、函数、过程等；对于面向对象编程，最小单元就是方法，包括基类（超类）、抽象类、或者派生类（子类）中的方法。</p>
<p>通常来说，程式设计师每修改一次程式就会进行最少一次单元测试，在编写程式的过程中前后很可能要进行多次单元测试，以证实程式达到<a href="https://zh.wikipedia.org/wiki/%E8%A6%8F%E6%A0%BC_(%E6%8A%80%E8%A1%93%E6%A8%99%E6%BA%96)">软件规格书</a>要求的工作目标，没有<a href="https://zh.wikipedia.org/wiki/Bug">程序错误</a>；虽然单元测试不是什么必须的，但也不坏，这牵涉到<a href="https://zh.wikipedia.org/wiki/%E5%B0%88%E6%A1%88%E7%AE%A1%E7%90%86">专案管理</a>的政策决定。</p>
<p>每个理想的<a href="https://zh.wikipedia.org/wiki/%E6%B5%8B%E8%AF%95%E6%A1%88%E4%BE%8B">测试案例</a>独立于其它案例；为测试时隔离模块，经常使用stubs、mock[<a href="https://zh.wikipedia.org/zh-hans/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95#cite_note-mocksarentstubs-1">1]</a>或fake等测试<a href="https://zh.wikipedia.org/w/index.php?title=%E9%A9%AC%E7%94%B2%E7%A8%8B%E5%BA%8F&action=edit&redlink=1">马甲程序</a>。单元测试通常由<a href="https://zh.wikipedia.org/w/index.php?title=%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E4%BA%BA%E5%91%98&action=edit&redlink=1">软件开发人员</a>编写，用于确保他们所写的代码符合软件需求和遵循<a href="https://zh.wikipedia.org/w/index.php?title=%E5%BC%80%E5%8F%91%E7%9B%AE%E6%A0%87&action=edit&redlink=1">开发目标</a>。它的实施方式可以是非常手动的（透过纸笔），或者是做成<a href="https://zh.wikipedia.org/wiki/%E6%A7%8B%E5%BB%BA%E8%87%AA%E5%8B%95%E5%8C%96">构建自动化</a>的一部分。</p>
</blockquote>
<p>下面是我个人理解。</p>
<h3 id="1-1-是开发过程的一部分"><a href="#1-1-是开发过程的一部分" class="headerlink" title="1.1 是开发过程的一部分"></a>1.1 是开发过程的一部分</h3><p>「单元测试」虽名为「测试」，却是开发人员干的活，在开发阶段测试自己「即将写的代码」或「刚写好的代码」是否完成自己预期的功能。</p>
<p>在写代码的过程中，要知道自己在写的功能是干什么的，怎么知道这部分功能是对的，整个思考实现的过程，脑中一直都有个抽象的模型。当完成模型中的一小块功能后，马上验证下对与不对，再继续后面的工作。</p>
<h3 id="1-2-是为开发服务的"><a href="#1-2-是为开发服务的" class="headerlink" title="1.2 是为开发服务的"></a>1.2 是为开发服务的</h3><p>我不太赞成强制为所有代码写单元测试，并过度强调测试覆盖，这样的结果会让我全身不自在，像被绑起来一样。写代码是要有一定的自由度的。</p>
<p>要求高的时候，单元测试是产品的一部分，要为产品的质量保驾护航。大部分情况下，单元测试是为我服务，而不是我去满足单元测试的各种要求。</p>
<p>换句话说，是因为它能给我带来帮助，对我有益，我才愿意去写它。</p>
<h3 id="1-3-是一个验证的工作"><a href="#1-3-是一个验证的工作" class="headerlink" title="1.3 是一个验证的工作"></a>1.3 是一个验证的工作</h3><p>我知道自己写的代码，大多数时候，不是一次就能写对的。</p>
<p>与其让别人告诉我代码有问题，不如我自己先验证一下。</p>
<h3 id="1-4-是针对单一功能"><a href="#1-4-是针对单一功能" class="headerlink" title="1.4 是针对单一功能"></a>1.4 是针对单一功能</h3><p>单元测试是针对单一功能，如果功能很多，出现了问题将很难准确定位。</p>
<p>写代码应该是件简单的事，将多个简单的功能都写对了，再将之组合起来，出现问题的概率会大大降低。</p>
<p>单一功能更方便测试，功能多了，要测试的点也多了，单元测试往往没办法写下去。</p>
<h2 id="2-为什么要写单元测试？"><a href="#2-为什么要写单元测试？" class="headerlink" title="2. 为什么要写单元测试？"></a>2. 为什么要写单元测试？</h2><p>如果没有外在的要求，可能很多人不愿意写单元测试。我为什么要写单元测试？</p>
<h3 id="2-1-直接写出来的代码，往往是不对的"><a href="#2-1-直接写出来的代码，往往是不对的" class="headerlink" title="2.1 直接写出来的代码，往往是不对的"></a>2.1 直接写出来的代码，往往是不对的</h3><p>或许有人能将代码一次写对，这是我羡慕的。</p>
<p>我也想一次把代码写对，但我的经验告诉我，这对我太难，难到几乎做不到。</p>
<p>于是我对自己降低了要求，不要求自己第一次写出来的代码是对的，要求自己每次提交的代码是对的。</p>
<p>在提交代码之前，多测试一下，这样做到的概率大大提高了。</p>
<h3 id="2-2-更低的调试成本"><a href="#2-2-更低的调试成本" class="headerlink" title="2.2 更低的调试成本"></a>2.2 更低的调试成本</h3><p>自己要测试，用的Java又是静态语言，Hotswap并不是很有效，经常需要重启JVM。</p>
<p>如果做的项目小，启动时间在10秒以内，那也罢了。</p>
<p>大多数时候，不是启Tomcat，就是启Weblogic，启动时间都是分钟级别的，这样测试验证的时间成本太高了，改代码10秒钟，测试一下3分钟，结果是：更少的测试。</p>
<p>用单元测试就好多了，就算用Spring加载一大堆东西，启动时间也在10秒内。</p>
<h3 id="2-3-代码修改后，仍需要验证"><a href="#2-3-代码修改后，仍需要验证" class="headerlink" title="2.3 代码修改后，仍需要验证"></a>2.3 代码修改后，仍需要验证</h3><p>有句话叫：代码不是写出来的，是改出来的。</p>
<p>很少有代码是写出来不用修改的。或是因为需求变了，或是因为前期没有考虑周全，或是因为实际情况与预期的不完全一致。</p>
<p>不管什么原因导致的修改，改了总需要再验证一下，看看改的是不是对的。</p>
<p>所以，单元测试不只是第一次写的时候有用。如果换个人过来改，有没有 单元测试，区别不是一般的大。</p>
<h3 id="2-4-验证部分功能"><a href="#2-4-验证部分功能" class="headerlink" title="2.4 验证部分功能"></a>2.4 验证部分功能</h3><p>如果不写单元测试，想测试部分功能，往往是做不到的。组合在一起是一个功能，内部有很多小功能组成，而出问题是其中的一个，要测试这一个的需要满足N个条件，这种情况下，测试变成了个麻烦事。</p>
<p>有了单元测试，就方便多了。写代码的人，更愿意用代码解决问题，而不是花很多时间去搭建测试环境、创造测试条件。</p>
<h2 id="3-如何知道该写一个单元测试了？"><a href="#3-如何知道该写一个单元测试了？" class="headerlink" title="3. 如何知道该写一个单元测试了？"></a>3. 如何知道该写一个单元测试了？</h2><p>代码分2种：一种要单元测试的，另一种是不需要写单元测试的。</p>
<p>如何区分这2种呢？</p>
<h3 id="3-1-一个独立的功能"><a href="#3-1-一个独立的功能" class="headerlink" title="3.1 一个独立的功能"></a>3.1 一个独立的功能</h3><p>业务上是独立的功能，一般是要写一个测试Case的。</p>
<p>功能的划分，是设计阶段 要完成的。</p>
<p>独立的功能是单元测试的必要条件。</p>
<p>如果一个人说，他的代码没办法写单元测试，我会将之等价于：没有设计，没有模块化，自己都不知道在写什么，代码一团糟。。。</p>
<p>这种情况，不改代码真的没办法写单元测试。</p>
<h3 id="3-2-容易出错"><a href="#3-2-容易出错" class="headerlink" title="3.2 容易出错"></a>3.2 容易出错</h3><p>一个地方是否容易出错，写代码的人是能感觉到的。</p>
<p>比如：我对Mybatis写的查询，全部要做单元测试。因为它的SQL是写到XML文件中，没有编译器的保证，肉眼识别没那么靠谱，测一下就放心多了。</p>
<h3 id="3-3-是接口"><a href="#3-3-是接口" class="headerlink" title="3.3 是接口"></a>3.3 是接口</h3><p>接口几乎总是满足测试条件的，也几乎总是要测试的。</p>
<h3 id="3-4-有算法"><a href="#3-4-有算法" class="headerlink" title="3.4 有算法"></a>3.4 有算法</h3><p>用Java写的代码，需要设计算法的时候并不多，一旦有，就需要认真对待，算法要考虑周全嘛！</p>
<p>所以，写算法的代码时，就要准备好各个测试点。</p>
<h2 id="4-怎么写一个单元测试？"><a href="#4-怎么写一个单元测试？" class="headerlink" title="4. 怎么写一个单元测试？"></a>4. 怎么写一个单元测试？</h2><p>写单元测试要做哪些事？</p>
<h3 id="4-1-测试的功能本身独立"><a href="#4-1-测试的功能本身独立" class="headerlink" title="4.1 测试的功能本身独立"></a>4.1 测试的功能本身独立</h3><p>独立的功能是一个基本要求，功能或大或小，要独立起来算一个功能，有输入输出，更直白的说，有一个函数，最好是纯函数。</p>
<p>如果没有，先安全的处理下代码。</p>
<p>参考书籍：《重构，改善既有的代码设计》。</p>
<h3 id="4-2-工具生成测试代码框架"><a href="#4-2-工具生成测试代码框架" class="headerlink" title="4.2 工具生成测试代码框架"></a>4.2 工具生成测试代码框架</h3><p>这是开发工具都会带的功能，根据源代码，生成测试这些代码的框架性的代码。</p>
<p>比如：Intellij IDEA的「JUnit」插件。</p>
<h3 id="4-3-基本功能的测试"><a href="#4-3-基本功能的测试" class="headerlink" title="4.3 基本功能的测试"></a>4.3 基本功能的测试</h3><p>常规的输入输出，必做的。</p>
<h3 id="4-4-异常Case测试"><a href="#4-4-异常Case测试" class="headerlink" title="4.4 异常Case测试"></a>4.4 异常Case测试</h3><p>我是会分情况来做异常Case测试。经常将之省去。</p>
<h3 id="4-5-性能测试"><a href="#4-5-性能测试" class="headerlink" title="4.5 性能测试"></a>4.5 性能测试</h3><p>用单元测试跑跑，测一下性能也无不可。代码灵活嘛！</p>
<p>用单元测试的功能，启若干个线程，压一压性能，有时还是比专业工具更得心应手。</p>
<h2 id="5-方法与技巧"><a href="#5-方法与技巧" class="headerlink" title="5. 方法与技巧"></a>5. 方法与技巧</h2><p>如何知道自己测试的结果是对的？</p>
<h3 id="5-1-Print"><a href="#5-1-Print" class="headerlink" title="5.1 Print"></a>5.1 Print</h3><p>将输出打印出来，自己判断一下。</p>
<p>没办法自动化，要靠人来判断。</p>
<p>用起来最简单。</p>
<p>还可以再偷个懒，debug启动，加个断点，连输出都不需要了。</p>
<h3 id="5-2-Assert"><a href="#5-2-Assert" class="headerlink" title="5.2 Assert"></a>5.2 Assert</h3><p>单元测试自动化的基石。</p>
<p><img src="../images/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B9%8B%E6%88%91%E8%A7%81/image-20200226233216316.png" alt="image-20200226233216316"></p>
<h3 id="5-3-Mock"><a href="#5-3-Mock" class="headerlink" title="5.3 Mock"></a>5.3 Mock</h3><p>复杂的单元测试，能避免最好，如果一定需要，那就用吧！</p>
<p>比如下面的情况：</p>
<p><img src="../images/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B9%8B%E6%88%91%E8%A7%81/006tNbRwly1fwp1amtetkj30jj05tmza.jpg" alt="006tNbRwly1fwp1amtetkj30jj05tmza"></p>
<p>当类A中有属性B 和 C，B中又有D和E时，为了测试A，需要先创建4个对象b,c,d,e，而我们却不测试它，这不合道理。</p>
<p>我们可以做2个假的对象mockB和 mockC，用假的对象返回期望值，来测试类A。</p>
<p><img src="../images/%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95%E4%B9%8B%E6%88%91%E8%A7%81/006tNbRwly1fwp1akyjotj30ji06z40f.jpg" alt="006tNbRwly1fwp1akyjotj30ji06z40f"></p>
<h2 id="6-例子"><a href="#6-例子" class="headerlink" title="6. 例子"></a>6. 例子</h2><p>最后，放几个我曾经写的单元测试，作为例子。</p>
<h3 id="6-1-简单的Print"><a href="#6-1-简单的Print" class="headerlink" title="6.1 简单的Print"></a>6.1 简单的Print</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAllXkqy</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    Set&lt;String&gt; strings = repository.allXkqy(<span class="string">&quot;20180607A&quot;</span>);</span><br><span class="line">    System.out.println(strings.size());</span><br><span class="line">    System.out.println(strings);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-2-一个Assert的例子"><a href="#6-2-一个Assert的例子" class="headerlink" title="6.2 一个Assert的例子"></a>6.2 一个Assert的例子</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testHourDateTime</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  assertEquals(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), hourDateTime(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)));</span><br><span class="line">  assertEquals(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), hourDateTime(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>)));</span><br><span class="line">  assertEquals(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), hourDateTime(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>)));</span><br><span class="line"></span><br><span class="line">  assertEquals(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), hourDateTime(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)));</span><br><span class="line">  assertEquals(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), hourDateTime(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">59</span>, <span class="number">100</span>)));</span><br><span class="line"></span><br><span class="line">  assertEquals(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), hourDateTime(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">0</span>)));</span><br><span class="line">  assertEquals(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), hourDateTime(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">0</span>)));</span><br><span class="line">  assertEquals(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), hourDateTime(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">32</span>, <span class="number">0</span>)));</span><br><span class="line">  assertEquals(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), hourDateTime(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">52</span>, <span class="number">0</span>)));</span><br><span class="line"></span><br><span class="line">  assertEquals(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), hourDateTime(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">59</span>, <span class="number">59</span>)));</span><br><span class="line">  assertEquals(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), hourDateTime(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)));</span><br><span class="line">  assertEquals(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), hourDateTime(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0</span>)));</span><br><span class="line">  assertEquals(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), hourDateTime(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>)));</span><br><span class="line">  assertEquals(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>), hourDateTime(of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-3-复杂一点的"><a href="#6-3-复杂一点的" class="headerlink" title="6.3 复杂一点的"></a>6.3 复杂一点的</h3><p>使用Mock，自定义返回值。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  metricService = mock(MetricService.class);</span><br><span class="line">  hourSampleCache = <span class="keyword">new</span> AccumulateHourSampleCache(metricService);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSample</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  when(metricService.sample(<span class="string">&quot;r.abc&quot;</span>, of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0</span>))).thenReturn(<span class="keyword">null</span>);</span><br><span class="line">  assertNull(hourSampleCache.sample(<span class="string">&quot;r.abc&quot;</span>, of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0</span>)));</span><br><span class="line"></span><br><span class="line">  DataPoint dp2 = <span class="keyword">new</span> DataPoint(<span class="string">&quot;r.abc&quot;</span>, of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">0</span>), <span class="string">&quot;3.14&quot;</span>, <span class="number">192</span>);</span><br><span class="line">  when(metricService.sample(<span class="string">&quot;r.abc&quot;</span>, of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0</span>))).thenReturn(dp2);</span><br><span class="line">  assertNull(hourSampleCache.sample(<span class="string">&quot;r.abc&quot;</span>, of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0</span>)));</span><br><span class="line"></span><br><span class="line">  DataPoint dp = <span class="keyword">new</span> DataPoint(<span class="string">&quot;r.abc&quot;</span>, of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>), <span class="string">&quot;3.14&quot;</span>, <span class="number">192</span>);</span><br><span class="line">  when(metricService.sample(<span class="string">&quot;r.abc&quot;</span>, of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>))).thenReturn(dp);</span><br><span class="line">  assertEquals(dp, hourSampleCache.sample(<span class="string">&quot;r.abc&quot;</span>, of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0</span>)));</span><br><span class="line"></span><br><span class="line">  when(metricService.sample(<span class="string">&quot;r.abc&quot;</span>, of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0</span>))).thenReturn(<span class="keyword">null</span>);</span><br><span class="line">  assertEquals(dp, hourSampleCache.sample(<span class="string">&quot;r.abc&quot;</span>, of(<span class="number">2016</span>, <span class="number">1</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">0</span>)));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-4-更复杂一点的"><a href="#6-4-更复杂一点的" class="headerlink" title="6.4 更复杂一点的"></a>6.4 更复杂一点的</h3><p>下面是一个更复杂的例子，在使用Mock的基础上，增加了内部调用方法次数的验证。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Before</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  metricService = Mockito.mock(MetricService.class);</span><br><span class="line">  repairRecorder = Mockito.mock(RepairRecorder.class);</span><br><span class="line">  hourlyMetricWriter = <span class="keyword">new</span> HourlyMetricWriter(metricService, repairRecorder);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testWrite</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">  Mockito.when(metricService.read(metricHourly, ldt, ldt.withHour(<span class="number">23</span>), <span class="keyword">false</span>)).thenReturn(</span><br><span class="line">      Collections.emptyList());</span><br><span class="line">  hourlyMetricWriter.write(dph);</span><br><span class="line">  Mockito.verify(metricService, Mockito.times(<span class="number">1</span>)).read(metricHourly, ldt, ldt.withHour(<span class="number">23</span>), <span class="keyword">false</span>);</span><br><span class="line">  Mockito.verify(metricService, Mockito.times(<span class="number">2</span>)).write(Matchers.any(DataPoint.class));</span><br><span class="line">  Mockito.verify(metricService, Mockito.times(<span class="number">1</span>)).write(dph);</span><br><span class="line">  Mockito.verify(metricService, Mockito.times(<span class="number">1</span>)).write(<span class="keyword">new</span> DataPoint(metricDaily, ldt, <span class="string">&quot;3.14&quot;</span>, <span class="number">192</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="6-5-测试性能"><a href="#6-5-测试性能" class="headerlink" title="6.5 测试性能"></a>6.5 测试性能</h3><p>自己写几行代码，简单的测测性能。</p>
<p>这是不是单元测试，似乎并不重要。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">write</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">     <span class="keyword">final</span> <span class="keyword">int</span> minHandle = <span class="number">1179</span>;</span><br><span class="line">     <span class="keyword">final</span> <span class="keyword">int</span> maxQueueSize = <span class="number">1000</span>;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">final</span> <span class="keyword">int</span> threadCount = <span class="number">5</span>;</span><br><span class="line">     <span class="keyword">final</span> <span class="keyword">int</span> tagsPerThread = <span class="number">1000</span>;</span><br><span class="line">     <span class="keyword">final</span> <span class="keyword">int</span> records = <span class="number">10000</span>;</span><br><span class="line">     <span class="keyword">final</span> <span class="keyword">int</span> sendCycle = <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">final</span> <span class="keyword">int</span> maxHandle = minHandle + tagsPerThread * threadCount * <span class="number">2</span>;</span><br><span class="line">     <span class="comment">//        int maxHandle = 3000;</span></span><br><span class="line"></span><br><span class="line">     <span class="keyword">final</span> TagManagerImpl tagManager = <span class="keyword">new</span> TagManagerImpl(<span class="string">&quot;192.168.1.98&quot;</span>, <span class="number">6767</span>, <span class="string">&quot;lpp&quot;</span>, <span class="string">&quot;12345&quot;</span>);</span><br><span class="line"></span><br><span class="line">     ExecutorService threadPool = Executors.newFixedThreadPool(threadCount + <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">final</span> DateTime dateTime = <span class="keyword">new</span> DateTime(<span class="number">2014</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">     <span class="keyword">final</span> <span class="keyword">int</span> logCycle = <span class="number">60</span> * <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">final</span> BlockingQueue&lt;Map&lt;Integer, TagValue&gt;&gt; queue = <span class="keyword">new</span> LinkedBlockingQueue&lt;&gt;();</span><br><span class="line"></span><br><span class="line">     threadPool.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">         <span class="meta">@Override</span></span><br><span class="line">         <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">             <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; records * sendCycle; i += sendCycle) &#123;</span><br><span class="line">                 DateTime dt = dateTime.plusSeconds(i);</span><br><span class="line">                 Map&lt;Integer, TagValue&gt; map = <span class="keyword">new</span> HashMap&lt;&gt;(tagsPerThread);</span><br><span class="line">                 <span class="keyword">for</span> (<span class="keyword">int</span> j = minHandle; j &lt; maxHandle; j += <span class="number">2</span>) &#123;</span><br><span class="line">                     map.put(j, <span class="keyword">new</span> TagValue(dt, TagValue.DOUBLE, i + j, (<span class="keyword">short</span>) <span class="number">192</span>));</span><br><span class="line">                     <span class="keyword">if</span> (map.size() == tagsPerThread) &#123;</span><br><span class="line">                         queue.offer(map);</span><br><span class="line">                         map = <span class="keyword">new</span> HashMap&lt;&gt;(tagsPerThread);</span><br><span class="line">                     &#125;</span><br><span class="line">                     <span class="keyword">while</span> (queue.size() &gt; maxQueueSize) &#123;</span><br><span class="line">                         <span class="keyword">try</span> &#123;</span><br><span class="line">                             TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">                         &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                             e.printStackTrace();</span><br><span class="line">                         &#125;</span><br><span class="line">                     &#125;</span><br><span class="line">                 &#125;</span><br><span class="line">                 <span class="keyword">if</span> (i % logCycle == <span class="number">0</span>) &#123;</span><br><span class="line">                     logger.info(String.format(<span class="string">&quot;Minute:%d&quot;</span>, i / logCycle));</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">     &#125;);</span><br><span class="line"></span><br><span class="line">     TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">     <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">     <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; threadCount; i++) &#123;</span><br><span class="line">         threadPool.execute(<span class="keyword">new</span> Runnable() &#123;</span><br><span class="line">             <span class="keyword">private</span> <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">             <span class="meta">@Override</span></span><br><span class="line">             <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                 <span class="keyword">try</span> &#123;</span><br><span class="line">                     <span class="keyword">while</span> (!queue.isEmpty()) &#123;</span><br><span class="line">                         Map&lt;Integer, TagValue&gt; take = queue.take();</span><br><span class="line">                         tagManager.writeVal(<span class="keyword">new</span> ArrayList&lt;&gt;(take.keySet()), <span class="keyword">new</span> ArrayList&lt;&gt;(take.values()));</span><br><span class="line">                         count++;</span><br><span class="line"></span><br><span class="line">                         <span class="keyword">if</span> (count % <span class="number">100</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                             logger.info(String.format(<span class="string">&quot;has been write count:%d, queue size:%d&quot;</span>, count, queue.size()));</span><br><span class="line">                         &#125;</span><br><span class="line">                     &#125;</span><br><span class="line">                     logger.info(String.format(<span class="string">&quot;This thread write total:%d&quot;</span>, count));</span><br><span class="line">                 &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">                     e.printStackTrace();</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">     &#125;</span><br><span class="line">     threadPool.shutdown();</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         threadPool.awaitTermination(Long.MAX_VALUE, TimeUnit.NANOSECONDS);</span><br><span class="line">     &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="keyword">long</span> endTime = System.currentTimeMillis();</span><br><span class="line"></span><br><span class="line">     logger.info(String.format(<span class="string">&quot;客户端数:%d&quot;</span>, threadCount));</span><br><span class="line">     logger.info(String.format(<span class="string">&quot;每个客户端位号数:%d&quot;</span>, tagsPerThread));</span><br><span class="line">     logger.info(String.format(<span class="string">&quot;每位号记录数:%d&quot;</span>, records));</span><br><span class="line">     logger.info(String.format(<span class="string">&quot;数据频率:%d&quot;</span>, sendCycle));</span><br><span class="line">     logger.info(String.format(<span class="string">&quot;用时:%d&quot;</span>, (endTime - startTime) / <span class="number">1000</span>));</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/Oracle%E7%9A%84DBLink%E5%92%8C%E5%90%8C%E4%B9%89%E8%AF%8DSYNONYM/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Oracle%E7%9A%84DBLink%E5%92%8C%E5%90%8C%E4%B9%89%E8%AF%8DSYNONYM/" class="post-title-link" itemprop="url">Oracle的DBLink和同义词SYNONYM</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-10-12 17:06:12" itemprop="dateCreated datePublished" datetime="2018-10-12T17:06:12+08:00">2018-10-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="1-Oracle的DBLink是什么？"><a href="#1-Oracle的DBLink是什么？" class="headerlink" title="1. Oracle的DBLink是什么？"></a>1. Oracle的DBLink是什么？</h1><p>有多台Oracle服务器，A服务器的用户a，想访问B服务器的用户b的数据，就在A服务器上a用户下面建一个DBLink，指向B服务器的b用户。</p>
<p>创建DBLink的语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE LINK B_b </span><br><span class="line"><span class="keyword">CONNECT</span> <span class="keyword">TO</span> b IDENTIFIED <span class="keyword">BY</span> password_of_b </span><br><span class="line"><span class="keyword">USING</span> <span class="string">&#x27;host_of_B:1521/SID_of_B&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>建好DBLink后，a用户如何访问B用户的表T呢？</p>
<p>我们知道a用户访问同服务器下另外一个用户x的表T，可以使用「x.T」；<br>与之类似，访问DBLink「B_b」的表T，可以使用「T@B_b」。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> T<span class="variable">@B</span>_b</span><br></pre></td></tr></table></figure>


<h1 id="2-同义词-SYNONYM-又是什么呢？"><a href="#2-同义词-SYNONYM-又是什么呢？" class="headerlink" title="2. 同义词 SYNONYM 又是什么呢？"></a>2. 同义词 SYNONYM 又是什么呢？</h1><p>一个Oracle服务上，有多个用户（Schema），a用户想访问b用户下的表T，我们当然可以使用「b.T」来访问，但这样老是要带上b的用户名，不是很方便，有没有更方便的办法呢？</p>
<p>有啊，办法就是同义词：则在a用户下，建一个同义词，指向b用户的表B。</p>
<p>创建同义词SYNONYM的语法：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> synonym &quot;a&quot;.T <span class="keyword">for</span> &quot;b&quot;.&quot;T&quot;</span><br></pre></td></tr></table></figure>


<h1 id="3-例子：DBLink-与-同义词结合使用"><a href="#3-例子：DBLink-与-同义词结合使用" class="headerlink" title="3. 例子：DBLink 与 同义词结合使用"></a>3. 例子：DBLink 与 同义词结合使用</h1><p>在服务器 192.168.110.54 上的XKCA1这个用户下，想访问 10.199.132.7 这台服务器上 db_dhsz_dev 用户下的 DHSZ_FP_ZZSFP_QB 表。</p>
<p>我们需要先建 DBLink，让XKCA1这个用户，可以访问 db_dhsz_dev 用户的数据；<br>再建个同义词，让DHSZ_FP_ZZSFP_QB表看起来像是 XKCA1这个用户自己的表。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> DATABASE LINK XKCA_DHSZ </span><br><span class="line"><span class="keyword">CONNECT</span> <span class="keyword">TO</span> db_dhsz_dev IDENTIFIED <span class="keyword">BY</span> db_dhsz_dev </span><br><span class="line"><span class="keyword">USING</span> <span class="string">&#x27;10.199.132.7:1521/nsxygl&#x27;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">OR</span> REPLACE SYNONYM &quot;XKCA1&quot;.&quot;DHSZ_FP_ZZSFP_QB&quot; <span class="keyword">FOR</span> &quot;DHSZ_FP_ZZSFP_QB&quot;@&quot;XKCA_DHSZ&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span></span><br><span class="line"><span class="keyword">from</span> DHSZ_FP_ZZSFP_QB</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="4-简单的总结"><a href="#4-简单的总结" class="headerlink" title="4. 简单的总结"></a>4. 简单的总结</h1><ul>
<li>DBLink是Schema级别的，跨服务访问的概念</li>
<li>同义词SYNONYM是对象（如 表）级别的，跨用户（可以通过DBLink跨服务）访问的概念</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/ArangoDB%E9%9B%86%E7%BE%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/ArangoDB%E9%9B%86%E7%BE%A4/" class="post-title-link" itemprop="url">ArangoDB集群</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-29 17:06:12" itemprop="dateCreated datePublished" datetime="2018-06-29T17:06:12+08:00">2018-06-29</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ArangoDB集群"><a href="#ArangoDB集群" class="headerlink" title="ArangoDB集群"></a>ArangoDB集群</h1><p>本文以简短的篇幅，介绍ArangoDB集群相关的内容，包括 结构、工作原理 和 安装部署，并在最后介绍了一套适合我们的操作指南。</p>
<h1 id="1-ArangoDB-集群介绍"><a href="#1-ArangoDB-集群介绍" class="headerlink" title="1. ArangoDB 集群介绍"></a>1. ArangoDB 集群介绍</h1><p>关于ArangoDB集群的资料，能看到内容非常少，主要集中在官方文档中的 「架构」这一节。</p>
<p>地址：<a href="https://docs.arangodb.com/3.3/Manual/Scalability/Architecture.html">https://docs.arangodb.com/3.3/Manual/Scalability/Architecture.html</a></p>
<h2 id="1-1-概述"><a href="#1-1-概述" class="headerlink" title="1.1 概述"></a>1.1 概述</h2><p>ArangoDB，是无单点故障的，主-主模式的，CP架构的集群。</p>
<p>这一句话有3个点：</p>
<ul>
<li>CP架构：即在CAP中，选择了<code>一致性高于可用性</code>；</li>
<li>主-主模式：意思是每一个点都可以写；</li>
<li>无单点故障：说明有冗余容灾机制，有选举机制。</li>
</ul>
<h2 id="1-2-集群的结构"><a href="#1-2-集群的结构" class="headerlink" title="1.2 集群的结构"></a>1.2 集群的结构</h2><p>集群中有4种节点：Agent，Coordinator，Primary 和 Secondary。前三者必选，Secondary可选。</p>
<p>官方文档中，此处应该要有张架构图，可惜文档不是我写的，它没有。</p>
<p>我从其他地方找了几张图，供参考。</p>
<p><img src="../images/ArangoDB%E9%9B%86%E7%BE%A4/simple_cluster.png" alt="simple_cluster"></p>
<p><img src="../images/ArangoDB%E9%9B%86%E7%BE%A4/cluster_topology-1.png" alt="cluster_topology-1"></p>
<p><img src="../images/ArangoDB%E9%9B%86%E7%BE%A4/deep-dive-into-the-native-multi-model-database-arangodb-75-638.jpg" alt="deep-dive-into-the-native-multi-model-database-arangodb-75-638"></p>
<p>所有节点都是同一个命令启动的，只是参数不同。</p>
<p>Agent：集群的配置中心，Raft一致性协议解决配置冲突，高可用的KV存储。</p>
<p>Coordinator：接收客户端请求，无状态，与Primary交互。</p>
<p>Primary：主存储节点，多个，所谓的<code>主-主</code>指的就是它了。</p>
<p>Secondary：可选，可以理解成Primary的备份。</p>
<h2 id="1-3-分布式机制"><a href="#1-3-分布式机制" class="headerlink" title="1.3 分布式机制"></a>1.3 分布式机制</h2><h3 id="1-3-1-可用性"><a href="#1-3-1-可用性" class="headerlink" title="1.3.1 可用性"></a>1.3.1 可用性</h3><p>可用性，要求数据保存副本，即做数据冗余。ArangoDB数据存储的基本单位是Shard，听上去比较抽象。换句话说，一个Shard就是一个Document，就容易理解了。</p>
<blockquote>
<p><strong>预备知识</strong></p>
<p>ArangoDB的数据数组组织：ArangoDB -&gt; DataBase -&gt; Collection -&gt; Document，从前到后，都是一对多的关系。</p>
<p>ArangoDB：一个库，下面可以建多个DataBase</p>
<p>DataBase：数据库，下有多个Collection</p>
<p>Collection：集合，下有多个Document</p>
<p>Document：文档，集合中的元素</p>
</blockquote>
<p>在创建集合时，可以指定副本数，默认是根据<code>_key</code>做Hash来分发，具体算法文档中没有明确说明，猜测可能是<code>一致性Hash</code>。</p>
<p><img src="../images/ArangoDB%E9%9B%86%E7%BE%A4/006tKfTcgy1fsoq12todoj30i00ckgmg.jpg" alt="006tKfTcgy1fsoq12todoj30i00ckgmg"></p>
<h3 id="1-3-2-一致性"><a href="#1-3-2-一致性" class="headerlink" title="1.3.2 一致性"></a>1.3.2 一致性</h3><p>ArangoDB是CP集群，即一致性高于可用性。它的一致性，指的是在Primary级别采用同步复制，保证强一致；Secondary则从Primary异步复制，保证最终一致。</p>
<p>因为客户端的读写只操作Primary，所以，ArangoDB是一个强一致性的分布式数据库。</p>
<ul>
<li>同步复制：参考下一节「写流程」</li>
<li>异步复制：可以理解成定时备份</li>
</ul>
<h2 id="1-4-写流程"><a href="#1-4-写流程" class="headerlink" title="1.4 写流程"></a>1.4 写流程</h2><ul>
<li>客户端发起请求</li>
<li>负载均衡，找一个Coordinator</li>
<li>Coordinator根据shardBy，找到Leader</li>
<li>Leader自己存好后，发送Followers</li>
<li>所有Followers返回成功后，Leader告诉Coordinator写入成功</li>
<li>如果Leader 3秒还没有收到Follower返回，认为其掉线</li>
<li>如果Coordinator 15秒没有心跳，认为其掉线，触发重选Leader</li>
</ul>
<p><strong>注意：</strong> Leader和Follower不同于一些集群的Master-Slave。Leader是针对<code>Shard</code>选举的，集群中所有的<code>Primary</code>地位是一样的。并不存在<code>Master Primary</code>。</p>
<h2 id="1-5-读流程"><a href="#1-5-读流程" class="headerlink" title="1.5 读流程"></a>1.5 读流程</h2><blockquote>
<p>TODO 暂时还没有发现相关文档</p>
</blockquote>
<h1 id="2-方案选型"><a href="#2-方案选型" class="headerlink" title="2. 方案选型"></a>2. 方案选型</h1><p>ArangoDB集群，常用的共有4种方案：Mesos/DCOS，Docker/Compose，ArangoDB-Starter，纯手工。</p>
<p>因为ArangoDB中的节点，有4种角色（3个必须，1个非必须），配置起来比较复杂，一般不建议用纯手工的方式配置。</p>
<h2 id="2-1-Mesos-DCOS"><a href="#2-1-Mesos-DCOS" class="headerlink" title="2.1 Mesos/DCOS"></a>2.1 Mesos/DCOS</h2><p>Mesos/DCOS是官方首推的集群方案，官方性能测试也是在此环境上进行的。但搭建DCOS至少需要5台机器，一旦搭好了DCOS，后面会非常简单。目前来看，项目中配置机器数量不会达到5台，故此方案不适用。</p>
<h2 id="2-2-Docker-Compose"><a href="#2-2-Docker-Compose" class="headerlink" title="2.2 Docker/Compose"></a>2.2 Docker/Compose</h2><p>Docker/Compose是另外一套比较好的方案，官方有提供Docker镜像，使用Compose编排集群内的节点，使用起来会非常灵活，又一目了然。但是，Docker早已停止支持CentOS6，而现场的机器目前没有升级到7及以上的计划，并在看的到的未来，仍会在6上运行。故此方案也不适用。</p>
<h2 id="2-3-ArangoDB-Starter"><a href="#2-3-ArangoDB-Starter" class="headerlink" title="2.3 ArangoDB-Starter"></a>2.3 ArangoDB-Starter</h2><p>最后，只剩下官方提供的ArangoDB-Starter这一套方案了。该方案比纯手工做了一步简化：把3个必须的角色打包，集成到一个命令中。</p>
<h1 id="3-安装ArangoDB-内网"><a href="#3-安装ArangoDB-内网" class="headerlink" title="3. 安装ArangoDB(内网)"></a>3. 安装ArangoDB(内网)</h1><p>本文以CentOS 6.5 和  ArangoDB 3.3.8 为例，离线安装。</p>
<h2 id="3-1-安装依赖"><a href="#3-1-安装依赖" class="headerlink" title="3.1 安装依赖"></a>3.1 安装依赖</h2><p>在连网的CentOS 6.5上，用yum deplist arangodb3可以查出，3.3.8版本依赖3个包：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bash.x86_64 4.1.2-48.el6</span><br><span class="line">glibc.x86_64 2.12-1.209.el6</span><br><span class="line">openssl.x86_64 1.0.1e-57.el6</span><br></pre></td></tr></table></figure>

<p>前2个包已经有了，第3个包需要下载安装。</p>
<p>下载地址：<a href="https://centos.pkgs.org/6/centos-x86_64/openssl-1.0.1e-57.el6.x86_64.rpm.html">https://centos.pkgs.org/6/centos-x86_64/openssl-1.0.1e-57.el6.x86_64.rpm.html</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh openssl-1.0.1e-57.el6.x86_64.rpm</span><br></pre></td></tr></table></figure>

<h2 id="3-2-安装ArangoDB"><a href="#3-2-安装ArangoDB" class="headerlink" title="3.2 安装ArangoDB"></a>3.2 安装ArangoDB</h2><p>ArangoDB 分社区版 和 企业版，生产环境建议用 <code>企业版</code>。从福建反馈来看，之前用社区版不稳定，出现假死、自动重启等问题，改用企业版后都没出现过。</p>
<p>从官方下载企业版：<a href="https://www.arangodb.com/download-arangodb-enterprise/install-enterprise">https://www.arangodb.com/download-arangodb-enterprise/install-enterprise</a></p>
<p>安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rpm -ivh arangodb3e-3.3.8-1.x86_64.rpm</span><br></pre></td></tr></table></figure>

<p><strong>注：</strong> 如果之前有装过 <code>社区版</code>，则需要加<code>--replacepkgs</code>参数，替换安装。</p>
<h1 id="4-部署：ArangoDB-Starter"><a href="#4-部署：ArangoDB-Starter" class="headerlink" title="4. 部署：ArangoDB-Starter"></a>4. 部署：ArangoDB-Starter</h1><h2 id="4-1-简介"><a href="#4-1-简介" class="headerlink" title="4.1 简介"></a>4.1 简介</h2><p>以下是该方案的特点：</p>
<ul>
<li>ArangoDB安装包自带，无需额外安装</li>
<li>可以单机，也可以多台机器</li>
<li>创建集群时有Master，集群创建好了则无此概念</li>
<li>启动和运行至少需要3个节点，少于3个节点无法正常工作</li>
<li>节点数 &gt; 3，无单点故障</li>
<li>节点会启动agent，dbserver，coordinator这3个角色</li>
<li>默认AgencySize为3，即前3个节点会启动agent，第4个开始，只启动dbserver 和 coordinator</li>
</ul>
<h2 id="4-2-使用方式"><a href="#4-2-使用方式" class="headerlink" title="4.2. 使用方式"></a>4.2. 使用方式</h2><p><strong>注：</strong> 以下指令在<code>3.3.8</code>版本测试通过，不同版本可能会有微小的区别。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动Master</span></span><br><span class="line">arangodb --starter.data-dir=/root/arangodb/db1 start</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动其他</span></span><br><span class="line">arangodb --starter.data-dir=/root/arangodb/db2 --starter.join 10.199.132.222 start</span><br><span class="line">arangodb --starter.data-dir=/root/arangodb/db3 --starter.join 10.199.132.222 start</span><br><span class="line">arangodb --starter.data-dir=/root/arangodb/db4 --starter.join 10.199.132.222 start</span><br></pre></td></tr></table></figure>

<p><strong>重申：</strong> Master 概念只是创建集群时的叫法，创建好之后，无Master节点，所有节点地位是一样的。</p>
<p>全部停止：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pkill -f arangod</span><br></pre></td></tr></table></figure>

<p>再次启动：</p>
<figure class="highlight sh"><figcaption><span>el l</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arangodb --starter.data-dir=/root/arangodb/db1 start</span><br><span class="line">arangodb --starter.data-dir=/root/arangodb/db2 start</span><br><span class="line">arangodb --starter.data-dir=/root/arangodb/db3 start</span><br><span class="line">arangodb --starter.data-dir=/root/arangodb/db4 start</span><br></pre></td></tr></table></figure>



<p><strong>注：</strong> 本示例在多台机器上同样可用。</p>
<h1 id="5-AQL常用写法"><a href="#5-AQL常用写法" class="headerlink" title="5. AQL常用写法"></a>5. AQL常用写法</h1><p>对于熟悉SQL的同学，可以通过AQL与SQL的比较，来学习这门查询语言，其中的例子非常有用。</p>
<p>AQL与SQL的比较：<a href="https://www.arangodb.com/why-arangodb/sql-aql-comparison/">https://www.arangodb.com/why-arangodb/sql-aql-comparison/</a></p>
<p>链接中有简单的例子，下面列举有用的，复杂一点的几个例子。</p>
<h2 id="5-1-分组查询并排序"><a href="#5-1-分组查询并排序" class="headerlink" title="5.1 分组查询并排序"></a>5.1 分组查询并排序</h2><p>集合TPIN_VERTEX_WWD 存在团伙的Key：community_label，根据条件抽出团伙。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">for v in TPIN_VERTEX_WWD</span><br><span class="line">filter v.ishuman == &quot;0&quot; // 过滤企业，and 用 多个filter，or 用一个filter，条件中间加 or 关键字</span><br><span class="line">filter v.community_label &gt; 0 // 过滤community_label 大于0的，等于0的不是团伙</span><br><span class="line">collect thKey = v.community_label // 按照 团伙的Key来分组</span><br><span class="line">AGGREGATE xkje = SUM(v.xkje), // 分组内部的SUM</span><br><span class="line">qys = count(v),  // 内部的count</span><br><span class="line">xkfps = SUM(v.xkfps) // 另一个SUM</span><br><span class="line">filter qys &gt; 3  // 根据分组后的条件来过滤，即 group by having</span><br><span class="line">sort xkje desc // 用分组后的来排序</span><br><span class="line">return &#123;key: thKey, xkje: xkje, qys: qys, xkfps: xkfps&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-2-使用变量"><a href="#5-2-使用变量" class="headerlink" title="5.2 使用变量"></a>5.2 使用变量</h2><p>查询某一团伙所有的点和边。团伙只和点关联，和边并没有关联。</p>
<p>如果用图遍历来查团伙中所有的点和边，数据量大了，图深了，性能非常差。图的深度设的少了，很可能会不全。</p>
<p>但是，如果单独查 点，再根据点查边，就会非常快。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LET ids = (FOR v IN TPIN_VERTEX_WWD </span><br><span class="line">			FILTER v.community_label == @thKey </span><br><span class="line">			RETURN v._id) // 点的数组赋值为一变量，放到最前面</span><br><span class="line">FOR e IN TPIN_EDGE_WWD </span><br><span class="line">FILTER e._from in ids </span><br><span class="line">FILTER e._to in ids </span><br><span class="line">RETURN DISTINCT e</span><br></pre></td></tr></table></figure>

<p><strong>注意：</strong> 此例中，不要将 LET 放在 FOR 之后，FILTER之前，那样性能会差。实际测试过一个例子，边总数为2000，点的数量为1000，时间上一个是9ms，一个是118ms。</p>
<h1 id="6-AQL性能优化"><a href="#6-AQL性能优化" class="headerlink" title="6. AQL性能优化"></a>6. AQL性能优化</h1><p>要把AQL想象成编程语言，而不是SQL。</p>
<h2 id="6-1-使用LET"><a href="#6-1-使用LET" class="headerlink" title="6.1 使用LET"></a>6.1 使用LET</h2><p>见 5.2 使用变量</p>
<h2 id="6-2-图查询广度优先"><a href="#6-2-图查询广度优先" class="headerlink" title="6.2 图查询广度优先"></a>6.2 图查询广度优先</h2><p>在用图查询时，一般都加以下选项，用广度优先，性能好很多。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS &#123;bfs: true, uniqueVertices: &#x27;global&#x27;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-3-索引"><a href="#6-3-索引" class="headerlink" title="6.3 索引"></a>6.3 索引</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fangniude.github.com/Java%20Jni%20%E5%9C%A8%20Windows%20%E4%B8%8A%20%E5%B0%91%20dll%20%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="放牛的">
      <meta itemprop="description" content="随便写点东西">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="放牛的">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/Java%20Jni%20%E5%9C%A8%20Windows%20%E4%B8%8A%20%E5%B0%91%20dll%20%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">Java Jni 在 Windows 上 少 dll 解决方法</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2016-05-20 17:06:12" itemprop="dateCreated datePublished" datetime="2016-05-20T17:06:12+08:00">2016-05-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2021-07-20 11:36:37" itemprop="dateModified" datetime="2021-07-20T11:36:37+08:00">2021-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>测试报上来一个问题，我们几个开发机器上都不能重现，仔细看了下异常提示，确定是这台Windows测试机器少dll。</p>
<p>这个项目用到leveldbjni-all这个内置jni的包，但少了系统的dll，这个Jar就不能正常工作了。</p>
<h3 id="1-如何知道少了哪些dll呢？"><a href="#1-如何知道少了哪些dll呢？" class="headerlink" title="1. 如何知道少了哪些dll呢？"></a>1. 如何知道少了哪些dll呢？</h3><p>找到一个比较好的工具：<a href="http://www.dependencywalker.com/">DllWalker</a></p>
<p>这是一个绿色软件，从官方下载下来，双击depends.exe即可运行，点 打开，选 leveldbjni.dll，这个软件会分析出来 缺少哪些dll，当把这次提示的dll都装好后，F5刷新一下，可能还会有新的未安装的dll，这些是刚才安装的dll的依赖。</p>
<h3 id="2-dll到哪儿找呢？"><a href="#2-dll到哪儿找呢？" class="headerlink" title="2. dll到哪儿找呢？"></a>2. dll到哪儿找呢？</h3><p>这个网站不错：<a href="http://www.dll-files.com/">dll-files.com</a></p>
<p>我要找的dll，都能搜到，并且提供多个版本供选择。下载过来的一个包含dll的压缩包，需要解压出dll才能放到Windows/System32下面去。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">放牛的</p>
  <div class="site-description" itemprop="description">随便写点东西</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">35</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">放牛的</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
